!function(d){var a=d.fn.chosen;d.fn.extend({chosen:function(e){var h=(e=e||{}).html_template||'<img class="{class_name}" src="{url}" />';this.each(function(e){$this=d(this),$this.on("chosen:ready",function(e,n){var a=(n=n.chosen).form_field.options,s=d(n.container).find(".chosen-choices span");if(a&&a.length)for(var r=0;r<a.length;r++){var i=a[r],o=d(i).attr("selected"),c=d(i).attr("data-img-src"),t=d(i).text();if(o&&c){var l=h.replace("{url}",c);if(s.length)for(var p=0;p<s.length;p++)t==d(s[p]).text()&&d(s[p]).prepend(l.replace("{class_name}","chose-image"));else d(n.container).find(".chosen-single span").prepend(l.replace("{class_name}","chose-image-small"))}}})});var n=a.apply(this,arguments);return this.each(function(e){var n,l;n=d(this),l=n.data("chosen"),n.on("change",function(e,n){var a=l.form_field.options;if(null!=n&&null!=n.selected&&a&&a.length)for(var s=0;s<a.length;s++){var r=a[s],i=d(r).attr("value")?d(r).attr("value"):d(r).text(),o=d(r).attr("data-img-src");if(null!=o&&n.selected==i){var c=h.replace("{url}",o);span=d(l.container).find(".chosen-choices span").last(),span.find("img").remove(),span.prepend(c.replace("{class_name}","chose-image")),span=d(l.container).find(".chosen-single span"),span.find("img").remove(),span.prepend(c.replace("{class_name}","chose-image-small"))}}}),n.on("chosen:hiding_dropdown",function(e,n){l.form_field.options;var a=d(l.form_field).find(":selected");if(a){var s=a.attr("data-img-src");if(s){var r=h.replace("{url}",s);span=d(l.container).find(".chosen-choices span").last(),span.find("img").remove(),span.prepend(r.replace("{class_name}","chose-image")),span=d(l.container).find(".chosen-single span"),span.find("img").remove(),span.prepend(r.replace("{class_name}","chose-image-small"))}}}),n.on("chosen:showing_dropdown",function(e,n){for(var a=d(l.container).find(".chosen-drop ul li:not(:has(img))"),s=d(l.form_field).find("optgroup, option"),r=0;r<a.length;r++){var i=a[r],o=s[r],c=d(o).attr("data-img-src");if(null!=c){var t=h.replace("{url}",c);d(i).prepend(t.replace("{class_name}","chose-image-list"))}}})}),$this.trigger("chosen:hiding_dropdown"),n}})}(jQuery);