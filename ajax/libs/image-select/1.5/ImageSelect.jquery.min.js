!function(d){var p='<img class="{class_name}" src="{url}" />';function f(n,e,o,t,i,s){var r=d(e).data("img-src");null!=r&&""<r&&(n=d(n),text=d(e).val(),i=null==i||i,s=s||(i?"chose-image":"chose-image-small"),s=t?s+" rtl":s,o=o.replace("{url}",r).replace("{class_name}",s).replace("{text}",text),n.empty(),t&&i?n.append(o):n.prepend(o))}var n=d.fn.chosen;d.fn.extend({chosen:function(l){l=l||{};n.apply(this,arguments);this.each(function(){var o=d(this),n=o.data("chosen");o.on("chosen:hiding_dropdown",function(n,e){for(var o=function(n){for(var e=[],o=d(n.form_field).find("option:selected")||[],t=n.is_multiple?d(n.container).find(".chosen-choices span"):d(n.container).find(".chosen-single span"),i=0;i<o.length;i++)for(var s=0;s<t.length;s++)d(t[s]).text()==d(o[i]).text()&&e.push({span:t[s],option:o[i]});return e}(e.chosen),t=e.chosen.is_rtl,i=e.chosen.is_multiple,s=l.html_template||(t&&i?"{text}"+p:p+"{text}"),r=0;r<o.length;r++)f(o[r].span,o[r].option,s,t,i)}),o.on("chosen:showing_dropdown",function(n,e){for(var o=(e=e.chosen).form_field.options||[],t=e.is_rtl,i=l.html_template||t?"{text}"+p:p+"{text}",s=d(e.container).find(".chosen-drop ul li:not(:has(img))"),r=0;r<s.length;r++){var a=s[r],c=d(o[r]),h=d(a).attr("data-option-array-index");h&&(c=o[e.results_data[h].options_index]),f(a,c,i,t,!0,"chose-image-list")}}),o.on("chosen:ready",function(n,e){o.trigger("chosen:hiding_dropdown",e)}),o.on("chosen:filter",function(n,e){o.trigger("chosen:showing_dropdown",{chosen:e.chosen})}),o.trigger("chosen:hiding_dropdown",{chosen:n})})}})}(jQuery);