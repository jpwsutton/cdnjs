(function(a){var b=function(a,b,c){this.target=a;this.url=b;this.options=jQuery.extend({ssl:false,limit:null,key:null,template:"<ul>{entry}<li><a href='{url}'>[{author}@{date}] {title}</a><br/>{shortBodyPlain}</li>{/entry}</ul>",tokens:{}},c||{})};b.prototype.load=function(b){var c="http"+(this.options.ssl?"s":""),d=c+"://ajax.googleapis.com/ajax/services/feed/load",e=d+"?v=1.0&output=json_xml&callback=?&q="+encodeURIComponent(this.url),f=this;if(this.options.limit!=null)e+="&num="+this.options.limit;if(this.options.key!=null)e+="&key="+this.options.key;a.getJSON(e,b)};b.prototype.render=function(){var a=this,b=a.options.template.match(/\{entry\}(.*)\{\/entry\}/),c=!!b,d=c?b[1]:this.options.template,e=[];this.load(function(f){jQuery(f.responseData.feed.entries).each(function(){var b=this,c=d;jQuery(d.match(/(\{.*?\})/g)).each(function(){var d=this.toString();c=c.replace(d,a.getValueForToken(d,b))});e.push(c)});e=e.join("\n");if(c)e=a.options.template.replace(b[0],e);else e=jQuery(e).length==0?jQuery("<div>"+e+"</div>"):jQuery(e);a.target.append(e)})};b.prototype.getValueForToken=function(a,b){var c=jQuery.extend({url:b.link,author:b.author,date:b.publishedDate,title:b.title,body:b.content,shortBody:b.contentSnippet,bodyPlain:b.content.replace(/<\/?[^>]+>/gi,""),shortBodyPlain:b.contentSnippet.replace(/<\/?[^>]+>/gi,""),teaserImage:b.content.match(/(<img.*?>)/gi)[0],teaserImageUrl:b.content.match(/(<img.*?>)/gi)[0].match(/src="(.*?)"/)[1]},this.options.tokens);var d=c[a.replace(/[\{\}]/g,"")];if(d)return typeof d=="function"?d(b,c):d;else throw new Error("Unknown token: "+a)};a.fn.rss=function(a,c){(new b(this,a,c)).render()}})(jQuery)
