{"version":3,"file":"metisMenu.js","sources":["modules/constant.js","modules/index.js"],"sourcesContent":["export const Default = {\n    parentTrigger: \"li\",\n    subMenu: \"ul\",\n    toggle: true,\n    triggerElement: \"a\"\n};\nexport const ClassNames = {\n    activeClass: \"active\",\n    collapseClass: \"collapse\",\n    collapseInClass: \"in\",\n    collapsingClass: \"collapsing\"\n};\n","import { ClassNames, Default } from \"./constant\";\nclass MetisMenu {\n    constructor(element, options) {\n        this.element =\n            typeof element === \"string\" ? document.querySelector(element) : element;\n        this.cacheEl = this.element;\n        this.config = { ...Default, ...options };\n        this.cacheConfig = this.config;\n        this.disposed = false;\n        this.ulArr = [];\n        this.listenerOb = [];\n        this.init();\n    }\n    update() {\n        this.disposed = false;\n        this.element = this.cacheEl;\n        this.config = this.cacheConfig;\n        this.init();\n    }\n    dispose() {\n        for (const lo of this.listenerOb) {\n            for (const key in lo) {\n                if (lo.hasOwnProperty(key)) {\n                    const el = lo[key];\n                    el[1].removeEventListener(el[0], el[2]);\n                }\n            }\n        }\n        this.ulArr = [];\n        this.listenerOb = [];\n        this.config = null;\n        this.element = null;\n        this.disposed = true;\n    }\n    on(event, fn) {\n        this.element.addEventListener(event, fn, false);\n        return this;\n    }\n    off(event, fn) {\n        this.element.removeEventListener(event, fn);\n        return this;\n    }\n    emit(event, eventDetail, shouldBubble = false) {\n        let evt;\n        if (typeof CustomEvent === \"function\") {\n            evt = new CustomEvent(event, {\n                bubbles: shouldBubble,\n                detail: eventDetail\n            });\n        }\n        else {\n            evt = document.createEvent(\"CustomEvent\");\n            evt.initCustomEvent(event, shouldBubble, false, eventDetail);\n        }\n        this.element.dispatchEvent(evt);\n        return this;\n    }\n    init() {\n        this.ulArr = [].slice.call(this.element.querySelectorAll(this.config.subMenu));\n        for (const ul of this.ulArr) {\n            const li = ul.parentNode;\n            ul.classList.add(ClassNames.collapseClass);\n            if (li.classList.contains(ClassNames.activeClass)) {\n                this.show(ul);\n            }\n            else {\n                this.hide(ul);\n            }\n            const a = li.querySelector(this.config.triggerElement);\n            if (a.getAttribute(\"aria-disabled\") === \"true\") {\n                return;\n            }\n            a.setAttribute(\"aria-expanded\", \"false\");\n            const listenerOb = {\n                aClick: [\"click\", a, this.clickEvent.bind(this)]\n            };\n            for (const key in listenerOb) {\n                if (listenerOb.hasOwnProperty(key)) {\n                    const listener = listenerOb[key];\n                    listener[1].addEventListener(listener[0], listener[2]);\n                }\n            }\n            this.listenerOb.push(listenerOb);\n        }\n    }\n    clickEvent(ev) {\n        if (!this.disposed) {\n            if (ev.currentTarget.tagName === \"A\") {\n                ev.preventDefault();\n            }\n            const li = ev.target.parentNode;\n            const ul = li.querySelector(this.config.subMenu);\n            this.toggle(ul);\n        }\n    }\n    toggle(ul) {\n        if (ul.parentNode.classList.contains(ClassNames.activeClass)) {\n            this.hide(ul);\n        }\n        else {\n            this.show(ul);\n        }\n    }\n    show(ul) {\n        if (this.isTransitioning ||\n            ul.classList.contains(ClassNames.collapseInClass)) {\n            return;\n        }\n        const complete = () => {\n            ul.classList.remove(ClassNames.collapsingClass);\n            ul.style.height = \"\";\n            ul.removeEventListener(\"transitionend\", complete);\n            this.setTransitioning(false);\n            this.emit(\"shown.metisMenu\", {\n                shownElement: ul\n            });\n        };\n        const li = ul.parentNode;\n        li.classList.add(ClassNames.activeClass);\n        const a = li.querySelector(this.config.triggerElement);\n        a.setAttribute(\"aria-expanded\", \"true\");\n        ul.style.height = \"0px\";\n        ul.classList.remove(ClassNames.collapseClass);\n        ul.classList.remove(ClassNames.collapseInClass);\n        ul.classList.add(ClassNames.collapsingClass);\n        const eleParentSiblins = [].slice\n            .call(li.parentNode.children)\n            .filter(c => c !== li);\n        if (this.config.toggle && eleParentSiblins.length > 0) {\n            for (const sibli of eleParentSiblins) {\n                const sibUl = sibli.querySelector(this.config.subMenu);\n                if (sibUl !== null) {\n                    this.hide(sibUl);\n                }\n            }\n        }\n        this.setTransitioning(true);\n        ul.classList.add(ClassNames.collapseClass);\n        ul.classList.add(ClassNames.collapseInClass);\n        ul.style.height = ul.scrollHeight + \"px\";\n        this.emit(\"show.metisMenu\", {\n            showElement: ul\n        });\n        ul.addEventListener(\"transitionend\", complete);\n    }\n    hide(ul) {\n        if (this.isTransitioning ||\n            !ul.classList.contains(ClassNames.collapseInClass)) {\n            return;\n        }\n        this.emit(\"hide.metisMenu\", {\n            hideElement: ul\n        });\n        const li = ul.parentNode;\n        li.classList.remove(ClassNames.activeClass);\n        const complete = () => {\n            ul.classList.remove(ClassNames.collapsingClass);\n            ul.classList.add(ClassNames.collapseClass);\n            ul.removeEventListener(\"transitionend\", complete);\n            this.setTransitioning(false);\n            this.emit(\"hidden.metisMenu\", {\n                hiddenElement: ul\n            });\n        };\n        ul.style.height = ul.getBoundingClientRect().height + \"px\";\n        ul.style.height = ul.offsetHeight + \"px\";\n        ul.classList.add(ClassNames.collapsingClass);\n        ul.classList.remove(ClassNames.collapseClass);\n        ul.classList.remove(ClassNames.collapseInClass);\n        this.setTransitioning(true);\n        ul.addEventListener(\"transitionend\", complete);\n        ul.style.height = \"0px\";\n        const a = li.querySelector(this.config.triggerElement);\n        a.setAttribute(\"aria-expanded\", \"false\");\n    }\n    setTransitioning(isTransitioning) {\n        this.isTransitioning = isTransitioning;\n    }\n}\nexport default MetisMenu;\n"],"names":["Default","parentTrigger","subMenu","toggle","triggerElement","ClassNames","activeClass","collapseClass","collapseInClass","collapsingClass","MetisMenu","element","options","document","querySelector","cacheEl","config","cacheConfig","disposed","ulArr","listenerOb","init","update","dispose","lo","key","hasOwnProperty","el","removeEventListener","on","event","fn","addEventListener","off","emit","eventDetail","shouldBubble","evt","CustomEvent","bubbles","detail","createEvent","initCustomEvent","dispatchEvent","slice","call","querySelectorAll","ul","li","parentNode","classList","add","contains","show","hide","a","getAttribute","setAttribute","aClick","clickEvent","bind","listener","push","ev","currentTarget","tagName","preventDefault","target","isTransitioning","complete","remove","style","height","setTransitioning","shownElement","eleParentSiblins","children","filter","c","length","sibli","sibUl","scrollHeight","showElement","hideElement","hiddenElement","getBoundingClientRect","offsetHeight"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAO,IAAMA,UAAU;EACnBC,iBAAe,IADI;EAEnBC,WAAS,IAFU;EAGnBC,UAAQ,IAHW;EAInBC,kBAAgB;EAJG,CAAhB;AAMP,EAAO,IAAMC,aAAa;EACtBC,eAAa,QADS;EAEtBC,iBAAe,UAFO;EAGtBC,mBAAiB,IAHK;EAItBC,mBAAiB;EAJK,CAAnB;;MCLDC;;;EACF,qBAAYC,OAAZ,EAAqBC,OAArB,EAA8B;EAC1B,SAAKD,OAAL,GACI,OAAOA,OAAP,KAAmB,QAAnB,GAA8BE,SAASC,aAAT,CAAuBH,OAAvB,CAA9B,GAAgEA,OADpE;EAEA,SAAKI,OAAL,GAAe,KAAKJ,OAApB;EACA,SAAKK,MAAL,qBAAmBhB,OAAnB,EAA+BY,OAA/B;EACA,SAAKK,WAAL,GAAmB,KAAKD,MAAxB;EACA,SAAKE,QAAL,GAAgB,KAAhB;EACA,SAAKC,KAAL,GAAa,EAAb;EACA,SAAKC,UAAL,GAAkB,EAAlB;EACA,SAAKC,IAAL;EACH;;;;WACDC,2BAAS;EACL,SAAKJ,QAAL,GAAgB,KAAhB;EACA,SAAKP,OAAL,GAAe,KAAKI,OAApB;EACA,SAAKC,MAAL,GAAc,KAAKC,WAAnB;EACA,SAAKI,IAAL;EACH;;WACDE,6BAAU;EACN,yBAAiB,KAAKH,UAAtB,kHAAkC;EAAA;;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;;EAAA,UAAvBI,EAAuB;;EAC9B,WAAK,IAAMC,GAAX,IAAkBD,EAAlB,EAAsB;EAClB,YAAIA,GAAGE,cAAH,CAAkBD,GAAlB,CAAJ,EAA4B;EACxB,cAAME,KAAKH,GAAGC,GAAH,CAAX;EACAE,aAAG,CAAH,EAAMC,mBAAN,CAA0BD,GAAG,CAAH,CAA1B,EAAiCA,GAAG,CAAH,CAAjC;EACH;EACJ;EACJ;;EACD,SAAKR,KAAL,GAAa,EAAb;EACA,SAAKC,UAAL,GAAkB,EAAlB;EACA,SAAKJ,MAAL,GAAc,IAAd;EACA,SAAKL,OAAL,GAAe,IAAf;EACA,SAAKO,QAAL,GAAgB,IAAhB;EACH;;WACDW,iBAAGC,OAAOC,IAAI;EACV,SAAKpB,OAAL,CAAaqB,gBAAb,CAA8BF,KAA9B,EAAqCC,EAArC,EAAyC,KAAzC;EACA,WAAO,IAAP;EACH;;WACDE,mBAAIH,OAAOC,IAAI;EACX,SAAKpB,OAAL,CAAaiB,mBAAb,CAAiCE,KAAjC,EAAwCC,EAAxC;EACA,WAAO,IAAP;EACH;;WACDG,qBAAKJ,OAAOK,aAAaC,cAAsB;EAAA,QAAtBA,YAAsB;EAAtBA,kBAAsB,GAAP,KAAO;EAAA;;EAC3C,QAAIC,GAAJ;;EACA,QAAI,OAAOC,WAAP,KAAuB,UAA3B,EAAuC;EACnCD,YAAM,IAAIC,WAAJ,CAAgBR,KAAhB,EAAuB;EACzBS,iBAASH,YADgB;EAEzBI,gBAAQL;EAFiB,OAAvB,CAAN;EAIH,KALD,MAMK;EACDE,YAAMxB,SAAS4B,WAAT,CAAqB,aAArB,CAAN;EACAJ,UAAIK,eAAJ,CAAoBZ,KAApB,EAA2BM,YAA3B,EAAyC,KAAzC,EAAgDD,WAAhD;EACH;;EACD,SAAKxB,OAAL,CAAagC,aAAb,CAA2BN,GAA3B;EACA,WAAO,IAAP;EACH;;WACDhB,uBAAO;EACH,SAAKF,KAAL,GAAa,GAAGyB,KAAH,CAASC,IAAT,CAAc,KAAKlC,OAAL,CAAamC,gBAAb,CAA8B,KAAK9B,MAAL,CAAYd,OAA1C,CAAd,CAAb;;EACA,0BAAiB,KAAKiB,KAAtB,yHAA6B;EAAA;;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;;EAAA,UAAlB4B,EAAkB;EACzB,UAAMC,KAAKD,GAAGE,UAAd;EACAF,SAAGG,SAAH,CAAaC,GAAb,CAAiB9C,WAAWE,aAA5B;;EACA,UAAIyC,GAAGE,SAAH,CAAaE,QAAb,CAAsB/C,WAAWC,WAAjC,CAAJ,EAAmD;EAC/C,aAAK+C,IAAL,CAAUN,EAAV;EACH,OAFD,MAGK;EACD,aAAKO,IAAL,CAAUP,EAAV;EACH;;EACD,UAAMQ,IAAIP,GAAGlC,aAAH,CAAiB,KAAKE,MAAL,CAAYZ,cAA7B,CAAV;;EACA,UAAImD,EAAEC,YAAF,CAAe,eAAf,MAAoC,MAAxC,EAAgD;EAC5C;EACH;;EACDD,QAAEE,YAAF,CAAe,eAAf,EAAgC,OAAhC;EACA,UAAMrC,aAAa;EACfsC,gBAAQ,CAAC,OAAD,EAAUH,CAAV,EAAa,KAAKI,UAAL,CAAgBC,IAAhB,CAAqB,IAArB,CAAb;EADO,OAAnB;;EAGA,WAAK,IAAMnC,GAAX,IAAkBL,UAAlB,EAA8B;EAC1B,YAAIA,WAAWM,cAAX,CAA0BD,GAA1B,CAAJ,EAAoC;EAChC,cAAMoC,WAAWzC,WAAWK,GAAX,CAAjB;EACAoC,mBAAS,CAAT,EAAY7B,gBAAZ,CAA6B6B,SAAS,CAAT,CAA7B,EAA0CA,SAAS,CAAT,CAA1C;EACH;EACJ;;EACD,WAAKzC,UAAL,CAAgB0C,IAAhB,CAAqB1C,UAArB;EACH;EACJ;;WACDuC,iCAAWI,IAAI;EACX,QAAI,CAAC,KAAK7C,QAAV,EAAoB;EAChB,UAAI6C,GAAGC,aAAH,CAAiBC,OAAjB,KAA6B,GAAjC,EAAsC;EAClCF,WAAGG,cAAH;EACH;;EACD,UAAMlB,KAAKe,GAAGI,MAAH,CAAUlB,UAArB;EACA,UAAMF,KAAKC,GAAGlC,aAAH,CAAiB,KAAKE,MAAL,CAAYd,OAA7B,CAAX;EACA,WAAKC,MAAL,CAAY4C,EAAZ;EACH;EACJ;;WACD5C,yBAAO4C,IAAI;EACP,QAAIA,GAAGE,UAAH,CAAcC,SAAd,CAAwBE,QAAxB,CAAiC/C,WAAWC,WAA5C,CAAJ,EAA8D;EAC1D,WAAKgD,IAAL,CAAUP,EAAV;EACH,KAFD,MAGK;EACD,WAAKM,IAAL,CAAUN,EAAV;EACH;EACJ;;WACDM,qBAAKN,IAAI;EAAA;;EACL,QAAI,KAAKqB,eAAL,IACArB,GAAGG,SAAH,CAAaE,QAAb,CAAsB/C,WAAWG,eAAjC,CADJ,EACuD;EACnD;EACH;;EACD,QAAM6D,WAAW,SAAXA,QAAW,GAAM;EACnBtB,SAAGG,SAAH,CAAaoB,MAAb,CAAoBjE,WAAWI,eAA/B;EACAsC,SAAGwB,KAAH,CAASC,MAAT,GAAkB,EAAlB;EACAzB,SAAGnB,mBAAH,CAAuB,eAAvB,EAAwCyC,QAAxC;;EACA,YAAKI,gBAAL,CAAsB,KAAtB;;EACA,YAAKvC,IAAL,CAAU,iBAAV,EAA6B;EACzBwC,sBAAc3B;EADW,OAA7B;EAGH,KARD;;EASA,QAAMC,KAAKD,GAAGE,UAAd;EACAD,OAAGE,SAAH,CAAaC,GAAb,CAAiB9C,WAAWC,WAA5B;EACA,QAAMiD,IAAIP,GAAGlC,aAAH,CAAiB,KAAKE,MAAL,CAAYZ,cAA7B,CAAV;EACAmD,MAAEE,YAAF,CAAe,eAAf,EAAgC,MAAhC;EACAV,OAAGwB,KAAH,CAASC,MAAT,GAAkB,KAAlB;EACAzB,OAAGG,SAAH,CAAaoB,MAAb,CAAoBjE,WAAWE,aAA/B;EACAwC,OAAGG,SAAH,CAAaoB,MAAb,CAAoBjE,WAAWG,eAA/B;EACAuC,OAAGG,SAAH,CAAaC,GAAb,CAAiB9C,WAAWI,eAA5B;EACA,QAAMkE,mBAAmB,GAAG/B,KAAH,CACpBC,IADoB,CACfG,GAAGC,UAAH,CAAc2B,QADC,EAEpBC,MAFoB,CAEb;EAAA,aAAKC,MAAM9B,EAAX;EAAA,KAFa,CAAzB;;EAGA,QAAI,KAAKhC,MAAL,CAAYb,MAAZ,IAAsBwE,iBAAiBI,MAAjB,GAA0B,CAApD,EAAuD;EACnD,4BAAoBJ,gBAApB,yHAAsC;EAAA;;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;;EAAA,YAA3BK,KAA2B;EAClC,YAAMC,QAAQD,MAAMlE,aAAN,CAAoB,KAAKE,MAAL,CAAYd,OAAhC,CAAd;;EACA,YAAI+E,UAAU,IAAd,EAAoB;EAChB,eAAK3B,IAAL,CAAU2B,KAAV;EACH;EACJ;EACJ;;EACD,SAAKR,gBAAL,CAAsB,IAAtB;EACA1B,OAAGG,SAAH,CAAaC,GAAb,CAAiB9C,WAAWE,aAA5B;EACAwC,OAAGG,SAAH,CAAaC,GAAb,CAAiB9C,WAAWG,eAA5B;EACAuC,OAAGwB,KAAH,CAASC,MAAT,GAAkBzB,GAAGmC,YAAH,GAAkB,IAApC;EACA,SAAKhD,IAAL,CAAU,gBAAV,EAA4B;EACxBiD,mBAAapC;EADW,KAA5B;EAGAA,OAAGf,gBAAH,CAAoB,eAApB,EAAqCqC,QAArC;EACH;;WACDf,qBAAKP,IAAI;EAAA;;EACL,QAAI,KAAKqB,eAAL,IACA,CAACrB,GAAGG,SAAH,CAAaE,QAAb,CAAsB/C,WAAWG,eAAjC,CADL,EACwD;EACpD;EACH;;EACD,SAAK0B,IAAL,CAAU,gBAAV,EAA4B;EACxBkD,mBAAarC;EADW,KAA5B;EAGA,QAAMC,KAAKD,GAAGE,UAAd;EACAD,OAAGE,SAAH,CAAaoB,MAAb,CAAoBjE,WAAWC,WAA/B;;EACA,QAAM+D,WAAW,SAAXA,QAAW,GAAM;EACnBtB,SAAGG,SAAH,CAAaoB,MAAb,CAAoBjE,WAAWI,eAA/B;EACAsC,SAAGG,SAAH,CAAaC,GAAb,CAAiB9C,WAAWE,aAA5B;EACAwC,SAAGnB,mBAAH,CAAuB,eAAvB,EAAwCyC,QAAxC;;EACA,aAAKI,gBAAL,CAAsB,KAAtB;;EACA,aAAKvC,IAAL,CAAU,kBAAV,EAA8B;EAC1BmD,uBAAetC;EADW,OAA9B;EAGH,KARD;;EASAA,OAAGwB,KAAH,CAASC,MAAT,GAAkBzB,GAAGuC,qBAAH,GAA2Bd,MAA3B,GAAoC,IAAtD;EACAzB,OAAGwB,KAAH,CAASC,MAAT,GAAkBzB,GAAGwC,YAAH,GAAkB,IAApC;EACAxC,OAAGG,SAAH,CAAaC,GAAb,CAAiB9C,WAAWI,eAA5B;EACAsC,OAAGG,SAAH,CAAaoB,MAAb,CAAoBjE,WAAWE,aAA/B;EACAwC,OAAGG,SAAH,CAAaoB,MAAb,CAAoBjE,WAAWG,eAA/B;EACA,SAAKiE,gBAAL,CAAsB,IAAtB;EACA1B,OAAGf,gBAAH,CAAoB,eAApB,EAAqCqC,QAArC;EACAtB,OAAGwB,KAAH,CAASC,MAAT,GAAkB,KAAlB;EACA,QAAMjB,IAAIP,GAAGlC,aAAH,CAAiB,KAAKE,MAAL,CAAYZ,cAA7B,CAAV;EACAmD,MAAEE,YAAF,CAAe,eAAf,EAAgC,OAAhC;EACH;;WACDgB,6CAAiBL,iBAAiB;EAC9B,SAAKA,eAAL,GAAuBA,eAAvB;EACH;;;;;;;;;;;"}