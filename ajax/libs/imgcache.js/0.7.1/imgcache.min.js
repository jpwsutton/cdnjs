var ImgCache={version:"0.7.1",options:{debug:!1,localCacheFolder:"imgcache",useDataURI:!1,chromeQuota:10485760,usePersistentCache:!0,cacheClearSize:0,headers:{},skipURIencoding:!1},jQuery:!(!window.jQuery&&!window.Zepto),ready:!1,attributes:{}};!function(e){"use strict";var t={};t.logging=function(e,t){ImgCache.options.debug&&(ImgCache.options.customLogger?ImgCache.options.customLogger(e,t):(1===t&&(e="INFO: "+e),2===t&&(e="WARN: "+e),3===t&&(e="ERROR: "+e),console.log(e)))},t.sanitizeURI=function(e){if(ImgCache.options.skipURIencoding)return e;return encodeURI(e)},t.URI=function(e){e||(e="");var t=e.match(/^(?:([^:\/?\#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)(?:\?([^\#]*))?(?:\#(.*))?/);this.scheme=t[1]||null,this.authority=t[2]||null,this.path=t[3]||null,this.query=t[4]||null,this.fragment=t[5]||null},t.URIGetFileName=function(e){if(e){var t=e.lastIndexOf("/");if(t)return e.substr(t+1).toLowerCase()}},t.URIGetPath=function(e){if(e){return t.URI(e).path.toLowerCase()}},t.isFunction=function(e){return"function"==typeof e},t.FileGetExtension=function(e){if(!e)return"";var t=(e=e.split("?")[0]).split(".").pop();return!t||t.length>4?"":t},t.EntryGetPath=function(e){return t.isCordova()&&t.isFunction(e.toURL)?e.toURL():e.fullPath},t.getCordovaStorageType=function(e){if("undefined"!=typeof LocalFileSystem){if(e&&LocalFileSystem.hasOwnProperty("PERSISTENT"))return LocalFileSystem.PERSISTENT;if(!e&&LocalFileSystem.hasOwnProperty("TEMPORARY"))return LocalFileSystem.TEMPORARY}return e?window.PERSISTENT:window.TEMPORARY},t.isCordova=function(){return"undefined"!=typeof cordova||"undefined"!=typeof phonegap},t.isCordovaAndroid=function(){return t.isCordova()&&device&&device.platform&&device.platform.indexOf("android")>=0},t.SHA1=function(e){function t(e,t,o){for(;0<o--;)e.push(t)}function o(e,t){return e<<t|e>>>32-t}function a(e,t,o){return e^t^o}function n(e,t){var o=(65535&t)+(65535&e);return(65535&(t>>>16)+(e>>>16)+(o>>>16))<<16|65535&o}var i="0123456789abcdef";return function(e){for(var t,o=[],a=4*e.length,n=0;n<a;n++)t=e[n>>2]>>8*(3-n%4),o.push(i.charAt(t>>4&15)+i.charAt(15&t));return o.join("")}(function(e,i){var r,c,g,u,s,l=e.length,d=1732584193,h=4023233417,f=2562383102,m=271733878,C=3285377520,I=[];t(I,1518500249,20),t(I,1859775393,20),t(I,2400959708,20),t(I,3395469782,20),e[i>>5]|=128<<24-i%32,e[15+(i+65>>9<<4)]=i;for(var v=0;v<l;v+=16){r=d,c=h,g=f,u=m,s=C;for(var p=0,b=[];p<80;p++){b[p]=p<16?e[p+v]:o(b[p-3]^b[p-8]^b[p-14]^b[p-16],1);var F=function(e,t,o,a,n){var i=(65535&n)+(65535&e)+(65535&t)+(65535&o)+(65535&a);return(65535&(n>>>16)+(e>>>16)+(t>>>16)+(o>>>16)+(a>>>16)+(i>>>16))<<16|65535&i}(p<20?c&g^~c&u:p<40?a(c,g,u):p<60?c&g^c&u^g&u:a(c,g,u),s,I[p],b[p],o(r,5));s=u,u=g,g=o(c,30),c=r,r=F}d=n(d,r),h=n(h,c),f=n(f,g),m=n(m,u),C=n(C,s)}return[d,h,f,m,C]}(function(e){for(var t=[],o=8*e.length,a=0;a<o;a+=8)t[a>>5]|=(255&e.charCodeAt(a/8))<<24-a%32;return t}(e).slice(),8*e.length))};var o={};o.trigger=function(t,o){ImgCache.jQuery?e(t).trigger(o):(window.CustomEvent||(window.CustomEvent=function(e,t){var o;t=t||{bubbles:!1,cancelable:!1,detail:void 0};try{(o=document.createEvent("CustomEvent")).initCustomEvent(e,t.bubbles,t.cancelable,t.detail)}catch(a){(o=document.createEvent("Event")).initEvent(e,t.bubbles,t.cancelable),o.detail=t.detail}return o}),t.dispatchEvent(new CustomEvent(o)))},o.removeAttribute=function(e,t){ImgCache.jQuery?e.removeAttr(t):e.removeAttribute(t)},o.setAttribute=function(e,t,o){ImgCache.jQuery?e.attr(t,o):e.setAttribute(t,o)},o.getAttribute=function(e,t){return ImgCache.jQuery?e.attr(t):e.getAttribute(t)},o.getBackgroundImage=function(e){if(ImgCache.jQuery)return e.css("background-image");var t=window.getComputedStyle(e,null);if(t)return t.backgroundImage},o.setBackgroundImage=function(e,t){ImgCache.jQuery?e.css("background-image",t):e.style.backgroundImage=t};var a={attributes:{}};a.isImgCacheLoaded=function(){return!(!ImgCache.attributes.filesystem||!ImgCache.attributes.dirEntry)||(t.logging("ImgCache not loaded yet! - Have you called ImgCache.Init() first?",2),!1)},a.attributes.hasLocalStorage=!1,a.hasLocalStorage=function(){if(a.attributes.hasLocalStorage)return a.attributes.hasLocalStorage;try{var e=t.SHA1("imgcache_test");return localStorage.setItem(e,e),localStorage.removeItem(e),a.attributes.hasLocalStorage=!0,!0}catch(e){return t.logging("Could not write to local storage: "+e.message,1),!1}},a.setCurrentSize=function(e){t.logging("current size: "+e,1),a.hasLocalStorage()&&localStorage.setItem("imgcache:"+ImgCache.options.localCacheFolder,e)},a.getCachedFilePath=function(e){return ImgCache.options.localCacheFolder+"/"+a.getCachedFileName(e)},a.getCachedFileFullPath=function(e){var o=t.EntryGetPath(ImgCache.attributes.dirEntry);return(o?o+"/":"/")+a.getCachedFileName(e)},a.getCachedFileName=function(e){if(e){var o=t.SHA1(e),a=t.FileGetExtension(t.URIGetFileName(e));return o+(a?"."+a:"")}t.logging("No source given to getCachedFileName",2)},a.setNewImgPath=function(e,t,a){o.setAttribute(e,"src",t),o.setAttribute(e,n,a)},a.createCacheDir=function(e){if(ImgCache.attributes.filesystem){var a=function(e){t.logging("Failed to get/create local cache directory: "+e.code,3)};ImgCache.attributes.filesystem.root.getDirectory(ImgCache.options.localCacheFolder,{create:!0,exclusive:!1},function(n){ImgCache.attributes.dirEntry=n,t.logging("Local cache folder opened: "+t.EntryGetPath(n),1),t.isCordovaAndroid()?n.getFile(".nomedia",{create:!0,exclusive:!1},function(o){t.logging(".nomedia file created.",1),e&&e()},a):e&&e();ImgCache.ready=!0,o.trigger(document,i)},a)}},a.FileTransferWrapper=function(e){t.isCordova()&&(this.fileTransfer=new FileTransfer),this.filesystem=e},a.FileTransferWrapper.prototype.download=function(e,o,a,n,i){var r=ImgCache.options.headers||{};if(this.fileTransfer)return t.isFunction(i)&&(this.fileTransfer.onprogress=i),this.fileTransfer.download(e,o,a,n,!1,{headers:r});var c=this.filesystem,g=function(a,n,i){t.logging(a,n),i&&i({code:0,source:e,target:o})},u=new XMLHttpRequest;u.open("GET",e,!0),t.isFunction(i)&&(u.onprogress=i),u.responseType="blob";for(var s in r)u.setRequestHeader(s,r[s]);u.onload=function(t){!u.response||200!==u.status&&0!==u.status?g("Image "+e+" could not be downloaded - status: "+u.status,3,n):c.root.getFile(o,{create:!0},function(e){e.createWriter(function(t){t.onerror=n,t.onwriteend=function(){a(e)},t.write(u.response,n)},n)},n)},u.onerror=function(){g("XHR error - Image "+e+" could not be downloaded - status: "+u.status,3,n)},u.send()},a.getFileEntryURL=function(e){return e.toURL?e.toURL():e.toURI()},a.getBackgroundImageURL=function(e){var t=o.getBackgroundImage(e);if(t){return/\((.+)\)/.exec(t)[1]}},a.loadCachedFile=function(e,o,n,i,r){if(a.isImgCacheLoaded()&&e){var c=t.URIGetFileName(o);a.getCachedFileName(o);ImgCache.attributes.filesystem.root.getFile(a.getCachedFilePath(o),{create:!1},function(g){if(ImgCache.options.useDataURI)g.file(function(a){var g=new FileReader;g.onloadend=function(a){var g=a.target.result;if(!g)return t.logging("File in cache "+c+" is empty",2),void(r&&r(e));n(e,g,o),t.logging("File "+c+" loaded from cache",1),i&&i(e)},g.readAsDataURL(a)},function(o){t.logging("Failed to read file "+o.code,3),r&&r(e)});else{var u=a.getFileEntryURL(g);n(e,u,o),t.logging("File "+c+" loaded from cache",1),i&&i(e)}},function(o){t.logging("File "+c+" not in cache",1),r&&r(e)})}};var n="data-old-src",i="ImgCacheReady";ImgCache.init=function(e,o){ImgCache.attributes.init_callback=e;var n=function(e){t.logging("LocalFileSystem opened",1),ImgCache.attributes.filesystem=e,a.createCacheDir(function(){!function(e){ImgCache.options.cacheClearSize>0&&ImgCache.getCurrentSize()>1024*ImgCache.options.cacheClearSize*1024?ImgCache.clearCache(e,e):e&&e()}(ImgCache.attributes.init_callback)})},i=function(e){t.logging("Failed to initialise LocalFileSystem "+e.code,3),o&&o()};if(t.isCordova())window.requestFileSystem(t.getCordovaStorageType(ImgCache.options.usePersistentCache),0,n,i);else{if(window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.storageInfo=window.storageInfo||(ImgCache.options.usePersistentCache?navigator.webkitPersistentStorage:navigator.webkitTemporaryStorage),!window.storageInfo)return t.logging("Your browser does not support the html5 File API",2),void(o&&o());var r=ImgCache.options.chromeQuota;window.storageInfo.requestQuota(r,function(){var e=ImgCache.options.usePersistentCache?window.storageInfo.PERSISTENT:window.storageInfo.TEMPORARY;window.requestFileSystem(e,r,n,i)},function(e){t.logging("Failed to request quota: "+e.message,3),o&&o()})}},ImgCache.getCurrentSize=function(){if(a.hasLocalStorage()){var e=localStorage.getItem("imgcache:"+ImgCache.options.localCacheFolder);return null===e?0:parseInt(e,10)}return 0},ImgCache.cacheFile=function(e,o,n,i){if(a.isImgCacheLoaded()&&e){e=t.sanitizeURI(e);var r=a.getCachedFileFullPath(e);new a.FileTransferWrapper(ImgCache.attributes.filesystem).download(e,r,function(e){e.getMetadata(function(e){e&&e.hasOwnProperty("size")?(t.logging("Cached file size: "+e.size,1),a.setCurrentSize(ImgCache.getCurrentSize()+parseInt(e.size,10))):t.logging("No metadata size property available",1)}),t.logging("Download complete: "+t.EntryGetPath(e),1),e.setMetadata&&e.setMetadata(function(){t.logging("com.apple.MobileBackup metadata set",1)},function(){t.logging("com.apple.MobileBackup metadata could not be set",2)},{"com.apple.MobileBackup":1}),o&&o()},function(e){e.source&&t.logging("Download error source: "+e.source,3),e.target&&t.logging("Download error target: "+e.target,3),t.logging("Download error code: "+e.code,3),n&&n()},i)}},ImgCache.getCachedFile=function(e,o){if(a.isImgCacheLoaded()&&o){e=t.sanitizeURI(e);var n=a.getCachedFilePath(e);t.isCordovaAndroid()&&0===n.indexOf("file://")&&(n=n.substr(7)),ImgCache.attributes.filesystem.root.getFile(n,{create:!1},function(t){o(e,t)},function(){o(e,null)})}},ImgCache.isCached=function(e,t){ImgCache.getCachedFile(e,function(e,o){t(e,null!==o)})},ImgCache.useOnlineFile=function(e){if(a.isImgCacheLoaded()&&e){var t=o.getAttribute(e,n);t&&o.setAttribute(e,"src",t),o.removeAttribute(e,n)}},ImgCache.useCachedFile=function(e,t,n){a.isImgCacheLoaded()&&a.loadCachedFile(e,o.getAttribute(e,"src"),a.setNewImgPath,t,n)},ImgCache.useCachedFileWithSource=function(e,o,n,i){if(a.isImgCacheLoaded()){var r=t.sanitizeURI(o);a.loadCachedFile(e,r,a.setNewImgPath,n,i)}},ImgCache.clearCache=function(e,o){a.isImgCacheLoaded()&&ImgCache.attributes.dirEntry.removeRecursively(function(o){t.logging("Local cache cleared",1),a.setCurrentSize(0),a.createCacheDir(e)},function(e){t.logging("Failed to remove directory or its contents: "+e.code,3),o&&o()})},ImgCache.removeFile=function(e,o,n){e=t.sanitizeURI(e);var i=a.getCachedFilePath(e),r=function(e){t.logging("Failed to remove file due to "+e.code,3),n&&n()};ImgCache.attributes.filesystem.root.getFile(i,{create:!1},function(e){e.remove(function(e){o&&o()},r)},r)},ImgCache.cacheBackground=function(e,o,n,i){if(a.isImgCacheLoaded()){var r=a.getBackgroundImageURL(e);if(!r)return t.logging("No background to cache",2),void(n&&n());t.logging("Background image URL: "+r,1),ImgCache.cacheFile(r,o,n,i)}},ImgCache.useCachedBackground=function(e,n,i){if(a.isImgCacheLoaded()){var r=a.getBackgroundImageURL(e);if(!r)return t.logging("No background to cache",2),void(i&&i());a.loadCachedFile(e,r,function(e,t,a){o.setBackgroundImage(e,'url("'+t+'")'),o.setAttribute(e,"data-old-background",a)},n,i)}},ImgCache.useBackgroundOnlineFile=function(e){if(e){var t=o.getAttribute(e,"data-old-background");t&&o.setBackgroundImage(e,'url("'+t+'")'),o.removeAttribute(e,"data-old-background")}},ImgCache.getCacheFolderURI=function(){if(a.isImgCacheLoaded())return a.getFileEntryURL(ImgCache.attributes.dirEntry)},t.isFunction(define)&&define.amd?define("imgcache",[],function(){return ImgCache}):"object"==typeof module&&module.exports?module.exports=ImgCache:this.ImgCache=ImgCache}(window.jQuery||window.Zepto||function(){throw"jQuery is not available"});