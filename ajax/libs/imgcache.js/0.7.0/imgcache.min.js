var ImgCache={version:"0.7.0",options:{debug:!1,localCacheFolder:"imgcache",useDataURI:!1,chromeQuota:10485760,usePersistentCache:!0,cacheClearSize:0},jQuery:!(!window.jQuery&&!window.Zepto),ready:!1,attributes:{}};!function(e){ImgCache.init=function(e,n){ImgCache.attributes.init_callback=e;var c=function(e){a.logging("LocalFileSystem opened",o),ImgCache.attributes.filesystem=e,t.createCacheDir(function(){u(ImgCache.attributes.init_callback)})},g=function(e){a.logging("Failed to initialise LocalFileSystem "+e.code,r),n&&n()},u=function(e){if(ImgCache.options.cacheClearSize>0){ImgCache.getCurrentSize()>1024*ImgCache.options.cacheClearSize*1024?ImgCache.clearCache(e,e):e&&e()}else e&&e()};if(t.isCordova()){l=a.getCordovaStorageType(ImgCache.options.usePersistentCache);window.requestFileSystem(l,0,c,g)}else{if(window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.storageInfo=window.storageInfo||(ImgCache.options.usePersistentCache?navigator.webkitPersistentStorage:navigator.webkitTemporaryStorage),!window.storageInfo)return a.logging("Your browser does not support the html5 File API",i),void(n&&n());var s=ImgCache.options.chromeQuota,l=ImgCache.options.usePersistentCache?window.storageInfo.PERSISTENT:window.storageInfo.TEMPORARY;window.storageInfo.requestQuota(s,function(){window.requestFileSystem(l,s,c,g)},function(e){a.logging("Failed to request quota: "+e.message,r),n&&n()})}},ImgCache.getCurrentSize=function(){if(t.hasLocalStorage()){var e=localStorage.getItem("imgcache:"+ImgCache.options.localCacheFolder);return null===e?0:parseInt(e)}return 0},ImgCache.cacheFile=function(e,n,c){if(t.isImgCacheLoaded()&&e){e=a.sanitizeURI(e);var g=t.getCachedFileFullPath(e);new t.FileTransferWrapper(ImgCache.attributes.filesystem).download(e,g,function(e){e.getMetadata(function(e){e&&e.hasOwnProperty("size")?(a.logging("Cached file size: "+e.size,o),t.setCurrentSize(ImgCache.getCurrentSize()+parseInt(e.size))):a.logging("No metadata size property available",o)}),a.logging("Download complete: "+a.EntryGetPath(e),o),e.setMetadata&&e.setMetadata(function(){a.logging("com.apple.MobileBackup metadata set",o)},function(){a.logging("com.apple.MobileBackup metadata could not be set",i)},{"com.apple.MobileBackup":1}),n&&n()},function(e){e.source&&a.logging("Download error source: "+e.source,r),e.target&&a.logging("Download error target: "+e.target,r),a.logging("Download error code: "+e.code,r),c&&c()})}},ImgCache.isCached=function(e,o){if(t.isImgCacheLoaded()&&o){e=a.sanitizeURI(e);var i=t.getCachedFilePath(e);t.isCordovaAndroid()&&0==i.indexOf("file://")&&(i=i.substr(7));var r=function(t){o(e,t)};ImgCache.attributes.filesystem.root.getFile(i,{create:!1},function(){r(!0)},function(){r(!1)})}},ImgCache.useOnlineFile=function(e){if(t.isImgCacheLoaded()&&e){var a=n.getAttribute(e,"data-old-src");a&&n.setAttribute(e,"src",a),n.removeAttribute(e,"data-old-src")}},ImgCache.useCachedFile=function(e,a,o){t.isImgCacheLoaded()&&t.loadCachedFile(e,n.getAttribute(e,"src"),t.setNewImgPath,a,o)},ImgCache.useCachedFileWithSource=function(e,o,i,r){if(t.isImgCacheLoaded()){var n=a.sanitizeURI(n);t.loadCachedFile(e,o,t.setNewImgPath,i,r)}},ImgCache.clearCache=function(e,i){t.isImgCacheLoaded()&&ImgCache.attributes.dirEntry.removeRecursively(function(i){a.logging("Local cache cleared",o),t.setCurrentSize(0),t.createCacheDir(e)},function(e){a.logging("Failed to remove directory or its contents: "+e.code,r),i&&i()})},ImgCache.removeFile=function(e,o,i){e=a.sanitizeURI(e);var n=t.getCachedFilePath(e),c=function(e){a.logging("Failed to remove file due to "+e.code,r),i&&i()};ImgCache.attributes.filesystem.root.getFile(n,{create:!1},function(e){e.remove(function(e){o&&o()},c)},c)},ImgCache.cacheBackground=function(e,r,n){if(t.isImgCacheLoaded()){var c=t.getBackgroundImageURL(e);if(!c)return a.logging("No background to cache",i),void(n&&n());a.logging("Background image URL: "+c,o),ImgCache.cacheFile(c,r,n)}},ImgCache.useCachedBackground=function(e,o,r){if(t.isImgCacheLoaded()){var c=t.getBackgroundImageURL(e);if(!c)return a.logging("No background to cache",i),void(r&&r());t.loadCachedFile(e,c,function(e,t,a){n.setBackgroundImage(e,'url("'+t+'")'),n.setAttribute(e,"data-old-background",a)},o,r)}},ImgCache.useBackgroundOnlineFile=function(e){if(e){var t=n.getAttribute(e,"data-old-background");t&&n.setBackgroundImage(e,'url("'+t+'")'),n.removeAttribute(e,"data-old-background")}},ImgCache.getCacheFolderURI=function(){if(t.isImgCacheLoaded())return t.getFileEntryURL(ImgCache.attributes.dirEntry)};var t={attributes:{}};t.isCordova=function(){return"undefined"!=typeof cordova||"undefined"!=typeof phonegap},t.isCordovaAndroid=function(){return t.isCordova()&&device&&device.platform&&device.platform.indexOf("android")>=0},t.isImgCacheLoaded=function(){return!(!ImgCache.attributes.filesystem||!ImgCache.attributes.dirEntry)||(a.logging("ImgCache not loaded yet! - Have you called ImgCache.Init() first?",i),!1)},t.attributes.hasLocalStorage=!1,t.hasLocalStorage=function(){if(t.attributes.hasLocalStorage)return t.attributes.hasLocalStorage;try{var e=a.SHA1("imgcache_test");return localStorage.setItem(e,e),localStorage.removeItem(e),t.attributes.hasLocalStorage=!0,!0}catch(e){return a.logging("Could not write to local storage: "+e.message,o),!1}},t.setCurrentSize=function(e){a.logging("current size: "+e,o),t.hasLocalStorage()&&localStorage.setItem("imgcache:"+ImgCache.options.localCacheFolder,e)},t.getCachedFilePath=function(e){return ImgCache.options.localCacheFolder+"/"+t.getCachedFileName(e)},t.getCachedFileFullPath=function(e){var o=a.EntryGetPath(ImgCache.attributes.dirEntry);return(o?o+"/":"/")+t.getCachedFileName(e)},t.getCachedFileName=function(e){if(e){var t=a.SHA1(e),o=a.FileGetExtension(a.URIGetFileName(e));return t+(o?"."+o:"")}a.logging("No source given to getCachedFileName",i)},t.setNewImgPath=function(e,t,a){n.setAttribute(e,"src",t),n.setAttribute(e,"data-old-src",a)},t.createCacheDir=function(e){if(ImgCache.attributes.filesystem){var i=function(e){a.logging("Failed to get/create local cache directory: "+e.code,r)};ImgCache.attributes.filesystem.root.getDirectory(ImgCache.options.localCacheFolder,{create:!0,exclusive:!1},function(r){ImgCache.attributes.dirEntry=r,a.logging("Local cache folder opened: "+a.EntryGetPath(r),o),t.isCordovaAndroid()?r.getFile(".nomedia",{create:!0,exclusive:!1},function(t){a.logging(".nomedia file created.",o),e&&e()},i):e&&e();ImgCache.ready=!0,n.trigger(document,"ImgCacheReady")},i)}},t.FileTransferWrapper=function(e){t.isCordova()&&(this.fileTransfer=new FileTransfer),this.filesystem=e},t.FileTransferWrapper.prototype.download=function(e,t,o,i){if(this.fileTransfer)return this.fileTransfer.download(e,t,o,i);var r=this.filesystem,n=function(o,i,r){a.logging(o,i),r&&r({code:0,source:e,target:t})},c=new XMLHttpRequest;c.open("GET",e,!0),c.responseType="blob",c.onload=function(a){!c.response||200!=c.status&&0!=c.status?n("Image "+e+" could not be downloaded - status: "+c.status,3,i):r.root.getFile(t,{create:!0},function(e){e.createWriter(function(t){t.onerror=i,t.onwriteend=function(){o(e)},t.write(c.response,i)},i)},i)},c.onerror=function(){n("XHR error - Image "+e+" could not be downloaded - status: "+c.status,3,i)},c.send()},t.getFileEntryURL=function(e){return e.toURL?e.toURL():e.toURI()},t.getBackgroundImageURL=function(e){var t=n.getBackgroundImage(e);if(t){return/\((.+)\)/.exec(t)[1]}},t.loadCachedFile=function(e,n,c,g,u){if(t.isImgCacheLoaded()&&e){var s=a.URIGetFileName(n);t.getCachedFileName(n);ImgCache.attributes.filesystem.root.getFile(t.getCachedFilePath(n),{create:!1},function(l){if(ImgCache.options.useDataURI)l.file(function(t){var r=new FileReader;r.onloadend=function(t){var r=t.target.result;if(!r)return a.logging("File in cache "+s+" is empty",i),void(u&&u(e));c(e,r,n),a.logging("File "+s+" loaded from cache",o),g&&g(e)},r.readAsDataURL(t)},function(t){a.logging("Failed to read file "+t.code,r),u&&u(e)});else{var d=t.getFileEntryURL(l);c(e,d,n),a.logging("File "+s+" loaded from cache",o),g&&g(e)}},function(t){a.logging("File "+s+" not in cache",o),u&&u(e)})}};var a={},o=1,i=2,r=3;a.logging=function(e,t){ImgCache.options.debug&&(ImgCache.options.customLogger?ImgCache.options.customLogger(e,t):(t==o&&(e="INFO: "+e),t==i&&(e="WARN: "+e),t==r&&(e="ERROR: "+e),console.log(e)))},a.sanitizeURI=function(e){return encodeURI(e)},a.URI=function(e){e||(e="");var t=e.match(/^(?:([^:\/?\#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)(?:\?([^\#]*))?(?:\#(.*))?/);this.scheme=t[1]||null,this.authority=t[2]||null,this.path=t[3]||null,this.query=t[4]||null,this.fragment=t[5]||null},a.URIGetFileName=function(e){if(e){var t=e.lastIndexOf("/");if(t)return e.substr(t+1).toLowerCase()}},a.URIGetPath=function(e){if(e){return a.URI(e).path.toLowerCase()}},a.FileGetExtension=function(e){if(!e)return"";var t=(e=e.split("?")[0]).split(".").pop();return!t||t.length>4?"":t},a.EntryGetPath=function(e){return t.isCordova()&&"function"==typeof e.toURL?e.toURL():e.fullPath},a.getCordovaStorageType=function(e){if("undefined"!=typeof LocalFileSystem){if(e&&LocalFileSystem.hasOwnProperty("PERSISTENT"))return LocalFileSystem.PERSISTENT;if(!e&&LocalFileSystem.hasOwnProperty("TEMPORARY"))return LocalFileSystem.TEMPORARY}return e?window.PERSISTENT:window.TEMPORARY},a.SHA1=function(e){function t(e,t,a){for(;0<a--;)e.push(t)}function a(e,t){return e<<t|e>>>32-t}function o(e,t,a){return e^t^a}function i(e,t){var a=(65535&t)+(65535&e);return(65535&(t>>>16)+(e>>>16)+(a>>>16))<<16|65535&a}var r="0123456789abcdef";return function(e){for(var t,a=[],o=4*e.length,i=0;i<o;i++)t=e[i>>2]>>8*(3-i%4),a.push(r.charAt(t>>4&15)+r.charAt(15&t));return a.join("")}(function(e,r){var n,c,g,u,s,l=e.length,d=1732584193,h=4023233417,f=2562383102,m=271733878,C=3285377520,I=[];t(I,1518500249,20),t(I,1859775393,20),t(I,2400959708,20),t(I,3395469782,20),e[r>>5]|=128<<24-r%32,e[15+(r+65>>9<<4)]=r;for(var v=0;v<l;v+=16){n=d,c=h,g=f,u=m,s=C;for(var p=0,y=[];p<80;p++){y[p]=p<16?e[p+v]:a(y[p-3]^y[p-8]^y[p-14]^y[p-16],1);var F=function(e,t,a,o,i){var r=(65535&i)+(65535&e)+(65535&t)+(65535&a)+(65535&o);return(65535&(i>>>16)+(e>>>16)+(t>>>16)+(a>>>16)+(o>>>16)+(r>>>16))<<16|65535&r}(p<20?c&g^~c&u:p<40?o(c,g,u):p<60?c&g^c&u^g&u:o(c,g,u),s,I[p],y[p],a(n,5));s=u,u=g,g=a(c,30),c=n,n=F}d=i(d,n),h=i(h,c),f=i(f,g),m=i(m,u),C=i(C,s)}return[d,h,f,m,C]}(function(e){for(var t=[],a=8*e.length,o=0;o<a;o+=8)t[o>>5]|=(255&e.charCodeAt(o/8))<<24-o%32;return t}(e).slice(),8*e.length))};var n={};n.trigger=function(t,a){ImgCache.jQuery?e(t).trigger(a):t.dispatchEvent(new Event(a))},n.removeAttribute=function(e,t){ImgCache.jQuery?e.removeAttr(t):e.removeAttribute(t)},n.setAttribute=function(e,t,a){ImgCache.jQuery?e.attr(t,a):e.setAttribute(t,a)},n.getAttribute=function(e,t){return ImgCache.jQuery?e.attr(t):e.getAttribute(t)},n.getBackgroundImage=function(e){if(ImgCache.jQuery)return e.css("background-image");var t=window.getComputedStyle(e,null);if(t)return t.backgroundImage},n.setBackgroundImage=function(e,t){ImgCache.jQuery?e.css("background-image",t):e.style.backgroundImage=t}}(window.jQuery||window.Zepto||function(){throw"jQuery is not available"});