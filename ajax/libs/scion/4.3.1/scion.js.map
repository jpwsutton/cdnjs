{"version":3,"sources":["scion.js"],"names":["f","exports","module","define","amd","g","window","global","self","scion","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","prototype","_toConsumableArray","arr","Array","isArray","arr2","from","_classCallCheck","instance","TypeError","_possibleConstructorReturn","ReferenceError","_inherits","subClass","superClass","create","constructor","value","setPrototypeOf","__proto__","base","helpers","query","transitionComparator","Statechart","_base$BaseInterpreter","modelOrModelFactory","opts","legacySemantics","getPrototypeOf","_selectTransitions","currentEvent","selectEventlessTransitions","transitionSelector","enabledTransitions","Set","_evaluateAction","bind","atomicStates","_configuration","iter","sort","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_iterator","Symbol","iterator","_step","next","done","state","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","loop","_iterator2","concat","getAncestors","_step2","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_iterator3","transitions","_step3","add","err","return","priorityEnabledTransitions","_removeConflictingTransition","_log","_this2","filteredTransitions","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_iterator4","_step4","t1","t1Preempted","transitionsToRemove","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_loop","t2","_step5","t1ExitSet","_computeExitSet","t2ExitSet","hasIntersection","some","has","source","id","map","descendants","indexOf","_iterator5","_ret","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_iterator6","_step6","t3","remove","BaseInterpreter","process","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","setTimeout","clearTimeout","runTimeout","fun","runClearTimeout","marker","queue","draining","currentQueue","queueIndex","cleanUpNextTick","drainQueue","timeout","len","run","nextTick","args","arguments","push","Item","array","apply","title","browser","env","argv","version","versions","noop","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","name","binding","cwd","chdir","dir","umask","inherits","ctor","superCtor","super_","TempCtor","isBuffer","arg","copy","fill","readUInt8","formatRegExp","format","isString","objects","inspect","join","str","String","replace","x","Number","JSON","stringify","_","isNull","isObject","deprecate","fn","msg","isUndefined","noDeprecation","warned","deprecated","throwDeprecation","traceDeprecation","console","trace","error","debugs","debugEnviron","debuglog","set","NODE_DEBUG","toUpperCase","RegExp","test","pid","obj","ctx","seen","stylize","stylizeNoColor","depth","colors","isBoolean","showHidden","_extend","customInspect","stylizeWithColor","formatValue","styles","styleType","style","arrayToHash","hash","forEach","val","idx","recurseTimes","isFunction","ret","primitive","formatPrimitive","keys","visibleKeys","getOwnPropertyNames","isError","formatError","isRegExp","toString","isDate","Date","braces","toUTCString","output","formatArray","formatProperty","pop","reduceToSingleString","simple","isNumber","hasOwnProperty","match","desc","getOwnPropertyDescriptor","get","split","line","substr","numLinesEst","reduce","prev","cur","ar","isNullOrUndefined","isSymbol","re","objectToString","d","isPrimitive","pad","months","timestamp","time","getHours","getMinutes","getSeconds","getDate","getMonth","log","origin","prop","ArraySet","delete","union","v","difference","contains","isEmpty","size","equals","s2","STATE_TYPES","BASIC","COMPOSITE","PARALLEL","HISTORY","INITIAL","FINAL","SCXML_IOPROCESSOR_TYPE","HTTP_IOPROCESSOR_TYPE","RX_TRAILING_WILDCARD","_typeof","constants","printTrace","extend","transitionWithTargets","initializeModel","isEventPrefixMatch","isTransitionMatch","scxmlPrefixTransitionSelector","eventlessTransitionSelector","getTransitionWithHigherSourceChildPriority","sortInEntryOrder","getStateWithHigherSourceChildPriority","initializeModelGeneratorFn","deserializeSerializedConfiguration","deserializeHistory","to","k","targets","documentOrder","rootState","idToStateMap","Map","idCount","generateId","type","count","wrapInFakeRootState","$deserializeDatamodel","$serializeDatamodel","$idToStateMap","docUrl","states","$type","statesWithInitialAttributes","transitionToString","sourceState","events","cond","stateToString","populateStateIdMap","j","traverse","ancestors","parent","transition","ancs","typeEnum","isAtomic","b","initialChildren","initial","filter","child","initialRef","checkInitialRef","historyChildren","historyRef","every","handler","invokes","invoke","finalize","connectIntialAttributes","initialStates","initialState","RX_WHITESPACE","connectTransitionGraph","onTransition","event","trim","lcca","getLCCA","scope","getScope","transitionIsReallyInternal","s1","commonAncestors","anc","fakeRootState","prefix","fullName","charAt","eventName","tEvent","evaluator","_args","modelFn","interpreter","_x","_sessionid","_ioprocessors","isIn","serializedConfiguration","serializedHistory","sid","isDescendant","root","index","slice","isOrthogonalTo","isAncestrallyRelatedTo","getLCA","getAncestorsOrSelf","getDescendantsOrSelf","_slicedToArray","sliceIterator","_arr","_n","_d","_e","_i","_s","EventEmitter","util","DEBUG","_EventEmitter","_this","InterpreterScriptingContext","_isStepping","_scriptingContext","interpreterScriptingContext","generateSessionid","sessionid","sessionRegistry","location","scxml","model","parse","_model","priorityComparisonFn","_externalEventQueue","_internalEventQueue","params","snapshot","_historyValue","_isInFinalState","EVENTS","cancel","parentSession","invokeid","_exitInterpreter","_cancelAllDelayedSends","statesToExit","_getFullConfiguration","stateExited","onExit","exitIdx","exitLen","block","blockIdx","blockLen","actionRef","_handleError","cancelInvoke","send","data","donedata","start","_initStart","_performBigStep","getConfiguration","startAsync","cb","genAsync","_this3","nop","getFullConfiguration","stateName","isFinal","keepGoing","allStatesExited","allStatesEntered","_startBigStep2","_startBigStep","_startBigStep3","_selectTransitionsAnd","_selectTransitionsAndPerformSmallStep","_selectTransitionsAnd2","_finishBigStep","selectedTransitions","ev","shift","statesExited","statesEntered","_performSmallStep2","_performSmallStep","_performSmallStep3","_this4","autoforward","action","_this5","statesToInvoke","_timeouts","timeoutOptions","sendOptions","delay","timeoutHandle","_timeoutMap","_performBigStepAsync","_startBigStep4","_startBigStep5","nextStep","_selectTransitionsAnd3","_selectTransitionsAnd4","setImmediate","selectedTransitionsWithTargets","_exitStates","_executeTransitions","_enterStates","basicStatesExited","_getStatesExited2","_getStatesExited","_getStatesExited3","isDeep","s0","transitionList","txIdx","txLen","configList","cfgIdx","cfgLen","ancIdx","ancLen","sortedStatesExited","sortedTransitions","stxIdx","targetIds","_this6","statesForDefaultEntry","defaultHistoryContent","_computeEntrySet","enterIdx","enterLen","stateEntered","onEntry","entryIdx","entryLen","_actionRef","_transition","_actionRef2","grandparent","isInFinalState","_getEffectiveTargetStates","statesToEnter","_addDescendantStatesToEnter","ancestor","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_iterator7","_step7","_addAncestorStatesToEnter","_iteratorNormalCompletion8","_didIteratorError8","_iteratorError8","_iterator8","_step8","_iteratorNormalCompletion9","_didIteratorError9","_iteratorError9","_iterator9","_step9","_this7","_iteratorNormalCompletion10","_didIteratorError10","_iteratorError10","_step10","_iterator10","_iteratorNormalCompletion11","_didIteratorError11","_iteratorError11","_iterator11","_step11","_this8","_iteratorNormalCompletion12","_didIteratorError12","_iteratorError12","_iterator12","_step12","_iteratorNormalCompletion13","_didIteratorError13","_iteratorError13","_iterator13","_step13","_s2","_iteratorNormalCompletion14","_didIteratorError14","_iteratorError14","_iterator14","_step14","_s3","_iteratorNormalCompletion15","_didIteratorError15","_iteratorError15","_iterator15","_step15","_s4","_iteratorNormalCompletion16","_didIteratorError16","_iteratorError16","_iterator16","_step16","_s5","_iteratorNormalCompletion18","_didIteratorError18","_iteratorError18","_iterator18","_step18","targetState","_iteratorNormalCompletion17","_didIteratorError17","_iteratorError17","_iterator17","_step17","_s6","_targets","_iteratorNormalCompletion19","_didIteratorError19","_iteratorError19","_iterator19","_step19","_targetState","_iteratorNormalCompletion20","_didIteratorError20","_iteratorError20","_loop2","_step20","_iterator20","_this9","tagname","column","reason","message","registerListener","listener","unregisterListener","getAllTransitionEvents","getEvents","stateIdx","stateLen","getSnapshot","_serializeHistory","gen","evtObjOrName","optionalData","c","config","sessionIdCounter","_interpreter","_invokeMap","validateUriRegex","invokeSendTargetRegex","scxmlSendTargetRegex","raise","_installDefaultPropsOnEvent","parseXmlStringAsDOM","xmlString","xmlParser","invokeObj","_this10","Promise","resolve","reject","invokers","session","_this11","sessionPromise","then","isInternal","origintype","options","sendType","validateSend","sendAction","targetIsValidUri","sendid","defaultSendAction","_this12","doSend","targetSessionId","invokeId","sendAsync","publish","sendFn","customSend","customCancel","_listeners","_on","_once","__once","_off","splice","_emit","__emit"],"mappings":"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","file":"scion.js","sourcesContent":["(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.scion = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar base = require('scion-core-base'),\n    helpers = base.helpers,\n    query = base.query,\n    transitionComparator = base.helpers.transitionComparator;\n\n/** \n * @description Implements semantics described in Algorithm D of the SCXML specification. \n * See {@link scion.BaseInterpreter} for information on the constructor arguments.\n * @class SCInterpreter \n * @extends BaseInterpreter\n */\n\nvar Statechart = function (_base$BaseInterpreter) {\n  _inherits(Statechart, _base$BaseInterpreter);\n\n  function Statechart(modelOrModelFactory, opts) {\n    _classCallCheck(this, Statechart);\n\n    opts = opts || {};\n    opts.legacySemantics = false;\n\n    return _possibleConstructorReturn(this, (Statechart.__proto__ || Object.getPrototypeOf(Statechart)).call(this, modelOrModelFactory, opts));\n  }\n\n  /** @private */\n\n\n  _createClass(Statechart, [{\n    key: '_selectTransitions',\n    value: function _selectTransitions(currentEvent, selectEventlessTransitions) {\n      var transitionSelector = this.opts.transitionSelector;\n      var enabledTransitions = new this.opts.Set();\n\n      var e = this._evaluateAction.bind(this, currentEvent);\n\n      var atomicStates = this._configuration.iter().sort(transitionComparator);\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = atomicStates[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var state = _step.value;\n          var _iteratorNormalCompletion2 = true;\n          var _didIteratorError2 = false;\n          var _iteratorError2 = undefined;\n\n          try {\n            loop: for (var _iterator2 = [state].concat(query.getAncestors(state))[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n              var s = _step2.value;\n              var _iteratorNormalCompletion3 = true;\n              var _didIteratorError3 = false;\n              var _iteratorError3 = undefined;\n\n              try {\n                for (var _iterator3 = s.transitions[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n                  var t = _step3.value;\n\n                  if (transitionSelector(t, currentEvent, e, selectEventlessTransitions)) {\n                    enabledTransitions.add(t);\n                    break loop;\n                  }\n                }\n              } catch (err) {\n                _didIteratorError3 = true;\n                _iteratorError3 = err;\n              } finally {\n                try {\n                  if (!_iteratorNormalCompletion3 && _iterator3.return) {\n                    _iterator3.return();\n                  }\n                } finally {\n                  if (_didIteratorError3) {\n                    throw _iteratorError3;\n                  }\n                }\n              }\n            }\n          } catch (err) {\n            _didIteratorError2 = true;\n            _iteratorError2 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion2 && _iterator2.return) {\n                _iterator2.return();\n              }\n            } finally {\n              if (_didIteratorError2) {\n                throw _iteratorError2;\n              }\n            }\n          }\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      var priorityEnabledTransitions = this._removeConflictingTransition(enabledTransitions);\n\n      this._log(\"priorityEnabledTransitions\", priorityEnabledTransitions);\n\n      return priorityEnabledTransitions;\n    }\n\n    /** @private */\n\n  }, {\n    key: '_removeConflictingTransition',\n    value: function _removeConflictingTransition(enabledTransitions) {\n      var _this2 = this;\n\n      var filteredTransitions = new this.opts.Set();\n      //toList sorts the transitions in the order of the states that selected them\n      var _iteratorNormalCompletion4 = true;\n      var _didIteratorError4 = false;\n      var _iteratorError4 = undefined;\n\n      try {\n        for (var _iterator4 = enabledTransitions.iter()[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n          var t1 = _step4.value;\n\n          var t1Preempted = false;\n          var transitionsToRemove = new Set();\n          var _iteratorNormalCompletion5 = true;\n          var _didIteratorError5 = false;\n          var _iteratorError5 = undefined;\n\n          try {\n            var _loop = function _loop() {\n              var t2 = _step5.value;\n\n              //TODO: can we compute this statically? for example, by checking if the transition scopes are arena orthogonal?\n              var t1ExitSet = _this2._computeExitSet([t1]);\n              var t2ExitSet = _this2._computeExitSet([t2]);\n              var hasIntersection = [].concat(_toConsumableArray(t1ExitSet)).some(function (s) {\n                return t2ExitSet.has(s);\n              }) || [].concat(_toConsumableArray(t2ExitSet)).some(function (s) {\n                return t1ExitSet.has(s);\n              });\n              _this2._log('t1ExitSet', t1.source.id, [].concat(_toConsumableArray(t1ExitSet)).map(function (s) {\n                return s.id;\n              }));\n              _this2._log('t2ExitSet', t2.source.id, [].concat(_toConsumableArray(t2ExitSet)).map(function (s) {\n                return s.id;\n              }));\n              _this2._log('hasIntersection', hasIntersection);\n              if (hasIntersection) {\n                if (t2.source.descendants.indexOf(t1.source) > -1) {\n                  //is this the same as being ancestrally related?\n                  transitionsToRemove.add(t2);\n                } else {\n                  t1Preempted = true;\n                  return 'break';\n                }\n              }\n            };\n\n            for (var _iterator5 = filteredTransitions.iter()[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n              var _ret = _loop();\n\n              if (_ret === 'break') break;\n            }\n          } catch (err) {\n            _didIteratorError5 = true;\n            _iteratorError5 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion5 && _iterator5.return) {\n                _iterator5.return();\n              }\n            } finally {\n              if (_didIteratorError5) {\n                throw _iteratorError5;\n              }\n            }\n          }\n\n          if (!t1Preempted) {\n            var _iteratorNormalCompletion6 = true;\n            var _didIteratorError6 = false;\n            var _iteratorError6 = undefined;\n\n            try {\n              for (var _iterator6 = transitionsToRemove[Symbol.iterator](), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {\n                var t3 = _step6.value;\n\n                filteredTransitions.remove(t3);\n              }\n            } catch (err) {\n              _didIteratorError6 = true;\n              _iteratorError6 = err;\n            } finally {\n              try {\n                if (!_iteratorNormalCompletion6 && _iterator6.return) {\n                  _iterator6.return();\n                }\n              } finally {\n                if (_didIteratorError6) {\n                  throw _iteratorError6;\n                }\n              }\n            }\n\n            filteredTransitions.add(t1);\n          }\n        }\n      } catch (err) {\n        _didIteratorError4 = true;\n        _iteratorError4 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion4 && _iterator4.return) {\n            _iterator4.return();\n          }\n        } finally {\n          if (_didIteratorError4) {\n            throw _iteratorError4;\n          }\n        }\n      }\n\n      return filteredTransitions;\n    }\n  }]);\n\n  return Statechart;\n}(base.BaseInterpreter);\n\nbase.Statechart = Statechart;\nmodule.exports = base;\n\n},{\"scion-core-base\":10}],2:[function(require,module,exports){\n// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n},{}],3:[function(require,module,exports){\nif (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n\n},{}],4:[function(require,module,exports){\nmodule.exports = function isBuffer(arg) {\n  return arg && typeof arg === 'object'\n    && typeof arg.copy === 'function'\n    && typeof arg.fill === 'function'\n    && typeof arg.readUInt8 === 'function';\n}\n},{}],5:[function(require,module,exports){\n(function (process,global){\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar formatRegExp = /%[sdj%]/g;\nexports.format = function(f) {\n  if (!isString(f)) {\n    var objects = [];\n    for (var i = 0; i < arguments.length; i++) {\n      objects.push(inspect(arguments[i]));\n    }\n    return objects.join(' ');\n  }\n\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  var str = String(f).replace(formatRegExp, function(x) {\n    if (x === '%%') return '%';\n    if (i >= len) return x;\n    switch (x) {\n      case '%s': return String(args[i++]);\n      case '%d': return Number(args[i++]);\n      case '%j':\n        try {\n          return JSON.stringify(args[i++]);\n        } catch (_) {\n          return '[Circular]';\n        }\n      default:\n        return x;\n    }\n  });\n  for (var x = args[i]; i < len; x = args[++i]) {\n    if (isNull(x) || !isObject(x)) {\n      str += ' ' + x;\n    } else {\n      str += ' ' + inspect(x);\n    }\n  }\n  return str;\n};\n\n\n// Mark that a method should not be used.\n// Returns a modified function which warns once by default.\n// If --no-deprecation is set, then it is a no-op.\nexports.deprecate = function(fn, msg) {\n  // Allow for deprecating things in the process of starting up.\n  if (isUndefined(global.process)) {\n    return function() {\n      return exports.deprecate(fn, msg).apply(this, arguments);\n    };\n  }\n\n  if (process.noDeprecation === true) {\n    return fn;\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (process.throwDeprecation) {\n        throw new Error(msg);\n      } else if (process.traceDeprecation) {\n        console.trace(msg);\n      } else {\n        console.error(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n};\n\n\nvar debugs = {};\nvar debugEnviron;\nexports.debuglog = function(set) {\n  if (isUndefined(debugEnviron))\n    debugEnviron = process.env.NODE_DEBUG || '';\n  set = set.toUpperCase();\n  if (!debugs[set]) {\n    if (new RegExp('\\\\b' + set + '\\\\b', 'i').test(debugEnviron)) {\n      var pid = process.pid;\n      debugs[set] = function() {\n        var msg = exports.format.apply(exports, arguments);\n        console.error('%s %d: %s', set, pid, msg);\n      };\n    } else {\n      debugs[set] = function() {};\n    }\n  }\n  return debugs[set];\n};\n\n\n/**\n * Echos the value of a value. Trys to print the value out\n * in the best way possible given the different types.\n *\n * @param {Object} obj The object to print out.\n * @param {Object} opts Optional options object that alters the output.\n */\n/* legacy: obj, showHidden, depth, colors*/\nfunction inspect(obj, opts) {\n  // default options\n  var ctx = {\n    seen: [],\n    stylize: stylizeNoColor\n  };\n  // legacy...\n  if (arguments.length >= 3) ctx.depth = arguments[2];\n  if (arguments.length >= 4) ctx.colors = arguments[3];\n  if (isBoolean(opts)) {\n    // legacy...\n    ctx.showHidden = opts;\n  } else if (opts) {\n    // got an \"options\" object\n    exports._extend(ctx, opts);\n  }\n  // set default options\n  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;\n  if (isUndefined(ctx.depth)) ctx.depth = 2;\n  if (isUndefined(ctx.colors)) ctx.colors = false;\n  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;\n  if (ctx.colors) ctx.stylize = stylizeWithColor;\n  return formatValue(ctx, obj, ctx.depth);\n}\nexports.inspect = inspect;\n\n\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\ninspect.colors = {\n  'bold' : [1, 22],\n  'italic' : [3, 23],\n  'underline' : [4, 24],\n  'inverse' : [7, 27],\n  'white' : [37, 39],\n  'grey' : [90, 39],\n  'black' : [30, 39],\n  'blue' : [34, 39],\n  'cyan' : [36, 39],\n  'green' : [32, 39],\n  'magenta' : [35, 39],\n  'red' : [31, 39],\n  'yellow' : [33, 39]\n};\n\n// Don't use 'blue' not visible on cmd.exe\ninspect.styles = {\n  'special': 'cyan',\n  'number': 'yellow',\n  'boolean': 'yellow',\n  'undefined': 'grey',\n  'null': 'bold',\n  'string': 'green',\n  'date': 'magenta',\n  // \"name\": intentionally not styling\n  'regexp': 'red'\n};\n\n\nfunction stylizeWithColor(str, styleType) {\n  var style = inspect.styles[styleType];\n\n  if (style) {\n    return '\\u001b[' + inspect.colors[style][0] + 'm' + str +\n           '\\u001b[' + inspect.colors[style][1] + 'm';\n  } else {\n    return str;\n  }\n}\n\n\nfunction stylizeNoColor(str, styleType) {\n  return str;\n}\n\n\nfunction arrayToHash(array) {\n  var hash = {};\n\n  array.forEach(function(val, idx) {\n    hash[val] = true;\n  });\n\n  return hash;\n}\n\n\nfunction formatValue(ctx, value, recurseTimes) {\n  // Provide a hook for user-specified inspect functions.\n  // Check that value is an object with an inspect function on it\n  if (ctx.customInspect &&\n      value &&\n      isFunction(value.inspect) &&\n      // Filter out the util module, it's inspect function is special\n      value.inspect !== exports.inspect &&\n      // Also filter out any prototype objects using the circular check.\n      !(value.constructor && value.constructor.prototype === value)) {\n    var ret = value.inspect(recurseTimes, ctx);\n    if (!isString(ret)) {\n      ret = formatValue(ctx, ret, recurseTimes);\n    }\n    return ret;\n  }\n\n  // Primitive types cannot have properties\n  var primitive = formatPrimitive(ctx, value);\n  if (primitive) {\n    return primitive;\n  }\n\n  // Look up the keys of the object.\n  var keys = Object.keys(value);\n  var visibleKeys = arrayToHash(keys);\n\n  if (ctx.showHidden) {\n    keys = Object.getOwnPropertyNames(value);\n  }\n\n  // IE doesn't make error fields non-enumerable\n  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx\n  if (isError(value)\n      && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {\n    return formatError(value);\n  }\n\n  // Some type of object without properties can be shortcutted.\n  if (keys.length === 0) {\n    if (isFunction(value)) {\n      var name = value.name ? ': ' + value.name : '';\n      return ctx.stylize('[Function' + name + ']', 'special');\n    }\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    }\n    if (isDate(value)) {\n      return ctx.stylize(Date.prototype.toString.call(value), 'date');\n    }\n    if (isError(value)) {\n      return formatError(value);\n    }\n  }\n\n  var base = '', array = false, braces = ['{', '}'];\n\n  // Make Array say that they are Array\n  if (isArray(value)) {\n    array = true;\n    braces = ['[', ']'];\n  }\n\n  // Make functions say that they are functions\n  if (isFunction(value)) {\n    var n = value.name ? ': ' + value.name : '';\n    base = ' [Function' + n + ']';\n  }\n\n  // Make RegExps say that they are RegExps\n  if (isRegExp(value)) {\n    base = ' ' + RegExp.prototype.toString.call(value);\n  }\n\n  // Make dates with properties first say the date\n  if (isDate(value)) {\n    base = ' ' + Date.prototype.toUTCString.call(value);\n  }\n\n  // Make error with message first say the error\n  if (isError(value)) {\n    base = ' ' + formatError(value);\n  }\n\n  if (keys.length === 0 && (!array || value.length == 0)) {\n    return braces[0] + base + braces[1];\n  }\n\n  if (recurseTimes < 0) {\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    } else {\n      return ctx.stylize('[Object]', 'special');\n    }\n  }\n\n  ctx.seen.push(value);\n\n  var output;\n  if (array) {\n    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);\n  } else {\n    output = keys.map(function(key) {\n      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);\n    });\n  }\n\n  ctx.seen.pop();\n\n  return reduceToSingleString(output, base, braces);\n}\n\n\nfunction formatPrimitive(ctx, value) {\n  if (isUndefined(value))\n    return ctx.stylize('undefined', 'undefined');\n  if (isString(value)) {\n    var simple = '\\'' + JSON.stringify(value).replace(/^\"|\"$/g, '')\n                                             .replace(/'/g, \"\\\\'\")\n                                             .replace(/\\\\\"/g, '\"') + '\\'';\n    return ctx.stylize(simple, 'string');\n  }\n  if (isNumber(value))\n    return ctx.stylize('' + value, 'number');\n  if (isBoolean(value))\n    return ctx.stylize('' + value, 'boolean');\n  // For some reason typeof null is \"object\", so special case here.\n  if (isNull(value))\n    return ctx.stylize('null', 'null');\n}\n\n\nfunction formatError(value) {\n  return '[' + Error.prototype.toString.call(value) + ']';\n}\n\n\nfunction formatArray(ctx, value, recurseTimes, visibleKeys, keys) {\n  var output = [];\n  for (var i = 0, l = value.length; i < l; ++i) {\n    if (hasOwnProperty(value, String(i))) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          String(i), true));\n    } else {\n      output.push('');\n    }\n  }\n  keys.forEach(function(key) {\n    if (!key.match(/^\\d+$/)) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          key, true));\n    }\n  });\n  return output;\n}\n\n\nfunction formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {\n  var name, str, desc;\n  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };\n  if (desc.get) {\n    if (desc.set) {\n      str = ctx.stylize('[Getter/Setter]', 'special');\n    } else {\n      str = ctx.stylize('[Getter]', 'special');\n    }\n  } else {\n    if (desc.set) {\n      str = ctx.stylize('[Setter]', 'special');\n    }\n  }\n  if (!hasOwnProperty(visibleKeys, key)) {\n    name = '[' + key + ']';\n  }\n  if (!str) {\n    if (ctx.seen.indexOf(desc.value) < 0) {\n      if (isNull(recurseTimes)) {\n        str = formatValue(ctx, desc.value, null);\n      } else {\n        str = formatValue(ctx, desc.value, recurseTimes - 1);\n      }\n      if (str.indexOf('\\n') > -1) {\n        if (array) {\n          str = str.split('\\n').map(function(line) {\n            return '  ' + line;\n          }).join('\\n').substr(2);\n        } else {\n          str = '\\n' + str.split('\\n').map(function(line) {\n            return '   ' + line;\n          }).join('\\n');\n        }\n      }\n    } else {\n      str = ctx.stylize('[Circular]', 'special');\n    }\n  }\n  if (isUndefined(name)) {\n    if (array && key.match(/^\\d+$/)) {\n      return str;\n    }\n    name = JSON.stringify('' + key);\n    if (name.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)) {\n      name = name.substr(1, name.length - 2);\n      name = ctx.stylize(name, 'name');\n    } else {\n      name = name.replace(/'/g, \"\\\\'\")\n                 .replace(/\\\\\"/g, '\"')\n                 .replace(/(^\"|\"$)/g, \"'\");\n      name = ctx.stylize(name, 'string');\n    }\n  }\n\n  return name + ': ' + str;\n}\n\n\nfunction reduceToSingleString(output, base, braces) {\n  var numLinesEst = 0;\n  var length = output.reduce(function(prev, cur) {\n    numLinesEst++;\n    if (cur.indexOf('\\n') >= 0) numLinesEst++;\n    return prev + cur.replace(/\\u001b\\[\\d\\d?m/g, '').length + 1;\n  }, 0);\n\n  if (length > 60) {\n    return braces[0] +\n           (base === '' ? '' : base + '\\n ') +\n           ' ' +\n           output.join(',\\n  ') +\n           ' ' +\n           braces[1];\n  }\n\n  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];\n}\n\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) &&\n      (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nexports.isBuffer = require('./support/isBuffer');\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n\n\nfunction pad(n) {\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\n}\n\n\nvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',\n              'Oct', 'Nov', 'Dec'];\n\n// 26 Feb 16:19:34\nfunction timestamp() {\n  var d = new Date();\n  var time = [pad(d.getHours()),\n              pad(d.getMinutes()),\n              pad(d.getSeconds())].join(':');\n  return [d.getDate(), months[d.getMonth()], time].join(' ');\n}\n\n\n// log is just a thin wrapper to console.log that prepends a timestamp\nexports.log = function() {\n  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));\n};\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * The Function.prototype.inherits from lang.js rewritten as a standalone\n * function (not on Function.prototype). NOTE: If this file is to be loaded\n * during bootstrapping this function needs to be rewritten using some native\n * functions as prototype setup using normal JavaScript does not work as\n * expected during bootstrapping (see mirror.js in r114903).\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\nexports.inherits = require('inherits');\n\nexports._extend = function(origin, add) {\n  // Don't do anything if add isn't an object\n  if (!add || !isObject(add)) return origin;\n\n  var keys = Object.keys(add);\n  var i = keys.length;\n  while (i--) {\n    origin[keys[i]] = add[keys[i]];\n  }\n  return origin;\n};\n\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\n}).call(this,require('_process'),typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./support/isBuffer\":4,\"_process\":2,\"inherits\":3}],6:[function(require,module,exports){\n'use strict';\n\n/* begin ArraySet */\n\n/** @constructor */\nfunction ArraySet(l) {\n    l = l || [];\n    this.o = new Set(l);\n}\n\nArraySet.prototype = {\n\n    add: function add(x) {\n        this.o.add(x);\n    },\n\n    remove: function remove(x) {\n        return this.o.delete(x);\n    },\n\n    union: function union(l) {\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n            for (var _iterator = l.o[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                var v = _step.value;\n\n                this.o.add(v);\n            }\n        } catch (err) {\n            _didIteratorError = true;\n            _iteratorError = err;\n        } finally {\n            try {\n                if (!_iteratorNormalCompletion && _iterator.return) {\n                    _iterator.return();\n                }\n            } finally {\n                if (_didIteratorError) {\n                    throw _iteratorError;\n                }\n            }\n        }\n\n        return this;\n    },\n\n    difference: function difference(l) {\n        var _iteratorNormalCompletion2 = true;\n        var _didIteratorError2 = false;\n        var _iteratorError2 = undefined;\n\n        try {\n            for (var _iterator2 = l.o[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n                var v = _step2.value;\n\n                this.o.delete(v);\n            }\n        } catch (err) {\n            _didIteratorError2 = true;\n            _iteratorError2 = err;\n        } finally {\n            try {\n                if (!_iteratorNormalCompletion2 && _iterator2.return) {\n                    _iterator2.return();\n                }\n            } finally {\n                if (_didIteratorError2) {\n                    throw _iteratorError2;\n                }\n            }\n        }\n\n        return this;\n    },\n\n    contains: function contains(x) {\n        return this.o.has(x);\n    },\n\n    iter: function iter() {\n        return Array.from(this.o);\n    },\n\n    isEmpty: function isEmpty() {\n        return !this.o.size;\n    },\n\n    size: function size() {\n        return this.o.size;\n    },\n\n    equals: function equals(s2) {\n        if (this.o.size !== s2.size()) {\n            return false;\n        }\n\n        var _iteratorNormalCompletion3 = true;\n        var _didIteratorError3 = false;\n        var _iteratorError3 = undefined;\n\n        try {\n            for (var _iterator3 = this.o[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n                var v = _step3.value;\n\n                if (!s2.contains(v)) {\n                    return false;\n                }\n            }\n        } catch (err) {\n            _didIteratorError3 = true;\n            _iteratorError3 = err;\n        } finally {\n            try {\n                if (!_iteratorNormalCompletion3 && _iterator3.return) {\n                    _iterator3.return();\n                }\n            } finally {\n                if (_didIteratorError3) {\n                    throw _iteratorError3;\n                }\n            }\n        }\n\n        return true;\n    },\n\n    toString: function toString() {\n        return this.o.size === 0 ? '<empty>' : Array.from(this.o).join(',\\n');\n    }\n};\n\nmodule.exports = ArraySet;\n\n},{}],7:[function(require,module,exports){\n'use strict';\n\nvar STATE_TYPES = {\n    BASIC: 0,\n    COMPOSITE: 1,\n    PARALLEL: 2,\n    HISTORY: 3,\n    INITIAL: 4,\n    FINAL: 5\n};\n\nvar SCXML_IOPROCESSOR_TYPE = 'http://www.w3.org/TR/scxml/#SCXMLEventProcessor';\nvar HTTP_IOPROCESSOR_TYPE = 'http://www.w3.org/TR/scxml/#BasicHTTPEventProcessor';\nvar RX_TRAILING_WILDCARD = /\\.\\*$/;\n\nmodule.exports = {\n    STATE_TYPES: STATE_TYPES,\n    SCXML_IOPROCESSOR_TYPE: SCXML_IOPROCESSOR_TYPE,\n    HTTP_IOPROCESSOR_TYPE: HTTP_IOPROCESSOR_TYPE,\n    RX_TRAILING_WILDCARD: RX_TRAILING_WILDCARD\n};\n\n},{}],8:[function(require,module,exports){\n'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar constants = require('./constants'),\n    STATE_TYPES = constants.STATE_TYPES,\n    RX_TRAILING_WILDCARD = constants.RX_TRAILING_WILDCARD;\n\nvar printTrace = false;\n\nmodule.exports = {\n    extend: extend,\n    transitionWithTargets: transitionWithTargets,\n    transitionComparator: transitionComparator,\n    initializeModel: initializeModel,\n    isEventPrefixMatch: isEventPrefixMatch,\n    isTransitionMatch: isTransitionMatch,\n    scxmlPrefixTransitionSelector: scxmlPrefixTransitionSelector,\n    eventlessTransitionSelector: eventlessTransitionSelector,\n    getTransitionWithHigherSourceChildPriority: getTransitionWithHigherSourceChildPriority,\n    sortInEntryOrder: sortInEntryOrder,\n    getStateWithHigherSourceChildPriority: getStateWithHigherSourceChildPriority,\n    initializeModelGeneratorFn: initializeModelGeneratorFn,\n    deserializeSerializedConfiguration: deserializeSerializedConfiguration,\n    deserializeHistory: deserializeHistory\n};\n\nfunction extend(to, from) {\n    Object.keys(from).forEach(function (k) {\n        to[k] = from[k];\n    });\n    return to;\n};\n\nfunction transitionWithTargets(t) {\n    return t.targets;\n}\n\nfunction transitionComparator(t1, t2) {\n    return t1.documentOrder - t2.documentOrder;\n}\n\nfunction initializeModel(rootState, opts) {\n    var transitions = [],\n        idToStateMap = new Map(),\n        documentOrder = 0;\n\n    //TODO: need to add fake ids to anyone that doesn't have them\n    //FIXME: make this safer - break into multiple passes\n    var idCount = {};\n\n    function generateId(type) {\n        if (idCount[type] === undefined) idCount[type] = 0;\n\n        do {\n            var count = idCount[type]++;\n            var id = '$generated-' + type + '-' + count;\n        } while (idToStateMap.has(id));\n\n        return id;\n    }\n\n    function wrapInFakeRootState(state) {\n        return {\n            $deserializeDatamodel: state.$deserializeDatamodel || function () {},\n            $serializeDatamodel: state.$serializeDatamodel || function () {\n                return null;\n            },\n            $idToStateMap: idToStateMap, //keep this for handy deserialization of serialized configuration\n            docUrl: state.docUrl,\n            name: state.name,\n            states: [{\n                $type: 'initial',\n                transitions: [{\n                    target: state\n                }]\n            }, state]\n        };\n    }\n\n    var statesWithInitialAttributes = [];\n\n    /**\n      @this {SCTransition}\n    */\n    function transitionToString(sourceState) {\n        return sourceState + ' -- ' + (this.events ? '(' + this.events.join(',') + ')' : null) + (this.cond ? '[' + this.cond.name + ']' : '') + ' --> ' + (this.targets ? this.targets.join(',') : null);\n    }\n\n    /**\n      @this {SCState}\n    */\n    function stateToString() {\n        return this.id;\n    }\n\n    function populateStateIdMap(state) {\n        //populate state id map\n        if (state.id) {\n            idToStateMap.set(state.id, state);\n        }\n\n        if (state.states) {\n            for (var j = 0, len = state.states.length; j < len; j++) {\n                populateStateIdMap(state.states[j]);\n            }\n        }\n    }\n\n    function traverse(ancestors, state) {\n\n        if (printTrace) state.toString = stateToString;\n\n        //add to global transition and state id caches\n        if (state.transitions) transitions.push.apply(transitions, state.transitions);\n\n        //create a default type, just to normalize things\n        //this way we can check for unsupported types below\n        state.$type = state.$type || 'state';\n\n        //add ancestors and depth properties\n        state.ancestors = ancestors;\n        state.depth = ancestors.length;\n        state.parent = ancestors[0];\n        state.documentOrder = documentOrder++;\n\n        //add some information to transitions\n        state.transitions = state.transitions || [];\n        for (var j = 0, len = state.transitions.length; j < len; j++) {\n            var transition = state.transitions[j];\n            transition.documentOrder = documentOrder++;\n            transition.source = state;\n            if (printTrace) transition.toString = transitionToString.bind(transition, state);\n        };\n\n        //recursive step\n        if (state.states) {\n            var ancs = [state].concat(ancestors);\n            for (var j = 0, len = state.states.length; j < len; j++) {\n                traverse(ancs, state.states[j]);\n            }\n        }\n\n        //setup fast state type\n        switch (state.$type) {\n            case 'parallel':\n                state.typeEnum = STATE_TYPES.PARALLEL;\n                state.isAtomic = false;\n                break;\n            case 'initial':\n                state.typeEnum = STATE_TYPES.INITIAL;\n                state.isAtomic = true;\n                break;\n            case 'history':\n                state.typeEnum = STATE_TYPES.HISTORY;\n                state.isAtomic = true;\n                break;\n            case 'final':\n                state.typeEnum = STATE_TYPES.FINAL;\n                state.isAtomic = true;\n                break;\n            case 'state':\n            case 'scxml':\n                if (state.states && state.states.length) {\n                    state.typeEnum = STATE_TYPES.COMPOSITE;\n                    state.isAtomic = false;\n                } else {\n                    state.typeEnum = STATE_TYPES.BASIC;\n                    state.isAtomic = true;\n                }\n                break;\n            default:\n                throw new Error('Unknown state type: ' + state.$type);\n        }\n\n        //descendants property on states will now be populated. add descendants to this state\n        if (state.states) {\n            state.descendants = state.states.concat(state.states.map(function (s) {\n                return s.descendants;\n            }).reduce(function (a, b) {\n                return a.concat(b);\n            }, []));\n        } else {\n            state.descendants = [];\n        }\n\n        var initialChildren;\n        if (state.typeEnum === STATE_TYPES.COMPOSITE) {\n            //set up initial state\n\n            if (Array.isArray(state.initial) || typeof state.initial === 'string') {\n                statesWithInitialAttributes.push(state);\n            } else {\n                //take the first child that has initial type, or first child\n                initialChildren = state.states.filter(function (child) {\n                    return child.$type === 'initial';\n                });\n\n                state.initialRef = [initialChildren.length ? initialChildren[0] : state.states[0]];\n                checkInitialRef(state);\n            }\n        }\n\n        //hook up history\n        if (state.typeEnum === STATE_TYPES.COMPOSITE || state.typeEnum === STATE_TYPES.PARALLEL) {\n\n            var historyChildren = state.states.filter(function (s) {\n                return s.$type === 'history';\n            });\n\n            state.historyRef = historyChildren;\n        }\n\n        //now it's safe to fill in fake state ids\n        if (!state.id) {\n            state.id = generateId(state.$type);\n            idToStateMap.set(state.id, state);\n        }\n\n        //normalize onEntry/onExit, which can be single fn or array, or array of arrays (blocks)\n        ['onEntry', 'onExit'].forEach(function (prop) {\n            if (state[prop]) {\n                if (!Array.isArray(state[prop])) {\n                    state[prop] = [state[prop]];\n                }\n                if (!state[prop].every(function (handler) {\n                    return Array.isArray(handler);\n                })) {\n                    state[prop] = [state[prop]];\n                }\n            }\n        });\n\n        if (state.invokes && !Array.isArray(state.invokes)) {\n            state.invokes = [state.invokes];\n            state.invokes.forEach(function (invoke) {\n                if (invoke.finalize && !Array.isArray(invoke.finalize)) {\n                    invoke.finalize = [invoke.finalize];\n                }\n            });\n        }\n    }\n\n    //TODO: convert events to regular expressions in advance\n\n    function checkInitialRef(state) {\n        if (!state.initialRef) throw new Error('Unable to locate initial state for composite state: ' + state.id);\n    }\n    function connectIntialAttributes() {\n        for (var j = 0, len = statesWithInitialAttributes.length; j < len; j++) {\n            var s = statesWithInitialAttributes[j];\n\n            var initialStates = Array.isArray(s.initial) ? s.initial : [s.initial];\n            s.initialRef = initialStates.map(function (initialState) {\n                return idToStateMap.get(initialState);\n            });\n            checkInitialRef(s);\n        }\n    }\n\n    var RX_WHITESPACE = /\\s+/;\n\n    function connectTransitionGraph() {\n        //normalize as with onEntry/onExit\n        for (var i = 0, len = transitions.length; i < len; i++) {\n            var t = transitions[i];\n            if (t.onTransition && !Array.isArray(t.onTransition)) {\n                t.onTransition = [t.onTransition];\n            }\n\n            //normalize \"event\" attribute into \"events\" attribute\n            if (typeof t.event === 'string') {\n                t.events = t.event.trim().split(RX_WHITESPACE);\n            }\n            delete t.event;\n\n            if (t.targets || typeof t.target === 'undefined') {\n                //targets have already been set up\n                continue;\n            }\n\n            if (typeof t.target === 'string') {\n                var target = idToStateMap.get(t.target);\n                if (!target) throw new Error('Unable to find target state with id ' + t.target);\n                t.target = target;\n                t.targets = [t.target];\n            } else if (Array.isArray(t.target)) {\n                t.targets = t.target.map(function (target) {\n                    if (typeof target === 'string') {\n                        target = idToStateMap.get(target);\n                        if (!target) throw new Error('Unable to find target state with id ' + t.target);\n                        return target;\n                    } else {\n                        return target;\n                    }\n                });\n            } else if (_typeof(t.target) === 'object') {\n                t.targets = [t.target];\n            } else {\n                throw new Error('Transition target has unknown type: ' + t.target);\n            }\n        }\n\n        //hook up LCA - optimization\n        for (var i = 0, len = transitions.length; i < len; i++) {\n            var t = transitions[i];\n            if (t.targets) t.lcca = getLCCA(t.source, t.targets[0]); //FIXME: we technically do not need to hang onto the lcca. only the scope is used by the algorithm\n\n            t.scope = getScope(t);\n        }\n    }\n\n    function getScope(transition) {\n        //Transition scope is normally the least common compound ancestor (lcca).\n        //Internal transitions have a scope equal to the source state.\n        var transitionIsReallyInternal = transition.type === 'internal' && transition.source.typeEnum === STATE_TYPES.COMPOSITE && //is transition source a composite state\n        transition.source.parent && //root state won't have parent\n        transition.targets && //does it target its descendants\n        transition.targets.every(function (target) {\n            return transition.source.descendants.indexOf(target) > -1;\n        });\n\n        if (!transition.targets) {\n            return null;\n        } else if (transitionIsReallyInternal) {\n            return transition.source;\n        } else {\n            return transition.lcca;\n        }\n    }\n\n    function getLCCA(s1, s2) {\n        var commonAncestors = [];\n        for (var j = 0, len = s1.ancestors.length; j < len; j++) {\n            var anc = s1.ancestors[j];\n            if ((opts && opts.legacySemantics ? anc.typeEnum === STATE_TYPES.COMPOSITE : anc.typeEnum === STATE_TYPES.COMPOSITE || anc.typeEnum === STATE_TYPES.PARALLEL) && anc.descendants.indexOf(s2) > -1) {\n\n                commonAncestors.push(anc);\n            }\n        };\n        if (!commonAncestors.length) throw new Error(\"Could not find LCA for states.\");\n        return commonAncestors[0];\n    }\n\n    //main execution starts here\n    //FIXME: only wrap in root state if it's not a compound state\n    populateStateIdMap(rootState);\n    var fakeRootState = wrapInFakeRootState(rootState); //I wish we had pointer semantics and could make this a C-style \"out argument\". Instead we return him\n    traverse([], fakeRootState);\n    connectTransitionGraph();\n    connectIntialAttributes();\n\n    return fakeRootState;\n}\n\nfunction isEventPrefixMatch(prefix, fullName) {\n    prefix = prefix.replace(RX_TRAILING_WILDCARD, '');\n\n    if (prefix === fullName) {\n        return true;\n    }\n\n    if (prefix.length > fullName.length) {\n        return false;\n    }\n\n    if (fullName.charAt(prefix.length) !== '.') {\n        return false;\n    }\n\n    return fullName.indexOf(prefix) === 0;\n}\n\nfunction isTransitionMatch(t, eventName) {\n    return t.events.some(function (tEvent) {\n        return tEvent === '*' || isEventPrefixMatch(tEvent, eventName);\n    });\n}\n\nfunction scxmlPrefixTransitionSelector(t, event, evaluator, selectEventlessTransitions) {\n    return (selectEventlessTransitions ? !t.events : t.events && event && event.name && isTransitionMatch(t, event.name)) && (!t.cond || evaluator(t.cond));\n}\n\nfunction eventlessTransitionSelector(state) {\n    return state.transitions.filter(function (transition) {\n        return !transition.events || transition.events && transition.events.length === 0;\n    });\n}\n\n//priority comparison functions\nfunction getTransitionWithHigherSourceChildPriority(_args) {\n    var t1 = _args[0],\n        t2 = _args[1];\n    var r = getStateWithHigherSourceChildPriority(t1.source, t2.source);\n    //compare transitions based first on depth, then based on document order\n    if (t1.source.depth < t2.source.depth) {\n        return t2;\n    } else if (t2.source.depth < t1.source.depth) {\n        return t1;\n    } else {\n        if (t1.documentOrder < t2.documentOrder) {\n            return t1;\n        } else {\n            return t2;\n        }\n    }\n}\n\nfunction sortInEntryOrder(s1, s2) {\n    return getStateWithHigherSourceChildPriority(s1, s2) * -1;\n}\n\nfunction getStateWithHigherSourceChildPriority(s1, s2) {\n    //compare states based first on depth, then based on document order\n    if (s1.depth > s2.depth) {\n        return -1;\n    } else if (s1.depth < s2.depth) {\n        return 1;\n    } else {\n        //Equality\n        if (s1.documentOrder < s2.documentOrder) {\n            return 1;\n        } else if (s1.documentOrder > s2.documentOrder) {\n            return -1;\n        } else {\n            return 0;\n        }\n    }\n}\n\nfunction initializeModelGeneratorFn(modelFn, opts, interpreter) {\n    return modelFn.call(interpreter, opts._x, opts._x._sessionid, opts._x._ioprocessors, interpreter.isIn.bind(interpreter));\n}\n\nfunction deserializeSerializedConfiguration(serializedConfiguration, idToStateMap) {\n    return serializedConfiguration.map(function (id) {\n        var state = idToStateMap.get(id);\n        if (!state) throw new Error('Error loading serialized configuration. Unable to locate state with id ' + id);\n        return state;\n    });\n}\n\nfunction deserializeHistory(serializedHistory, idToStateMap) {\n    var o = {};\n    Object.keys(serializedHistory).forEach(function (sid) {\n        o[sid] = serializedHistory[sid].map(function (id) {\n            var state = idToStateMap.get(id);\n            if (!state) throw new Error('Error loading serialized history. Unable to locate state with id ' + id);\n            return state;\n        });\n    });\n    return o;\n}\n\n},{\"./constants\":7}],9:[function(require,module,exports){\n'use strict';\n\nvar constants = require('./constants');\n\n//model accessor functions\nvar query = {\n    isDescendant: function isDescendant(s1, s2) {\n        //Returns 'true' if state1 is a descendant of state2 (a child, or a child of a child, or a child of a child of a child, etc.) Otherwise returns 'false'.\n        return s2.descendants.indexOf(s1) > -1;\n    },\n    getAncestors: function getAncestors(s, root) {\n        var ancestors, index, state;\n        index = s.ancestors.indexOf(root);\n        if (index > -1) {\n            return s.ancestors.slice(0, index);\n        } else {\n            return s.ancestors;\n        }\n    },\n    isOrthogonalTo: function isOrthogonalTo(s1, s2) {\n        //Two control states are orthogonal if they are not ancestrally\n        //related, and their smallest, mutual parent is a Concurrent-state.\n        return !this.isAncestrallyRelatedTo(s1, s2) && this.getLCA(s1, s2).typeEnum === constants.STATE_TYPES.PARALLEL;\n    },\n    isAncestrallyRelatedTo: function isAncestrallyRelatedTo(s1, s2) {\n        //Two control states are ancestrally related if one is child/grandchild of another.\n        return this.getAncestorsOrSelf(s2).indexOf(s1) > -1 || this.getAncestorsOrSelf(s1).indexOf(s2) > -1;\n    },\n    getAncestorsOrSelf: function getAncestorsOrSelf(s, root) {\n        return [s].concat(query.getAncestors(s, root));\n    },\n    getDescendantsOrSelf: function getDescendantsOrSelf(s) {\n        return [s].concat(s.descendants);\n    },\n    getLCA: function getLCA(s1, s2) {\n        var commonAncestors = this.getAncestors(s1).filter(function (a) {\n            return a.descendants.indexOf(s2) > -1;\n        }, this);\n        return commonAncestors[0];\n    }\n};\n\nmodule.exports = query;\n\n},{\"./constants\":7}],10:[function(require,module,exports){\n(function (process){\n//   Copyright 2012-2012 Jacob Beard, INFICON, and other SCION contributors\n//\n//   Licensed under the Apache License, Version 2.0 (the \"License\");\n//   you may not use this file except in compliance with the License.\n//   You may obtain a copy of the License at\n//\n//       http://www.apache.org/licenses/LICENSE-2.0\n//\n//   Unless required by applicable law or agreed to in writing, software\n//   distributed under the License is distributed on an \"AS IS\" BASIS,\n//   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n//   See the License for the specific language governing permissions and\n//   limitations under the License.\n\n/**\n * SCION-CORE global object\n * @namespace scion\n */\n\n/**\n * An Array of strings representing the ids all of the basic states the\n * interpreter is in after a big-step completes.\n * @typedef {Array<string>} Configuration\n */\n\n/**\n * A set of basic and composite state ids.\n * @typedef {Array<string>} FullConfiguration\n */\n\n/**\n * A set of basic and composite state ids.\n * @typedef {Array<string>} FullConfiguration\n */\n\n\"use strict\";\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar EventEmitter = require('tiny-events').EventEmitter,\n    util = require('util'),\n    ArraySet = require('./ArraySet'),\n    constants = require('./constants'),\n    helpers = require('./helpers'),\n    query = require('./query'),\n    extend = helpers.extend,\n    transitionWithTargets = helpers.transitionWithTargets,\n    transitionComparator = helpers.transitionComparator,\n    initializeModel = helpers.initializeModel,\n    isEventPrefixMatch = helpers.isEventPrefixMatch,\n    isTransitionMatch = helpers.isTransitionMatch,\n    scxmlPrefixTransitionSelector = helpers.scxmlPrefixTransitionSelector,\n    eventlessTransitionSelector = helpers.eventlessTransitionSelector,\n    getTransitionWithHigherSourceChildPriority = helpers.getTransitionWithHigherSourceChildPriority,\n    sortInEntryOrder = helpers.sortInEntryOrder,\n    getStateWithHigherSourceChildPriority = helpers.getStateWithHigherSourceChildPriority,\n    initializeModelGeneratorFn = helpers.initializeModelGeneratorFn,\n    deserializeSerializedConfiguration = helpers.deserializeSerializedConfiguration,\n    deserializeHistory = helpers.deserializeHistory,\n    BASIC = constants.STATE_TYPES.BASIC,\n    COMPOSITE = constants.STATE_TYPES.COMPOSITE,\n    PARALLEL = constants.STATE_TYPES.PARALLEL,\n    HISTORY = constants.STATE_TYPES.HISTORY,\n    INITIAL = constants.STATE_TYPES.INITIAL,\n    FINAL = constants.STATE_TYPES.FINAL,\n    SCXML_IOPROCESSOR_TYPE = constants.SCXML_IOPROCESSOR_TYPE;\n\nvar printTrace = typeof process !== 'undefined' && !!process.env.DEBUG;\n\n/**\n * @interface EventEmitter\n */\n\n/**\n* @event scion.BaseInterpreter#onError\n* @property {string} tagname The name of the element that produced the error. \n* @property {number} line The line in the source file in which the error occurred.\n* @property {number} column The column in the source file in which the error occurred.\n* @property {string} reason An informative error message. The text is platform-specific and subject to change.\n*/\n\n/**\n * @function\n * @name EventEmitter.prototype#on\n * @param {string} type\n * @param {callback} listener\n */\n\n/**\n * @function\n * @name EventEmitter.prototype#once\n * @param {string} type\n * @param {callback} listener\n */\n\n/**\n * @function\n * @name EventEmitter.prototype#off\n * @param {string} type\n * @param {callback} listener\n */\n\n/**\n * @function\n * @name EventEmitter.prototype#emit\n * @param {string} type\n * @param {any} args\n */\n/** \n * @description The SCXML constructor creates an interpreter instance from a model object.\n * @abstract\n * @class BaseInterpreter\n * @memberof scion\n * @extends EventEmitter\n * @param {SCJSON | scxml.ModelFactory} modelOrModelFactory Either an SCJSON root state; or an scxml.ModelFactory, which is a function which returns an SCJSON object. \n * @param opts\n * @param {string} [opts.sessionid] Used to populate SCXML _sessionid.\n * @param {function} [opts.generateSessionid] Factory used to generate sessionid if sessionid keyword is not specified\n * @param {Map<string, BaseInterpreter>} [opts.sessionRegistry] Map used to map sessionid strings to Statechart instances.\n * @param [opts.Set] Class to use as an ArraySet. Defaults to ES6 Set.\n * @param {object} [opts.params]  Used to pass params from invoke. Sets the datamodel when interpreter is instantiated.\n * @param {Snapshot} [opts.snapshot] State machine snapshot. Used to restore a serialized state machine.\n * @param {Statechart} [opts.parentSession]  Used to pass parent session during invoke.\n * @param {string }[opts.invokeid]  Support for id of invoke element at runtime.\n * @param {boolean} [opts.legacySemantics]\n * @param [opts.console]\n * @param [opts.transitionSelector]\n * @param [opts.customCancel]\n * @param [opts.customSend]\n * @param [opts.sendAsync]\n * @param [opts.doSend]\n * @param [opts.invokers]\n * @param [opts.xmlParser]\n * @param [opts.interpreterScriptingContext]\n */\n\nvar BaseInterpreter = function (_EventEmitter) {\n  _inherits(BaseInterpreter, _EventEmitter);\n\n  function BaseInterpreter(modelOrModelFactory, opts) {\n    _classCallCheck(this, BaseInterpreter);\n\n    var _this = _possibleConstructorReturn(this, (BaseInterpreter.__proto__ || Object.getPrototypeOf(BaseInterpreter)).call(this));\n\n    _this.opts = opts;\n\n    _this.opts.InterpreterScriptingContext = _this.opts.InterpreterScriptingContext || InterpreterScriptingContext;\n\n    _this._isStepping = false;\n\n    _this._scriptingContext = _this.opts.interpreterScriptingContext || (_this.opts.InterpreterScriptingContext ? new _this.opts.InterpreterScriptingContext(_this) : {});\n\n    _this.opts.generateSessionid = _this.opts.generateSessionid || BaseInterpreter.generateSessionid;\n    _this.opts.sessionid = _this.opts.sessionid || _this.opts.generateSessionid();\n    _this.opts.sessionRegistry = _this.opts.sessionRegistry || BaseInterpreter.sessionRegistry; //TODO: define a better interface. For now, assume a Map<sessionid, session>\n\n\n    var _ioprocessors = {};\n    _ioprocessors[SCXML_IOPROCESSOR_TYPE] = {\n      location: '#_scxml_' + _this.opts.sessionid\n    };\n    _ioprocessors.scxml = _ioprocessors[SCXML_IOPROCESSOR_TYPE]; //alias\n\n    //SCXML system variables:\n    _this.opts._x = {\n      _sessionid: _this.opts.sessionid,\n      _ioprocessors: _ioprocessors\n    };\n\n    var model;\n    if (typeof modelOrModelFactory === 'function') {\n      model = initializeModelGeneratorFn(modelOrModelFactory, _this.opts, _this);\n    } else if ((typeof modelOrModelFactory === 'undefined' ? 'undefined' : _typeof(modelOrModelFactory)) === 'object') {\n      model = JSON.parse(JSON.stringify(modelOrModelFactory)); //assume object\n    } else {\n      throw new Error('Unexpected model type. Expected model factory function, or scjson object.');\n    }\n\n    _this._model = initializeModel(model, _this.opts);\n\n    _this.opts.console = _this.opts.console || (typeof console === 'undefined' ? { log: function log() {} } : console); //rely on global console if this console is undefined\n    _this.opts.Set = _this.opts.Set || ArraySet;\n    _this.opts.priorityComparisonFn = _this.opts.priorityComparisonFn || getTransitionWithHigherSourceChildPriority;\n    _this.opts.transitionSelector = _this.opts.transitionSelector || scxmlPrefixTransitionSelector;\n\n    _this.opts.sessionRegistry.set(String(_this.opts.sessionid), _this);\n\n    _this._scriptingContext.log = _this._scriptingContext.log || function log() {\n      if (this.opts.console.log.apply) {\n        this.opts.console.log.apply(this.opts.console, arguments);\n      } else {\n        //console.log on older IE does not support Function.apply, so just pass him the first argument. Best we can do for now.\n        this.opts.console.log(Array.prototype.slice.apply(arguments).join(','));\n      }\n    }.bind(_this); //set up default scripting context log function\n\n    _this._externalEventQueue = [];\n    _this._internalEventQueue = [];\n\n    if (_this.opts.params) {\n      _this._model.$deserializeDatamodel(_this.opts.params); //load up the datamodel\n    }\n\n    //check if we're loading from a previous snapshot\n    if (_this.opts.snapshot) {\n      _this._configuration = new _this.opts.Set(deserializeSerializedConfiguration(_this.opts.snapshot[0], _this._model.$idToStateMap));\n      _this._historyValue = deserializeHistory(_this.opts.snapshot[1], _this._model.$idToStateMap);\n      _this._isInFinalState = _this.opts.snapshot[2];\n      _this._model.$deserializeDatamodel(_this.opts.snapshot[3]); //load up the datamodel\n      _this._internalEventQueue = _this.opts.snapshot[4];\n    } else {\n      _this._configuration = new _this.opts.Set();\n      _this._historyValue = {};\n      _this._isInFinalState = false;\n    }\n\n    //add debug logging\n    BaseInterpreter.EVENTS.forEach(function (event) {\n      this.on(event, this._log.bind(this, event));\n    }, _this);\n\n    module.exports.emit('new', _this);\n    return _this;\n  }\n\n  /** \n  * Cancels the session. This clears all timers; puts the interpreter in a\n  * final state; and runs all exit actions on current states.\n  * @memberof BaseInterpreter.prototype\n  */\n\n\n  _createClass(BaseInterpreter, [{\n    key: 'cancel',\n    value: function cancel() {\n      delete this.opts.parentSession;\n      if (this._isInFinalState) return;\n      this._isInFinalState = true;\n      this._log('session cancelled ' + this.opts.invokeid);\n      this._exitInterpreter(null);\n    }\n  }, {\n    key: '_exitInterpreter',\n    value: function _exitInterpreter(event) {\n      var _this2 = this;\n\n      //TODO: cancel invoked sessions\n      //cancel all delayed sends when we enter into a final state.\n      this._cancelAllDelayedSends();\n\n      var statesToExit = this._getFullConfiguration().sort(getStateWithHigherSourceChildPriority);\n\n      for (var j = 0, len = statesToExit.length; j < len; j++) {\n        var stateExited = statesToExit[j];\n\n        if (stateExited.onExit !== undefined) {\n          for (var exitIdx = 0, exitLen = stateExited.onExit.length; exitIdx < exitLen; exitIdx++) {\n            var block = stateExited.onExit[exitIdx];\n            for (var blockIdx = 0, blockLen = block.length; blockIdx < blockLen; blockIdx++) {\n              var actionRef = block[blockIdx];\n              try {\n                actionRef.call(this._scriptingContext, null);\n              } catch (e) {\n                this._handleError(e, actionRef);\n                break;\n              }\n            }\n          }\n        }\n\n        //cancel invoked session\n        if (stateExited.invokes) stateExited.invokes.forEach(function (invoke) {\n          _this2._scriptingContext.cancelInvoke(invoke.id);\n        });\n\n        //if he is a top-level <final> state, then return the done event\n        if (stateExited.$type === 'final' && stateExited.parent.$type === 'scxml') {\n\n          if (this.opts.parentSession) {\n            this._scriptingContext.send({\n              target: '#_parent',\n              name: 'done.invoke.' + this.opts.invokeid,\n              data: stateExited.donedata && stateExited.donedata.call(this._scriptingContext, event)\n            });\n          }\n\n          this.opts.sessionRegistry.delete(this.opts.sessionid);\n          this.emit('onExitInterpreter', event);\n        }\n      }\n    }\n\n    /** \n     * Starts the interpreter. Should only be called once, and should be called\n     * before BaseInterpreter.prototype#gen is called for the first time.  Returns a\n     * Configuration.\n     * @return {Configuration}\n     * @memberof BaseInterpreter.prototype\n     * @emits scion.BaseInterpreter#onEntry\n     * @emits scion.BaseInterpreter#onExit\n     * @emits scion.BaseInterpreter#onTransition\n     * @emits scion.BaseInterpreter#onDefaultEntry\n     * @emits scion.BaseInterpreter#onError\n     * @emits scion.BaseInterpreter#onBigStepBegin\n     * @emits scion.BaseInterpreter#onBigStepEnd\n     * @emits scion.BaseInterpreter#onBigStepSuspend\n     * @emits scion.BaseInterpreter#onBigStepResume\n     * @emits scion.BaseInterpreter#onSmallStepBegin\n     * @emits scion.BaseInterpreter#onSmallStepEnd\n     * @emits scion.BaseInterpreter#onBigStepEnd\n     * @emits scion.BaseInterpreter#onExitInterpreter\n     */\n\n  }, {\n    key: 'start',\n    value: function start() {\n      this._initStart();\n      this._performBigStep();\n      return this.getConfiguration();\n    }\n\n    /**\n     * This callback is displayed as a global member.\n     * @callback genCallback\n     * @param {Error} err\n     * @param {Configuration} configuration\n     */\n\n    /**\n     * Starts the interpreter asynchronously\n     * @param  {genCallback} cb Callback invoked with an error or the interpreter's stable configuration\n     * @memberof BaseInterpreter.prototype \n     * @emits scion.BaseInterpreter#onEntry\n     * @emits scion.BaseInterpreter#onExit\n     * @emits scion.BaseInterpreter#onTransition\n     * @emits scion.BaseInterpreter#onDefaultEntry\n     * @emits scion.BaseInterpreter#onError\n     * @emits scion.BaseInterpreter#onBigStepBegin\n     * @emits scion.BaseInterpreter#onBigStepEnd\n     * @emits scion.BaseInterpreter#onBigStepSuspend\n     * @emits scion.BaseInterpreter#onBigStepResume\n     * @emits scion.BaseInterpreter#onSmallStepBegin\n     * @emits scion.BaseInterpreter#onSmallStepEnd\n     * @emits scion.BaseInterpreter#onBigStepEnd\n     * @emits scion.BaseInterpreter#onExitInterpreter\n     */\n\n  }, {\n    key: 'startAsync',\n    value: function startAsync(cb) {\n      cb = this._initStart(cb);\n      this.genAsync(null, cb);\n    }\n  }, {\n    key: '_initStart',\n    value: function _initStart(cb) {\n      var _this3 = this;\n\n      if (typeof cb !== 'function') {\n        cb = nop;\n      }\n\n      this._log(\"performing initial big step\");\n\n      //We effectively need to figure out states to enter here to populate initial config. assuming root is compound state makes this simple.\n      //but if we want it to be parallel, then this becomes more complex. so when initializing the model, we add a 'fake' root state, which\n      //makes the following operation safe.\n      this._model.initialRef.forEach(function (s) {\n        return _this3._configuration.add(s);\n      });\n\n      return cb;\n    }\n\n    /** \n    * Returns state machine {@link Configuration}.\n    * @return {Configuration}\n    * @memberof BaseInterpreter.prototype \n    */\n\n  }, {\n    key: 'getConfiguration',\n    value: function getConfiguration() {\n      return this._configuration.iter().map(function (s) {\n        return s.id;\n      });\n    }\n  }, {\n    key: '_getFullConfiguration',\n    value: function _getFullConfiguration() {\n      return this._configuration.iter().map(function (s) {\n        return [s].concat(query.getAncestors(s));\n      }, this).reduce(function (a, b) {\n        return a.concat(b);\n      }, []). //flatten\n      reduce(function (a, b) {\n        return a.indexOf(b) > -1 ? a : a.concat(b);\n      }, []); //uniq\n    }\n\n    /** \n    * @return {FullConfiguration}\n    * @memberof BaseInterpreter.prototype \n    */\n\n  }, {\n    key: 'getFullConfiguration',\n    value: function getFullConfiguration() {\n      return this._getFullConfiguration().map(function (s) {\n        return s.id;\n      });\n    }\n\n    /** \n    * @return {boolean}\n    * @memberof BaseInterpreter.prototype \n    * @param {string} stateName\n    */\n\n  }, {\n    key: 'isIn',\n    value: function isIn(stateName) {\n      return this.getFullConfiguration().indexOf(stateName) > -1;\n    }\n\n    /** \n    * Is the state machine in a final state?\n    * @return {boolean}\n    * @memberof BaseInterpreter.prototype \n    */\n\n  }, {\n    key: 'isFinal',\n    value: function isFinal() {\n      return this._isInFinalState;\n    }\n\n    /** @private */\n\n  }, {\n    key: '_performBigStep',\n    value: function _performBigStep(e) {\n      var currentEvent = void 0,\n          keepGoing = void 0,\n          allStatesExited = void 0,\n          allStatesEntered = void 0;\n\n      var _startBigStep2 = this._startBigStep(e);\n\n      var _startBigStep3 = _slicedToArray(_startBigStep2, 4);\n\n      allStatesExited = _startBigStep3[0];\n      allStatesEntered = _startBigStep3[1];\n      keepGoing = _startBigStep3[2];\n      currentEvent = _startBigStep3[3];\n\n\n      while (keepGoing) {\n        var _selectTransitionsAnd = this._selectTransitionsAndPerformSmallStep(currentEvent, allStatesEntered, allStatesExited);\n\n        var _selectTransitionsAnd2 = _slicedToArray(_selectTransitionsAnd, 2);\n\n        currentEvent = _selectTransitionsAnd2[0];\n        keepGoing = _selectTransitionsAnd2[1];\n      }\n\n      this._finishBigStep(currentEvent, allStatesEntered, allStatesExited);\n    }\n  }, {\n    key: '_selectTransitionsAndPerformSmallStep',\n    value: function _selectTransitionsAndPerformSmallStep(currentEvent, allStatesEntered, allStatesExited) {\n      //first select with null event\n      var selectedTransitions = this._selectTransitions(currentEvent, true);\n      if (selectedTransitions.isEmpty()) {\n        var ev = this._internalEventQueue.shift();\n        if (ev) {\n          currentEvent = ev;\n          selectedTransitions = this._selectTransitions(currentEvent, false);\n        }\n      }\n\n      if (!selectedTransitions.isEmpty()) {\n        this.emit('onSmallStepBegin', currentEvent);\n        var statesExited = void 0,\n            statesEntered = void 0;\n\n        var _performSmallStep2 = this._performSmallStep(currentEvent, selectedTransitions);\n\n        var _performSmallStep3 = _slicedToArray(_performSmallStep2, 2);\n\n        statesExited = _performSmallStep3[0];\n        statesEntered = _performSmallStep3[1];\n\n        if (statesExited) statesExited.forEach(function (s) {\n          return allStatesExited.add(s);\n        });\n        if (statesEntered) statesEntered.forEach(function (s) {\n          return allStatesEntered.add(s);\n        });\n        this.emit('onSmallStepEnd', currentEvent);\n      }\n      var keepGoing = !selectedTransitions.isEmpty() || this._internalEventQueue.length;\n      return [currentEvent, keepGoing];\n    }\n  }, {\n    key: '_startBigStep',\n    value: function _startBigStep(e) {\n      var _this4 = this;\n\n      this.emit('onBigStepBegin', e);\n\n      //do applyFinalize and autoforward\n      this._configuration.iter().forEach(function (state) {\n        if (state.invokes) state.invokes.forEach(function (invoke) {\n          if (invoke.autoforward) {\n            //autoforward\n            _this4._scriptingContext.send({\n              target: '#_' + invoke.id,\n              name: e.name,\n              data: e.data\n            });\n          }\n          if (invoke.id === e.invokeid) {\n            //applyFinalize\n            if (invoke.finalize) invoke.finalize.forEach(function (action) {\n              return _this4._evaluateAction(e, action);\n            });\n          }\n        });\n      });\n\n      if (e) this._internalEventQueue.push(e);\n\n      var allStatesExited = new Set(),\n          allStatesEntered = new Set();\n      var keepGoing = true;\n      var currentEvent = e;\n      return [allStatesEntered, allStatesExited, keepGoing, currentEvent];\n    }\n  }, {\n    key: '_finishBigStep',\n    value: function _finishBigStep(e, allStatesEntered, allStatesExited, cb) {\n      var _this5 = this;\n\n      var statesToInvoke = Array.from(new Set([].concat(_toConsumableArray(allStatesEntered)).filter(function (s) {\n        return s.invokes && !allStatesExited.has(s);\n      }))).sort(sortInEntryOrder);\n\n      // Here we invoke whatever needs to be invoked. The implementation of 'invoke' is platform-specific\n      statesToInvoke.forEach(function (s) {\n        s.invokes.forEach(function (f) {\n          return _this5._evaluateAction(e, f);\n        });\n      });\n\n      // cancel invoke for allStatesExited\n      allStatesExited.forEach(function (s) {\n        if (s.invokes) s.invokes.forEach(function (invoke) {\n          _this5._scriptingContext.cancelInvoke(invoke.id);\n        });\n      });\n\n      // TODO: Invoking may have raised internal error events and we iterate to handle them        \n      //if not internalQueue.isEmpty():\n      //    continue\n\n      this._isInFinalState = this._configuration.iter().every(function (s) {\n        return s.typeEnum === FINAL;\n      });\n      if (this._isInFinalState) {\n        this._exitInterpreter(e);\n      }\n      this.emit('onBigStepEnd', e);\n      if (cb) cb(undefined, this.getConfiguration());\n    }\n  }, {\n    key: '_cancelAllDelayedSends',\n    value: function _cancelAllDelayedSends() {\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this._scriptingContext._timeouts[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var timeoutOptions = _step.value;\n\n          if (!timeoutOptions.sendOptions.delay) continue;\n          this._log('cancelling delayed send', timeoutOptions);\n          clearTimeout(timeoutOptions.timeoutHandle);\n          this._scriptingContext._timeouts.delete(timeoutOptions);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      Object.keys(this._scriptingContext._timeoutMap).forEach(function (key) {\n        delete this._scriptingContext._timeoutMap[key];\n      }, this);\n    }\n  }, {\n    key: '_performBigStepAsync',\n    value: function _performBigStepAsync(e, cb) {\n      var currentEvent = void 0,\n          keepGoing = void 0,\n          allStatesExited = void 0,\n          allStatesEntered = void 0;\n\n      var _startBigStep4 = this._startBigStep(e);\n\n      var _startBigStep5 = _slicedToArray(_startBigStep4, 4);\n\n      allStatesExited = _startBigStep5[0];\n      allStatesEntered = _startBigStep5[1];\n      keepGoing = _startBigStep5[2];\n      currentEvent = _startBigStep5[3];\n\n\n      function nextStep(emit) {\n        this.emit(emit);\n\n        var _selectTransitionsAnd3 = this._selectTransitionsAndPerformSmallStep(currentEvent, allStatesEntered, allStatesExited);\n\n        var _selectTransitionsAnd4 = _slicedToArray(_selectTransitionsAnd3, 2);\n\n        currentEvent = _selectTransitionsAnd4[0];\n        keepGoing = _selectTransitionsAnd4[1];\n\n\n        if (keepGoing) {\n          this.emit('onBigStepSuspend');\n          setImmediate(nextStep.bind(this, 'onBigStepResume'));\n        } else {\n          this._finishBigStep(currentEvent, allStatesEntered, allStatesExited, cb);\n        }\n      }\n      nextStep.call(this, 'onBigStepBegin');\n    }\n\n    /** @private */\n\n  }, {\n    key: '_performSmallStep',\n    value: function _performSmallStep(currentEvent, selectedTransitions) {\n\n      this._log(\"selecting transitions with currentEvent\", currentEvent);\n\n      this._log(\"selected transitions\", selectedTransitions);\n\n      var statesExited = void 0,\n          statesEntered = void 0;\n\n      if (!selectedTransitions.isEmpty()) {\n\n        //we only want to enter and exit states from transitions with targets\n        //filter out targetless transitions here - we will only use these to execute transition actions\n        var selectedTransitionsWithTargets = new this.opts.Set(selectedTransitions.iter().filter(transitionWithTargets));\n\n        statesExited = this._exitStates(currentEvent, selectedTransitionsWithTargets);\n        this._executeTransitions(currentEvent, selectedTransitions);\n        statesEntered = this._enterStates(currentEvent, selectedTransitionsWithTargets);\n\n        this._log(\"new configuration \", this._configuration);\n      }\n\n      return [statesExited, statesEntered];\n    }\n  }, {\n    key: '_exitStates',\n    value: function _exitStates(currentEvent, selectedTransitionsWithTargets) {\n      var basicStatesExited = void 0,\n          statesExited = void 0;\n\n      var _getStatesExited2 = this._getStatesExited(selectedTransitionsWithTargets);\n\n      var _getStatesExited3 = _slicedToArray(_getStatesExited2, 2);\n\n      basicStatesExited = _getStatesExited3[0];\n      statesExited = _getStatesExited3[1];\n\n\n      this._log('exiting states');\n      for (var j = 0, len = statesExited.length; j < len; j++) {\n        var stateExited = statesExited[j];\n\n        if (stateExited.isAtomic) this._configuration.remove(stateExited);\n\n        this._log(\"exiting \", stateExited.id);\n\n        //invoke listeners\n        this.emit('onExit', stateExited.id);\n\n        if (stateExited.onExit !== undefined) {\n          for (var exitIdx = 0, exitLen = stateExited.onExit.length; exitIdx < exitLen; exitIdx++) {\n            var block = stateExited.onExit[exitIdx];\n            for (var blockIdx = 0, blockLen = block.length; blockIdx < blockLen; blockIdx++) {\n              var actionRef = block[blockIdx];\n              try {\n                actionRef.call(this._scriptingContext, currentEvent);\n              } catch (e) {\n                this._handleError(e, actionRef);\n                break;\n              }\n            }\n          }\n        }\n\n        var f;\n        if (stateExited.historyRef) {\n          var _iteratorNormalCompletion2 = true;\n          var _didIteratorError2 = false;\n          var _iteratorError2 = undefined;\n\n          try {\n            for (var _iterator2 = stateExited.historyRef[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n              var historyRef = _step2.value;\n\n              if (historyRef.isDeep) {\n                f = function f(s0) {\n                  return s0.typeEnum === BASIC && stateExited.descendants.indexOf(s0) > -1;\n                };\n              } else {\n                f = function f(s0) {\n                  return s0.parent === stateExited;\n                };\n              }\n              //update history\n              this._historyValue[historyRef.id] = statesExited.filter(f);\n            }\n          } catch (err) {\n            _didIteratorError2 = true;\n            _iteratorError2 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion2 && _iterator2.return) {\n                _iterator2.return();\n              }\n            } finally {\n              if (_didIteratorError2) {\n                throw _iteratorError2;\n              }\n            }\n          }\n        }\n      }\n\n      return statesExited;\n    }\n\n    /** @private */\n\n  }, {\n    key: '_getStatesExited',\n    value: function _getStatesExited(transitions) {\n      var statesExited = new this.opts.Set();\n      var basicStatesExited = new this.opts.Set();\n\n      //States exited are defined to be active states that are\n      //descendants of the scope of each priority-enabled transition.\n      //Here, we iterate through the transitions, and collect states\n      //that match this condition. \n      var transitionList = transitions.iter();\n      for (var txIdx = 0, txLen = transitionList.length; txIdx < txLen; txIdx++) {\n        var transition = transitionList[txIdx];\n        var scope = transition.scope,\n            desc = scope.descendants;\n\n        //For each state in the configuration\n        //is that state a descendant of the transition scope?\n        //Store ancestors of that state up to but not including the scope.\n        var configList = this._configuration.iter();\n        for (var cfgIdx = 0, cfgLen = configList.length; cfgIdx < cfgLen; cfgIdx++) {\n          var state = configList[cfgIdx];\n          if (desc.indexOf(state) > -1) {\n            basicStatesExited.add(state);\n            statesExited.add(state);\n            var ancestors = query.getAncestors(state, scope);\n            for (var ancIdx = 0, ancLen = ancestors.length; ancIdx < ancLen; ancIdx++) {\n              statesExited.add(ancestors[ancIdx]);\n            }\n          }\n        }\n      }\n\n      var sortedStatesExited = statesExited.iter().sort(getStateWithHigherSourceChildPriority);\n      return [basicStatesExited, sortedStatesExited];\n    }\n  }, {\n    key: '_executeTransitions',\n    value: function _executeTransitions(currentEvent, selectedTransitions) {\n      var sortedTransitions = selectedTransitions.iter().sort(transitionComparator);\n\n      this._log(\"executing transitition actions\");\n      for (var stxIdx = 0, len = sortedTransitions.length; stxIdx < len; stxIdx++) {\n        var transition = sortedTransitions[stxIdx];\n\n        var targetIds = transition.targets && transition.targets.map(function (target) {\n          return target.id;\n        });\n\n        this.emit('onTransition', transition.source.id, targetIds, transition.source.transitions.indexOf(transition));\n\n        if (transition.onTransition !== undefined) {\n          for (var txIdx = 0, txLen = transition.onTransition.length; txIdx < txLen; txIdx++) {\n            var actionRef = transition.onTransition[txIdx];\n            try {\n              actionRef.call(this._scriptingContext, currentEvent);\n            } catch (e) {\n              this._handleError(e, actionRef);\n              break;\n            }\n          }\n        }\n      }\n    }\n  }, {\n    key: '_enterStates',\n    value: function _enterStates(currentEvent, selectedTransitionsWithTargets) {\n      var _this6 = this;\n\n      this._log(\"entering states\");\n\n      var statesEntered = new Set();\n      var statesForDefaultEntry = new Set();\n      // initialize the temporary table for default content in history states\n      var defaultHistoryContent = {};\n      this._computeEntrySet(selectedTransitionsWithTargets, statesEntered, statesForDefaultEntry, defaultHistoryContent);\n      statesEntered = [].concat(_toConsumableArray(statesEntered)).sort(sortInEntryOrder);\n\n      this._log(\"statesEntered \", statesEntered);\n\n      for (var enterIdx = 0, enterLen = statesEntered.length; enterIdx < enterLen; enterIdx++) {\n        var stateEntered = statesEntered[enterIdx];\n\n        if (stateEntered.isAtomic) this._configuration.add(stateEntered);\n\n        this._log(\"entering\", stateEntered.id);\n\n        this.emit('onEntry', stateEntered.id);\n\n        if (stateEntered.onEntry !== undefined) {\n          for (var entryIdx = 0, entryLen = stateEntered.onEntry.length; entryIdx < entryLen; entryIdx++) {\n            var block = stateEntered.onEntry[entryIdx];\n            for (var blockIdx = 0, blockLen = block.length; blockIdx < blockLen; blockIdx++) {\n              var actionRef = block[blockIdx];\n              try {\n                actionRef.call(this._scriptingContext, currentEvent);\n              } catch (e) {\n                this._handleError(e, actionRef);\n                break;\n              }\n            }\n          }\n        }\n\n        if (statesForDefaultEntry.has(stateEntered)) {\n          var _iteratorNormalCompletion3 = true;\n          var _didIteratorError3 = false;\n          var _iteratorError3 = undefined;\n\n          try {\n            for (var _iterator3 = stateEntered.initialRef[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n              var initialState = _step3.value;\n\n              this.emit('onDefaultEntry', initialState.id);\n              if (initialState.typeEnum === INITIAL) {\n                var transition = initialState.transitions[0];\n                if (transition.onTransition !== undefined) {\n                  this._log('executing initial transition content for initial state of parent state', stateEntered.id);\n                  for (var txIdx = 0, txLen = transition.onTransition.length; txIdx < txLen; txIdx++) {\n                    var _actionRef = transition.onTransition[txIdx];\n                    try {\n                      _actionRef.call(this._scriptingContext, currentEvent);\n                    } catch (e) {\n                      this._handleError(e, _actionRef);\n                      break;\n                    }\n                  }\n                }\n              }\n            }\n          } catch (err) {\n            _didIteratorError3 = true;\n            _iteratorError3 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion3 && _iterator3.return) {\n                _iterator3.return();\n              }\n            } finally {\n              if (_didIteratorError3) {\n                throw _iteratorError3;\n              }\n            }\n          }\n        }\n\n        if (defaultHistoryContent[stateEntered.id]) {\n          var _transition = defaultHistoryContent[stateEntered.id];\n          if (_transition.onTransition !== undefined) {\n            this._log('executing history transition content for history state of parent state', stateEntered.id);\n            for (var txIdx = 0, txLen = _transition.onTransition.length; txIdx < txLen; txIdx++) {\n              var _actionRef2 = _transition.onTransition[txIdx];\n              try {\n                _actionRef2.call(this._scriptingContext, currentEvent);\n              } catch (e) {\n                this._handleError(e, _actionRef2);\n                break;\n              }\n            }\n          }\n        }\n      }\n\n      for (var enterIdx = 0, enterLen = statesEntered.length; enterIdx < enterLen; enterIdx++) {\n        var stateEntered = statesEntered[enterIdx];\n        if (stateEntered.typeEnum === FINAL) {\n          var parent = stateEntered.parent;\n          var grandparent = parent.parent;\n          this._internalEventQueue.push({ name: \"done.state.\" + parent.id, data: stateEntered.donedata && stateEntered.donedata.call(this._scriptingContext, currentEvent) });\n          if (grandparent && grandparent.typeEnum === PARALLEL) {\n            if (grandparent.states.every(function (s) {\n              return _this6.isInFinalState(s);\n            })) {\n              this._internalEventQueue.push({ name: \"done.state.\" + grandparent.id });\n            }\n          }\n        }\n      }\n\n      return statesEntered;\n    }\n  }, {\n    key: '_getEffectiveTargetStates',\n    value: function _getEffectiveTargetStates(transition) {\n      var targets = new Set();\n      var _iteratorNormalCompletion4 = true;\n      var _didIteratorError4 = false;\n      var _iteratorError4 = undefined;\n\n      try {\n        for (var _iterator4 = transition.targets[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n          var s = _step4.value;\n\n          if (s.typeEnum === HISTORY) {\n            if (s.id in this._historyValue) this._historyValue[s.id].forEach(function (state) {\n              return targets.add(state);\n            });else [].concat(_toConsumableArray(this._getEffectiveTargetStates(s.transitions[0]))).forEach(function (state) {\n              return targets.add(state);\n            });\n          } else {\n            targets.add(s);\n          }\n        }\n      } catch (err) {\n        _didIteratorError4 = true;\n        _iteratorError4 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion4 && _iterator4.return) {\n            _iterator4.return();\n          }\n        } finally {\n          if (_didIteratorError4) {\n            throw _iteratorError4;\n          }\n        }\n      }\n\n      return targets;\n    }\n  }, {\n    key: '_computeEntrySet',\n    value: function _computeEntrySet(transitions, statesToEnter, statesForDefaultEntry, defaultHistoryContent) {\n      var _iteratorNormalCompletion5 = true;\n      var _didIteratorError5 = false;\n      var _iteratorError5 = undefined;\n\n      try {\n        for (var _iterator5 = transitions.iter()[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n          var t = _step5.value;\n          var _iteratorNormalCompletion6 = true;\n          var _didIteratorError6 = false;\n          var _iteratorError6 = undefined;\n\n          try {\n            for (var _iterator6 = t.targets[Symbol.iterator](), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {\n              var s = _step6.value;\n\n              this._addDescendantStatesToEnter(s, statesToEnter, statesForDefaultEntry, defaultHistoryContent);\n            }\n          } catch (err) {\n            _didIteratorError6 = true;\n            _iteratorError6 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion6 && _iterator6.return) {\n                _iterator6.return();\n              }\n            } finally {\n              if (_didIteratorError6) {\n                throw _iteratorError6;\n              }\n            }\n          }\n\n          var ancestor = t.scope;\n          var _iteratorNormalCompletion7 = true;\n          var _didIteratorError7 = false;\n          var _iteratorError7 = undefined;\n\n          try {\n            for (var _iterator7 = this._getEffectiveTargetStates(t)[Symbol.iterator](), _step7; !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {\n              var _s = _step7.value;\n\n              this._addAncestorStatesToEnter(_s, ancestor, statesToEnter, statesForDefaultEntry, defaultHistoryContent);\n            }\n          } catch (err) {\n            _didIteratorError7 = true;\n            _iteratorError7 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion7 && _iterator7.return) {\n                _iterator7.return();\n              }\n            } finally {\n              if (_didIteratorError7) {\n                throw _iteratorError7;\n              }\n            }\n          }\n        }\n      } catch (err) {\n        _didIteratorError5 = true;\n        _iteratorError5 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion5 && _iterator5.return) {\n            _iterator5.return();\n          }\n        } finally {\n          if (_didIteratorError5) {\n            throw _iteratorError5;\n          }\n        }\n      }\n    }\n  }, {\n    key: '_computeExitSet',\n    value: function _computeExitSet(transitions) {\n      var statesToExit = new Set();\n      var _iteratorNormalCompletion8 = true;\n      var _didIteratorError8 = false;\n      var _iteratorError8 = undefined;\n\n      try {\n        for (var _iterator8 = transitions[Symbol.iterator](), _step8; !(_iteratorNormalCompletion8 = (_step8 = _iterator8.next()).done); _iteratorNormalCompletion8 = true) {\n          var t = _step8.value;\n\n          if (t.targets) {\n            var scope = t.scope;\n            var _iteratorNormalCompletion9 = true;\n            var _didIteratorError9 = false;\n            var _iteratorError9 = undefined;\n\n            try {\n              for (var _iterator9 = this._getFullConfiguration()[Symbol.iterator](), _step9; !(_iteratorNormalCompletion9 = (_step9 = _iterator9.next()).done); _iteratorNormalCompletion9 = true) {\n                var s = _step9.value;\n\n                if (query.isDescendant(s, scope)) statesToExit.add(s);\n              }\n            } catch (err) {\n              _didIteratorError9 = true;\n              _iteratorError9 = err;\n            } finally {\n              try {\n                if (!_iteratorNormalCompletion9 && _iterator9.return) {\n                  _iterator9.return();\n                }\n              } finally {\n                if (_didIteratorError9) {\n                  throw _iteratorError9;\n                }\n              }\n            }\n          }\n        }\n      } catch (err) {\n        _didIteratorError8 = true;\n        _iteratorError8 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion8 && _iterator8.return) {\n            _iterator8.return();\n          }\n        } finally {\n          if (_didIteratorError8) {\n            throw _iteratorError8;\n          }\n        }\n      }\n\n      return statesToExit;\n    }\n  }, {\n    key: '_addAncestorStatesToEnter',\n    value: function _addAncestorStatesToEnter(state, ancestor, statesToEnter, statesForDefaultEntry, defaultHistoryContent) {\n      var _this7 = this;\n\n      var traverse = function traverse(anc) {\n        if (anc.typeEnum === PARALLEL) {\n          var _iteratorNormalCompletion10 = true;\n          var _didIteratorError10 = false;\n          var _iteratorError10 = undefined;\n\n          try {\n            var _loop = function _loop() {\n              var child = _step10.value;\n\n              if (child.typeEnum !== HISTORY && ![].concat(_toConsumableArray(statesToEnter)).some(function (s) {\n                return query.isDescendant(s, child);\n              })) {\n                _this7._addDescendantStatesToEnter(child, statesToEnter, statesForDefaultEntry, defaultHistoryContent);\n              }\n            };\n\n            for (var _iterator10 = anc.states[Symbol.iterator](), _step10; !(_iteratorNormalCompletion10 = (_step10 = _iterator10.next()).done); _iteratorNormalCompletion10 = true) {\n              _loop();\n            }\n          } catch (err) {\n            _didIteratorError10 = true;\n            _iteratorError10 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion10 && _iterator10.return) {\n                _iterator10.return();\n              }\n            } finally {\n              if (_didIteratorError10) {\n                throw _iteratorError10;\n              }\n            }\n          }\n        }\n      };\n      var _iteratorNormalCompletion11 = true;\n      var _didIteratorError11 = false;\n      var _iteratorError11 = undefined;\n\n      try {\n        for (var _iterator11 = query.getAncestors(state, ancestor)[Symbol.iterator](), _step11; !(_iteratorNormalCompletion11 = (_step11 = _iterator11.next()).done); _iteratorNormalCompletion11 = true) {\n          var anc = _step11.value;\n\n          statesToEnter.add(anc);\n          traverse(anc);\n        }\n      } catch (err) {\n        _didIteratorError11 = true;\n        _iteratorError11 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion11 && _iterator11.return) {\n            _iterator11.return();\n          }\n        } finally {\n          if (_didIteratorError11) {\n            throw _iteratorError11;\n          }\n        }\n      }\n\n      traverse(ancestor);\n    }\n  }, {\n    key: '_addDescendantStatesToEnter',\n    value: function _addDescendantStatesToEnter(state, statesToEnter, statesForDefaultEntry, defaultHistoryContent) {\n      var _this8 = this;\n\n      if (state.typeEnum === HISTORY) {\n        if (this._historyValue[state.id]) {\n          var _iteratorNormalCompletion12 = true;\n          var _didIteratorError12 = false;\n          var _iteratorError12 = undefined;\n\n          try {\n            for (var _iterator12 = this._historyValue[state.id][Symbol.iterator](), _step12; !(_iteratorNormalCompletion12 = (_step12 = _iterator12.next()).done); _iteratorNormalCompletion12 = true) {\n              var s = _step12.value;\n\n              this._addDescendantStatesToEnter(s, statesToEnter, statesForDefaultEntry, defaultHistoryContent);\n            }\n          } catch (err) {\n            _didIteratorError12 = true;\n            _iteratorError12 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion12 && _iterator12.return) {\n                _iterator12.return();\n              }\n            } finally {\n              if (_didIteratorError12) {\n                throw _iteratorError12;\n              }\n            }\n          }\n\n          var _iteratorNormalCompletion13 = true;\n          var _didIteratorError13 = false;\n          var _iteratorError13 = undefined;\n\n          try {\n            for (var _iterator13 = this._historyValue[state.id][Symbol.iterator](), _step13; !(_iteratorNormalCompletion13 = (_step13 = _iterator13.next()).done); _iteratorNormalCompletion13 = true) {\n              var _s2 = _step13.value;\n\n              this._addAncestorStatesToEnter(_s2, state.parent, statesToEnter, statesForDefaultEntry, defaultHistoryContent);\n            }\n          } catch (err) {\n            _didIteratorError13 = true;\n            _iteratorError13 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion13 && _iterator13.return) {\n                _iterator13.return();\n              }\n            } finally {\n              if (_didIteratorError13) {\n                throw _iteratorError13;\n              }\n            }\n          }\n        } else {\n          defaultHistoryContent[state.parent.id] = state.transitions[0];\n          var _iteratorNormalCompletion14 = true;\n          var _didIteratorError14 = false;\n          var _iteratorError14 = undefined;\n\n          try {\n            for (var _iterator14 = state.transitions[0].targets[Symbol.iterator](), _step14; !(_iteratorNormalCompletion14 = (_step14 = _iterator14.next()).done); _iteratorNormalCompletion14 = true) {\n              var _s3 = _step14.value;\n\n              this._addDescendantStatesToEnter(_s3, statesToEnter, statesForDefaultEntry, defaultHistoryContent);\n            }\n          } catch (err) {\n            _didIteratorError14 = true;\n            _iteratorError14 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion14 && _iterator14.return) {\n                _iterator14.return();\n              }\n            } finally {\n              if (_didIteratorError14) {\n                throw _iteratorError14;\n              }\n            }\n          }\n\n          var _iteratorNormalCompletion15 = true;\n          var _didIteratorError15 = false;\n          var _iteratorError15 = undefined;\n\n          try {\n            for (var _iterator15 = state.transitions[0].targets[Symbol.iterator](), _step15; !(_iteratorNormalCompletion15 = (_step15 = _iterator15.next()).done); _iteratorNormalCompletion15 = true) {\n              var _s4 = _step15.value;\n\n              this._addAncestorStatesToEnter(_s4, state.parent, statesToEnter, statesForDefaultEntry, defaultHistoryContent);\n            }\n          } catch (err) {\n            _didIteratorError15 = true;\n            _iteratorError15 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion15 && _iterator15.return) {\n                _iterator15.return();\n              }\n            } finally {\n              if (_didIteratorError15) {\n                throw _iteratorError15;\n              }\n            }\n          }\n        }\n      } else {\n        statesToEnter.add(state);\n        if (state.typeEnum === COMPOSITE) {\n          statesForDefaultEntry.add(state);\n          //for each state in initialRef, if it is an initial state, then add ancestors and descendants.\n          var _iteratorNormalCompletion16 = true;\n          var _didIteratorError16 = false;\n          var _iteratorError16 = undefined;\n\n          try {\n            for (var _iterator16 = state.initialRef[Symbol.iterator](), _step16; !(_iteratorNormalCompletion16 = (_step16 = _iterator16.next()).done); _iteratorNormalCompletion16 = true) {\n              var _s5 = _step16.value;\n\n              var targets = _s5.typeEnum === INITIAL ? _s5.transitions[0].targets : [_s5];\n              var _iteratorNormalCompletion18 = true;\n              var _didIteratorError18 = false;\n              var _iteratorError18 = undefined;\n\n              try {\n                for (var _iterator18 = targets[Symbol.iterator](), _step18; !(_iteratorNormalCompletion18 = (_step18 = _iterator18.next()).done); _iteratorNormalCompletion18 = true) {\n                  var targetState = _step18.value;\n\n                  this._addDescendantStatesToEnter(targetState, statesToEnter, statesForDefaultEntry, defaultHistoryContent);\n                }\n              } catch (err) {\n                _didIteratorError18 = true;\n                _iteratorError18 = err;\n              } finally {\n                try {\n                  if (!_iteratorNormalCompletion18 && _iterator18.return) {\n                    _iterator18.return();\n                  }\n                } finally {\n                  if (_didIteratorError18) {\n                    throw _iteratorError18;\n                  }\n                }\n              }\n            }\n          } catch (err) {\n            _didIteratorError16 = true;\n            _iteratorError16 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion16 && _iterator16.return) {\n                _iterator16.return();\n              }\n            } finally {\n              if (_didIteratorError16) {\n                throw _iteratorError16;\n              }\n            }\n          }\n\n          var _iteratorNormalCompletion17 = true;\n          var _didIteratorError17 = false;\n          var _iteratorError17 = undefined;\n\n          try {\n            for (var _iterator17 = state.initialRef[Symbol.iterator](), _step17; !(_iteratorNormalCompletion17 = (_step17 = _iterator17.next()).done); _iteratorNormalCompletion17 = true) {\n              var _s6 = _step17.value;\n\n              var _targets = _s6.typeEnum === INITIAL ? _s6.transitions[0].targets : [_s6];\n              var _iteratorNormalCompletion19 = true;\n              var _didIteratorError19 = false;\n              var _iteratorError19 = undefined;\n\n              try {\n                for (var _iterator19 = _targets[Symbol.iterator](), _step19; !(_iteratorNormalCompletion19 = (_step19 = _iterator19.next()).done); _iteratorNormalCompletion19 = true) {\n                  var _targetState = _step19.value;\n\n                  this._addAncestorStatesToEnter(_targetState, state, statesToEnter, statesForDefaultEntry, defaultHistoryContent);\n                }\n              } catch (err) {\n                _didIteratorError19 = true;\n                _iteratorError19 = err;\n              } finally {\n                try {\n                  if (!_iteratorNormalCompletion19 && _iterator19.return) {\n                    _iterator19.return();\n                  }\n                } finally {\n                  if (_didIteratorError19) {\n                    throw _iteratorError19;\n                  }\n                }\n              }\n            }\n          } catch (err) {\n            _didIteratorError17 = true;\n            _iteratorError17 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion17 && _iterator17.return) {\n                _iterator17.return();\n              }\n            } finally {\n              if (_didIteratorError17) {\n                throw _iteratorError17;\n              }\n            }\n          }\n        } else {\n          if (state.typeEnum === PARALLEL) {\n            var _iteratorNormalCompletion20 = true;\n            var _didIteratorError20 = false;\n            var _iteratorError20 = undefined;\n\n            try {\n              var _loop2 = function _loop2() {\n                var child = _step20.value;\n\n                if (child.typeEnum !== HISTORY && ![].concat(_toConsumableArray(statesToEnter)).some(function (s) {\n                  return query.isDescendant(s, child);\n                })) {\n                  _this8._addDescendantStatesToEnter(child, statesToEnter, statesForDefaultEntry, defaultHistoryContent);\n                }\n              };\n\n              for (var _iterator20 = state.states[Symbol.iterator](), _step20; !(_iteratorNormalCompletion20 = (_step20 = _iterator20.next()).done); _iteratorNormalCompletion20 = true) {\n                _loop2();\n              }\n            } catch (err) {\n              _didIteratorError20 = true;\n              _iteratorError20 = err;\n            } finally {\n              try {\n                if (!_iteratorNormalCompletion20 && _iterator20.return) {\n                  _iterator20.return();\n                }\n              } finally {\n                if (_didIteratorError20) {\n                  throw _iteratorError20;\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }, {\n    key: 'isInFinalState',\n    value: function isInFinalState(s) {\n      var _this9 = this;\n\n      if (s.typeEnum === COMPOSITE) {\n        return s.states.some(function (s) {\n          return s.typeEnum === FINAL && _this9._configuration.contains(s);\n        });\n      } else if (s.typeEnum === PARALLEL) {\n        return s.states.every(this.isInFinalState.bind(this));\n      } else {\n        return false;\n      }\n    }\n\n    /** @private */\n\n  }, {\n    key: '_evaluateAction',\n    value: function _evaluateAction(currentEvent, actionRef) {\n      try {\n        return actionRef.call(this._scriptingContext, currentEvent); //SCXML system variables\n      } catch (e) {\n        this._handleError(e, actionRef);\n      }\n    }\n  }, {\n    key: '_handleError',\n    value: function _handleError(e, actionRef) {\n      var event = e instanceof Error || typeof e.__proto__.name === 'string' && e.__proto__.name.match(/^.*Error$/) ? //we can't just do 'e instanceof Error', because the Error object in the sandbox is from a different context, and instanceof will return false\n      {\n        name: 'error.execution',\n        data: {\n          tagname: actionRef.tagname,\n          line: actionRef.line,\n          column: actionRef.column,\n          reason: e.message\n        },\n        type: 'platform'\n      } : e.name ? e : {\n        name: 'error.execution',\n        data: e,\n        type: 'platform'\n      };\n      this._internalEventQueue.push(event);\n      this.emit('onError', event);\n    }\n  }, {\n    key: '_log',\n    value: function _log() {\n      if (printTrace) {\n        var args = Array.from(arguments);\n        this.opts.console.log(args[0] + ': ' + args.slice(1).map(function (arg) {\n          return arg === null ? 'null' : arg === undefined ? 'undefined' : typeof arg === 'string' ? arg : arg.toString() === '[object Object]' ? util.inspect(arg) : arg.toString();\n        }).join(', ') + '\\n');\n      }\n    }\n\n    /**\n    * @interface Listener\n    */\n\n    /**\n    * @function\n    * @name Listener#onEntry \n    * @param {string} stateId\n    */\n\n    /**\n    * @function\n    * @name Listener#onExit \n    * @param {string} stateId\n    */\n\n    /**\n    * @function\n    * @name Listener#onTransition \n    * @param {string} sourceStateId Id of the source state\n    * @param {Array<string>} targetStatesIds Ids of the target states\n    * @param {number} transitionIndex Index of the transition relative to other transitions originating from source state.\n    */\n\n    /**\n    * @function\n    * @name Listener#onError\n    * @param {Error} errorInfo\n    */\n\n    /**\n    * @function\n    * @name Listener#onBigStepBegin\n    */\n\n    /**\n    * @function\n    * @name Listener#onBigStepResume\n    */\n\n    /**\n    * @function\n    * @name Listener#onBigStepSuspend\n    */\n\n    /**\n    * @function\n    * @name Listener#onBigStepEnd\n    */\n\n    /**\n    * @function\n    * @name Listener#onSmallStepBegin\n    * @param {string} event\n    */\n\n    /**\n    * @function\n    * @name Listener#onSmallStepEnd\n    */\n\n    /** \n    * Provides a generic mechanism to subscribe to state change and runtime\n    * error notifications.  Can be used for logging and debugging. For example,\n    * can attach a logger that simply logs the state changes.  Or can attach a\n    * network debugging client that sends state change notifications to a\n    * debugging server.\n    * This is an alternative interface to {@link EventEmitter.prototype#on}.\n    * @memberof BaseInterpreter.prototype \n    * @param {Listener} listener\n    */\n\n  }, {\n    key: 'registerListener',\n    value: function registerListener(listener) {\n      BaseInterpreter.EVENTS.forEach(function (event) {\n        if (listener[event]) this.on(event, listener[event]);\n      }, this);\n    }\n\n    /** \n    * Unregister a Listener\n    * @memberof BaseInterpreter.prototype \n    * @param {Listener} listener\n    */\n\n  }, {\n    key: 'unregisterListener',\n    value: function unregisterListener(listener) {\n      BaseInterpreter.EVENTS.forEach(function (event) {\n        if (listener[event]) this.off(event, listener[event]);\n      }, this);\n    }\n\n    /** \n    * Query the model to get all transition events.\n    * @return {Array<string>} Transition events.\n    * @memberof BaseInterpreter.prototype \n    */\n\n  }, {\n    key: 'getAllTransitionEvents',\n    value: function getAllTransitionEvents() {\n      var events = {};\n      function getEvents(state) {\n\n        if (state.transitions) {\n          for (var txIdx = 0, txLen = state.transitions.length; txIdx < txLen; txIdx++) {\n            events[state.transitions[txIdx].event] = true;\n          }\n        }\n\n        if (state.states) {\n          for (var stateIdx = 0, stateLen = state.states.length; stateIdx < stateLen; stateIdx++) {\n            getEvents(state.states[stateIdx]);\n          }\n        }\n      }\n\n      getEvents(this._model);\n\n      return Object.keys(events);\n    }\n\n    /**\n    * Three things capture the current snapshot of a running SCION interpreter:\n    *\n    *      <ul>\n    *      <li> basic configuration (the set of basic states the state machine is in)</li>\n    *      <li> history state values (the states the state machine was in last time it was in the parent of a history state)</li>\n    *      <li> the datamodel</li>\n    *      </ul>\n    *      \n    * The snapshot object can be serialized as JSON and saved to a database. It can\n    * later be passed to the SCXML constructor to restore the state machine\n    * using the snapshot argument.\n    *\n    * @return {Snapshot} \n    * @memberof BaseInterpreter.prototype \n    */\n\n  }, {\n    key: 'getSnapshot',\n    value: function getSnapshot() {\n      return [this.getConfiguration(), this._serializeHistory(), this._isInFinalState, this._model.$serializeDatamodel(), this._internalEventQueue.slice()];\n    }\n  }, {\n    key: '_serializeHistory',\n    value: function _serializeHistory() {\n      var o = {};\n      Object.keys(this._historyValue).forEach(function (sid) {\n        o[sid] = this._historyValue[sid].map(function (state) {\n          return state.id;\n        });\n      }, this);\n      return o;\n    }\n\n    /**\n     * @interface Event\n     */\n\n    /** \n    * @member name\n    * @memberof Event.prototype \n    * @type string\n    * @description The name of the event\n    */\n\n    /** \n    * @member data\n    * @memberof Event.prototype \n    * @type any\n    * @description The event data\n    */\n\n    /** \n    * An SCXML interpreter takes SCXML events as input, where an SCXML event is an\n    * object with \"name\" and \"data\" properties. These can be passed to method `gen`\n    * as two positional arguments, or as a single object.\n    * @param {string|Event} evtObjOrName\n    * @param {any=} optionalData\n    * @emits scion.BaseInterpreter#onEntry\n    * @emits scion.BaseInterpreter#onExit\n    * @emits scion.BaseInterpreter#onTransition\n    * @emits scion.BaseInterpreter#onDefaultEntry\n    * @emits scion.BaseInterpreter#onError\n    * @emits scion.BaseInterpreter#onBigStepBegin\n    * @emits scion.BaseInterpreter#onBigStepEnd\n    * @emits scion.BaseInterpreter#onBigStepSuspend\n    * @emits scion.BaseInterpreter#onBigStepResume\n    * @emits scion.BaseInterpreter#onSmallStepBegin\n    * @emits scion.BaseInterpreter#onSmallStepEnd\n    * @emits scion.BaseInterpreter#onBigStepEnd\n    * @emits scion.BaseInterpreter#onExitInterpreter\n    */\n\n  }, {\n    key: 'gen',\n    value: function gen(evtObjOrName, optionalData) {\n      var currentEvent;\n      switch (typeof evtObjOrName === 'undefined' ? 'undefined' : _typeof(evtObjOrName)) {\n        case 'string':\n          currentEvent = { name: evtObjOrName, data: optionalData };\n          break;\n        case 'object':\n          if (typeof evtObjOrName.name === 'string') {\n            currentEvent = evtObjOrName;\n          } else {\n            throw new Error('Event object must have \"name\" property of type string.');\n          }\n          break;\n        default:\n          throw new Error('First argument to gen must be a string or object.');\n      }\n\n      if (this._isStepping) throw new Error('Cannot call gen during a big-step');\n\n      //otherwise, kick him off\n      this._isStepping = true;\n\n      this._performBigStep(currentEvent);\n\n      this._isStepping = false;\n      return this.getConfiguration();\n    }\n\n    /**\n    * Injects an external event into the interpreter asynchronously\n    * @param {Event}  currentEvent The event to inject\n    * @param {genCallback} cb Callback invoked with an error or the interpreter's stable configuration\n    * @emits scion.BaseInterpreter#onEntry\n    * @emits scion.BaseInterpreter#onExit\n    * @emits scion.BaseInterpreter#onTransition\n    * @emits scion.BaseInterpreter#onDefaultEntry\n    * @emits scion.BaseInterpreter#onError\n    * @emits scion.BaseInterpreter#onBigStepBegin\n    * @emits scion.BaseInterpreter#onBigStepEnd\n    * @emits scion.BaseInterpreter#onBigStepSuspend\n    * @emits scion.BaseInterpreter#onBigStepResume\n    * @emits scion.BaseInterpreter#onSmallStepBegin\n    * @emits scion.BaseInterpreter#onSmallStepEnd\n    * @emits scion.BaseInterpreter#onBigStepEnd\n    * @emits scion.BaseInterpreter#onExitInterpreter\n    */\n\n  }, {\n    key: 'genAsync',\n    value: function genAsync(currentEvent, cb) {\n      if (currentEvent !== null && ((typeof currentEvent === 'undefined' ? 'undefined' : _typeof(currentEvent)) !== 'object' || !currentEvent || typeof currentEvent.name !== 'string')) {\n        throw new Error('Expected currentEvent to be null or an Object with a name');\n      }\n\n      if (typeof cb !== 'function') {\n        cb = nop;\n      }\n\n      this._externalEventQueue.push([currentEvent, cb]);\n\n      //the semantics we want are to return to the cb the results of processing that particular event.\n      function nextStep(e, c) {\n        this._performBigStepAsync(e, function (err, config) {\n          c(err, config);\n\n          if (this._externalEventQueue.length) {\n            nextStep.apply(this, this._externalEventQueue.shift());\n          } else {\n            this._isStepping = false;\n          }\n        }.bind(this));\n      }\n      if (!this._isStepping) {\n        this._isStepping = true;\n        nextStep.apply(this, this._externalEventQueue.shift());\n      }\n    }\n  }]);\n\n  return BaseInterpreter;\n}(EventEmitter);\n\nBaseInterpreter.EVENTS = ['onEntry', 'onExit', 'onTransition', 'onDefaultEntry', 'onError', 'onBigStepBegin', 'onBigStepSuspend', 'onBigStepResume', 'onSmallStepBegin', 'onSmallStepEnd', 'onBigStepEnd', 'onExitInterpreter'];\n\n//some global singletons to use to generate in-memory session ids, in case the user does not specify these data structures\nBaseInterpreter.sessionIdCounter = 1;\nBaseInterpreter.generateSessionid = function () {\n  return BaseInterpreter.sessionIdCounter++;\n};\nBaseInterpreter.sessionRegistry = new Map();\n\n// Do nothing\n\nfunction nop() {}\n\nvar InterpreterScriptingContext = function () {\n  function InterpreterScriptingContext(interpreter) {\n    _classCallCheck(this, InterpreterScriptingContext);\n\n    this._interpreter = interpreter;\n    this._timeoutMap = {};\n    this._invokeMap = {};\n    this._timeouts = new Set();\n\n    //Regex from:\n    //  http://daringfireball.net/2010/07/improved_regex_for_matching_urls\n    //  http://stackoverflow.com/a/6927878\n    this.validateUriRegex = /(#_.*)|\\b((?:[a-z][\\w-]+:(?:\\/{1,3}|[a-z0-9%])|www\\d{0,3}[.]|[a-z0-9.\\-]+[.][a-z]{2,4}\\/)(?:[^\\s()<>]+|\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\))+(?:\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\)|[^\\s`!()\\[\\]{};:'\".,<>?«»“”‘’]))/i;\n\n    this.invokeSendTargetRegex = /^#_(.*)$/;\n    this.scxmlSendTargetRegex = /^#_scxml_(.*)$/;\n  }\n\n  _createClass(InterpreterScriptingContext, [{\n    key: 'raise',\n    value: function raise(event) {\n      this._installDefaultPropsOnEvent(event, true);\n      this._interpreter._internalEventQueue.push(event);\n    }\n  }, {\n    key: 'parseXmlStringAsDOM',\n    value: function parseXmlStringAsDOM(xmlString) {\n      return (this._interpreter.opts.xmlParser || InterpreterScriptingContext.xmlParser).parse(xmlString);\n    }\n  }, {\n    key: 'invoke',\n    value: function invoke(invokeObj) {\n      var _this10 = this;\n\n      //look up invoker by type. assume invokers are passed in as an option to constructor\n      this._invokeMap[invokeObj.id] = new Promise(function (resolve, reject) {\n        (_this10._interpreter.opts.invokers || InterpreterScriptingContext.invokers)[invokeObj.type](_this10._interpreter, invokeObj, function (err, session) {\n          if (err) return reject(err);\n\n          _this10._interpreter.emit('onInvokedSessionInitialized', session);\n          resolve(session);\n        });\n      });\n    }\n  }, {\n    key: 'cancelInvoke',\n    value: function cancelInvoke(invokeid) {\n      var _this11 = this;\n\n      //TODO: on cancel invoke clean up this._invokeMap\n      var sessionPromise = this._invokeMap[invokeid];\n      this._interpreter._log('cancelling session with invokeid ' + invokeid);\n      if (sessionPromise) {\n        this._interpreter._log('sessionPromise found');\n        sessionPromise.then(function (session) {\n          _this11._interpreter._log('resolved session ' + invokeid + '. cancelling... ');\n          session.cancel();\n          //clean up\n          delete _this11._invokeMap[invokeid];\n        }, function (err) {\n          //TODO: dispatch error back into the state machine as error.communication\n        });\n      }\n    }\n  }, {\n    key: '_installDefaultPropsOnEvent',\n    value: function _installDefaultPropsOnEvent(event, isInternal) {\n      if (!isInternal) {\n        event.origin = this._interpreter.opts._x._ioprocessors.scxml.location; //TODO: preserve original origin when we autoforward? \n        event.origintype = event.type || SCXML_IOPROCESSOR_TYPE;\n      }\n      if (typeof event.type === 'undefined') {\n        event.type = isInternal ? 'internal' : 'external';\n      }\n      ['name', 'sendid', 'invokeid', 'data', 'origin', 'origintype'].forEach(function (prop) {\n        if (typeof event[prop] === 'undefined') {\n          event[prop] = undefined;\n        }\n      });\n    }\n  }, {\n    key: 'send',\n    value: function send(event, options) {\n      this._interpreter._log('send event', event, options);\n      options = options || {};\n      var sendType = options.type || SCXML_IOPROCESSOR_TYPE;\n      //TODO: move these out\n      function validateSend(event, options, sendAction) {\n        if (event.target) {\n          var targetIsValidUri = this.validateUriRegex.test(event.target);\n          if (!targetIsValidUri) {\n            throw { name: \"error.execution\", data: 'Target is not valid URI', sendid: event.sendid, type: 'platform' };\n          }\n        }\n        if (sendType !== SCXML_IOPROCESSOR_TYPE) {\n          //TODO: extend this to support HTTP, and other IO processors\n          throw { name: \"error.execution\", data: 'Unsupported event processor type', sendid: event.sendid, type: 'platform' };\n        }\n\n        sendAction.call(this, event, options);\n      }\n\n      function defaultSendAction(event, options) {\n        var _this12 = this;\n\n        if (typeof setTimeout === 'undefined') throw new Error('Default implementation of BaseInterpreter.prototype.send will not work unless setTimeout is defined globally.');\n\n        var match;\n        if (event.target === '#_internal') {\n          this.raise(event);\n        } else {\n          this._installDefaultPropsOnEvent(event, false);\n          event.origintype = SCXML_IOPROCESSOR_TYPE; //TODO: extend this to support HTTP, and other IO processors\n          //TODO : paramterize this based on send/@type?\n          if (!event.target) {\n            doSend.call(this, this._interpreter);\n          } else if (event.target === '#_parent') {\n            if (this._interpreter.opts.parentSession) {\n              event.invokeid = this._interpreter.opts.invokeid;\n              doSend.call(this, this._interpreter.opts.parentSession);\n            } else {\n              throw { name: \"error.communication\", data: 'Parent session not specified', sendid: event.sendid, type: 'platform' };\n            }\n          } else if (match = event.target.match(this.scxmlSendTargetRegex)) {\n            var targetSessionId = match[1];\n            var session = this._interpreter.opts.sessionRegistry.get(targetSessionId);\n            if (session) {\n              doSend.call(this, session);\n            } else {\n              throw { name: 'error.communication', sendid: event.sendid, type: 'platform' };\n            }\n          } else if (match = event.target.match(this.invokeSendTargetRegex)) {\n            //TODO: test this code path.\n            var invokeId = match[1];\n            this._invokeMap[invokeId].then(function (session) {\n              doSend.call(_this12, session);\n            });\n          } else {\n            throw new Error('Unrecognized send target.'); //TODO: dispatch error back into the state machine\n          }\n        }\n\n        function doSend(session) {\n          //TODO: we probably now need to refactor data structures:\n          //    this._timeouts\n          //    this._timeoutMap\n          var timeoutHandle = setTimeout(function () {\n            if (event.sendid) delete this._timeoutMap[event.sendid];\n            this._timeouts.delete(timeoutOptions);\n            if (this._interpreter.opts.doSend) {\n              this._interpreter.opts.doSend(session, event);\n            } else {\n              session[this._interpreter.opts.sendAsync ? 'genAsync' : 'gen'](event);\n            }\n          }.bind(this), options.delay || 0);\n\n          var timeoutOptions = {\n            sendOptions: options,\n            timeoutHandle: timeoutHandle\n          };\n          if (event.sendid) this._timeoutMap[event.sendid] = timeoutHandle;\n          this._timeouts.add(timeoutOptions);\n        }\n      }\n\n      function publish() {\n        this._interpreter.emit(event.name, event.data);\n      }\n\n      //choose send function\n      //TODO: rethink how this custom send works\n      var sendFn;\n      if (event.type === 'https://github.com/jbeard4/SCION#publish') {\n        sendFn = publish;\n      } else if (this._interpreter.opts.customSend) {\n        sendFn = this._interpreter.opts.customSend;\n      } else {\n        sendFn = defaultSendAction;\n      }\n\n      options = options || {};\n\n      this._interpreter._log(\"sending event\", event.name, \"with content\", event.data, \"after delay\", options.delay);\n\n      validateSend.call(this, event, options, sendFn);\n    }\n  }, {\n    key: 'cancel',\n    value: function cancel(sendid) {\n      if (this._interpreter.opts.customCancel) {\n        return this._interpreter.opts.customCancel.apply(this, [sendid]);\n      }\n\n      if (typeof clearTimeout === 'undefined') throw new Error('Default implementation of BaseInterpreter.prototype.cancel will not work unless setTimeout is defined globally.');\n\n      if (sendid in this._timeoutMap) {\n        this._interpreter._log(\"cancelling \", sendid, \" with timeout id \", this._timeoutMap[sendid]);\n        clearTimeout(this._timeoutMap[sendid]);\n      }\n    }\n  }]);\n\n  return InterpreterScriptingContext;\n}();\n\nmodule.exports = extend(new EventEmitter(), {\n  BaseInterpreter: BaseInterpreter,\n  ArraySet: ArraySet,\n  STATE_TYPES: constants.STATE_TYPES,\n  initializeModel: initializeModel,\n  InterpreterScriptingContext: InterpreterScriptingContext,\n  helpers: helpers,\n  query: query\n});\n\n}).call(this,require('_process'))\n},{\"./ArraySet\":6,\"./constants\":7,\"./helpers\":8,\"./query\":9,\"_process\":2,\"tiny-events\":11,\"util\":5}],11:[function(require,module,exports){\nfunction EventEmitter() {\n    this._listeners = {};\n}\n\nEventEmitter.prototype.on = function _on(type, listener) {\n    if (!Array.isArray(this._listeners[type])) {\n        this._listeners[type] = [];\n    }\n\n    if (this._listeners[type].indexOf(listener) === -1) {\n        this._listeners[type].push(listener);\n    }\n\n    return this;\n};\n\nEventEmitter.prototype.once = function _once(type, listener) {\n    var self = this;\n\n    function __once() {\n        for (var args = [], i = 0; i < arguments.length; i += 1) {\n            args[i] = arguments[i];\n        }\n\n        self.off(type, __once);\n        listener.apply(self, args);\n    }\n\n    __once.listener = listener;\n\n    return this.on(type, __once);\n};\n\nEventEmitter.prototype.off = function _off(type, listener) {\n    if (!Array.isArray(this._listeners[type])) {\n        return this;\n    }\n\n    if (typeof listener === 'undefined') {\n        this._listeners[type] = [];\n        return this;\n    }\n\n    var index = this._listeners[type].indexOf(listener);\n\n    if (index === -1) {\n        for (var i = 0; i < this._listeners[type].length; i += 1) {\n            if (this._listeners[type][i].listener === listener) {\n                index = i;\n                break;\n            }\n        }\n    }\n\n    this._listeners[type].splice(index, 1);\n    return this;\n};\n\nEventEmitter.prototype.emit = function _emit(type) {\n    if (!Array.isArray(this._listeners[type])) {\n        return this;\n    }\n\n    for (var args = [], i = 1; i < arguments.length; i += 1) {\n        args[i - 1] = arguments[i];\n    }\n\n    this._listeners[type].forEach(function __emit(listener) {\n        listener.apply(this, args);\n    }, this);\n\n    return this;\n};\n\nmodule.exports.EventEmitter = EventEmitter;\n\n},{}]},{},[1])(1)\n});"]}