!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("inferno"),require("stream")):"function"==typeof define&&define.amd?define(["exports","inferno","stream"],t):t((e.Inferno=e.Inferno||{},e.Inferno.Server=e.Inferno.Server||{}),e.Inferno,null)}(this,function(e,N,t){"use strict";var r="a runtime error occured! Use Inferno in development environment to find the error.";function _(e){return V(e)||B(e)}function C(e){return B(e)||!1===e||R(e)||V(e)}function w(e){return"function"==typeof e}function M(e){return"string"==typeof e}function I(e){return"number"==typeof e}function B(e){return null===e}function R(e){return!0===e}function V(e){return void 0===e}function E(e){throw e||(e=r),new Error("Inferno Error: "+e)}function O(e,t){var r={};if(e)for(var n in e)r[n]=e[n];if(t)for(var o in t)r[o]=t[o];return r}"undefined"==typeof window||window.document;var s=new RegExp(/["'&<>]/);function j(e){if(!s.test(e))return e;var t,r="",n="",o=0;for(t=0;t<e.length;t++){switch(e.charCodeAt(t)){case 34:n="&quot;";break;case 39:n="&#039;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}o<t&&(r+=e.slice(o,t)),r+=n,o=t+1}return r+e.slice(o,t)}var n=/[A-Z]/g,o={};function i(e){return void 0!==o[e]?o[e]:o[e]=e.replace(n,"-$&").toLowerCase()+":"}var A=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]);function W(e){if(M(e))return e;var t="";for(var r in e){var n=e[r];M(n)?t+=""+i(r)+n+";":I(n)&&(t+=""+i(r)+N.getNumberStyleValue(r,n)+";")}return t}function u(e){return function e(t,r,n,o){var s=t.flags,i=t.type,u=t.props||N.EMPTY_OBJ,a=t.children;if(0<(14&s)){if(4&s){var c,l=new i(u,n);if(l.$BS=!1,w(l.getChildContext)&&(c=l.getChildContext()),c=_(c)?n:O(n,c),l.props===N.EMPTY_OBJ&&(l.props=u),l.context=n,l.$UN=!1,w(l.componentWillMount)&&(l.$BR=!0,l.componentWillMount(),l.$BR=!1),l.$PSS){var d=l.state,h=l.$PS;if(null===d)l.state=h;else for(var f in h)d[f]=h[f];l.$PSS=!1,l.$PS=null}var p=l.render(u,l.state,l.context);return C(p)?"\x3c!--!--\x3e":M(p)?j(p):I(p)?p+"":e(p,t,c,!0)}var v=i(u,n);return C(v)?"\x3c!--!--\x3e":M(v)?j(v):I(v)?v+"":e(v,t,n,!0)}if(0<(481&s)){var m,y="<"+i,x=A.has(i),g=t.className;if(M(g)?y+=' class="'+j(g)+'"':I(g)&&(y+=' class="'+g+'"'),!B(u)){for(var S in u){var T=u[S];switch(S){case"dangerouslySetInnerHTML":m=T.__html;break;case"style":_(u.style)||(y+=' style="'+W(u.style)+'"');break;case"children":case"className":break;case"defaultValue":u.value||(y+=' value="'+(M(T)?j(T):T)+'"');break;case"defaultChecked":u.checked||(y+=' checked="'+T+'"');break;default:M(T)?y+=" "+S+'="'+j(T)+'"':I(T)?y+=" "+S+'="'+T+'"':R(T)&&(y+=" "+S)}}"option"===i&&void 0!==u.value&&u.value===r.props.value&&(y+=" selected")}if(x)y+=">";else{y+=">";var b=t.childFlags;if(2&b)y+=e(a,t,n,!0);else if(12&b)for(var k=0,Q=a.length;k<Q;k++)y+=e(a[k],t,n,0===k);else m&&(y+=m);x||(y+="</"+i+">")}return y}if(0<(16&s))return(o?"":"\x3c!----\x3e")+(""===a?" ":j(a));E()}(e,{},{},!0)}var a=function(t){function e(e){t.call(this),this.collector=[Infinity],this.promises=[],this.pushQueue=this.pushQueue.bind(this),e&&this.renderVNodeToQueue(e,null,!1,null)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._read=function(){setTimeout(this.pushQueue,0)},e.prototype.addToQueue=function(e,t){if(_(t))"string"==typeof e&&this.collector.length-1==0?this.push(e):"string"==typeof e&&"string"==typeof this.collector[this.collector.length-2]?this.collector[this.collector.length-2]+=e:this.collector.splice(-1,0,e);else{var r=this.promises[t].length-1;"string"==typeof this.promises[t][r]&&"string"==typeof e?this.promises[t][r]+=e:this.promises[t].push(e)}},e.prototype.pushQueue=function(){var e=this.collector[0];if("string"==typeof e)this.push(e),this.collector.shift();else if(e&&("object"==typeof e||w(e))&&w(e.then)){var r=this;e.then(function(e){var t;(t=r.collector).splice.apply(t,[0,1].concat(r.promises[e])),r.promises[e]=null,setTimeout(r.pushQueue,0)}),this.collector[0]=null}else Infinity===e&&this.emit("end")},e.prototype.renderVNodeToQueue=function(e,t,r,n){var o=this,s=e.flags,i=e.type,u=e.props||N.EMPTY_OBJ,a=e.children;if(0<(14&s))if(4&s){var c,l=new i(u,t);if(l.$BS=!1,V(l.getChildContext)||(c=l.getChildContext()),_(c)||(t=O(t,c)),l.props===N.EMPTY_OBJ&&(l.props=u),l.context=t,l.$UN=!1,w(l.componentWillMount)){if(l.$BR=!0,l.componentWillMount(),l.$PSS){var d=l.state,h=l.$PS;if(null===d)l.state=h;else for(var f in h)d[f]=h[f];l.$PSS=!1,l.$PS=null}l.$BR=!1}if(w(l.getInitialProps)){var p=l.getInitialProps(l.props,l.context);if(p){if(Promise.resolve(p)===p){var v=this.promises.push([])-1;return void this.addToQueue(p.then(function(e){l.$PSS=!1,"object"==typeof e&&(l.props=O(l.props,e));var t=l.render(l.props,l.state,l.context);return C(t)?o.addToQueue("\x3c!--!--\x3e",v):M(t)?o.addToQueue(j(t),v):I(t)?o.addToQueue(t+"",v):o.renderVNodeToQueue(t,l.context,!0,v),setTimeout(o.pushQueue,0),v}),n)}l.props=O(l.props,p)}}var m=l.render(l.props,l.state,l.context);l.$PSS=!1,C(m)?this.addToQueue("\x3c!--!--\x3e",n):M(m)?this.addToQueue(j(m),n):I(m)?this.addToQueue(m+"",n):this.renderVNodeToQueue(m,t,!0,n)}else{var y=i(u,t);C(y)?this.addToQueue("\x3c!--!--\x3e",n):M(y)?this.addToQueue(j(y),n):I(y)?this.addToQueue(y+"",n):this.renderVNodeToQueue(y,t,!0,n)}else if(0<(481&s)){var x,g="<"+i,S=A.has(i),T=e.className;if(M(T)?g+=' class="'+j(T)+'"':I(T)&&(g+=' class="'+T+'"'),!B(u))for(var b in u){var k=u[b];switch(b){case"dangerouslySetInnerHTML":x=k.__html;break;case"style":_(u.style)||(g+=' style="'+W(u.style)+'"');break;case"children":case"className":break;case"defaultValue":u.value||(g+=' value="'+(M(k)?j(k):k)+'"');break;case"defaultChecked":u.checked||(g+=' checked="'+k+'"');break;default:M(k)?g+=" "+b+'="'+j(k)+'"':I(k)?g+=" "+b+'="'+k+'"':R(k)&&(g+=" "+b)}}if(S)this.addToQueue(g+">",n);else{g+=">";var Q=e.childFlags;if(2&Q)return this.addToQueue(g,n),this.renderVNodeToQueue(a,t,!0,n),void this.addToQueue("</"+i+">",n);if(12&Q){this.addToQueue(g,n),g="";for(var P=0,$=a.length;P<$;P++)o.renderVNodeToQueue(a[P],t,0===P,n)}if(x)return void this.addToQueue(g+x+"</"+i+">",n);S||this.addToQueue(g+"</"+i+">",n)}}else 0<(16&s)?this.addToQueue((r?"":"\x3c!----\x3e")+(""===a?" ":j(a)),n):E()},e}(t.Readable);function c(e){return new a(e)}var l=Promise.resolve(),d=function(t){function e(e){t.call(this),this.started=!1,this.initNode=e}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._read=function(){var t=this;this.started||(this.started=!0,l.then(function(){return t.renderNode(t.initNode,null,!1)}).then(function(){t.push(null)}).catch(function(e){t.emit("error",e)}))},e.prototype.renderNode=function(e,t,r){var n=e.flags;return 0<(14&n)?this.renderComponent(e,t,4&n):0<(481&n)?this.renderElement(e,t):this.renderText(e,r)},e.prototype.renderComponent=function(e,o,t){var s=this,r=e.type,n=e.props;if(!t){var i=r(n,o);return C(i)?this.push("\x3c!--!--\x3e"):M(i)?this.push(j(i)):I(i)?this.push(i+""):this.renderNode(i,o,!1)}var u,a=new r(n,o);return a.$BS=!1,w(a.getChildContext)&&(u=a.getChildContext()),_(u)||(o=O(o,u)),a.context=o,a.$BR=!0,Promise.resolve(a.componentWillMount&&a.componentWillMount()).then(function(){if(a.$PSS){var e=a.state,t=a.$PS;if(null===e)a.state=t;else for(var r in t)e[r]=t[r];a.$PSS=!1,a.$PS=null}a.$BR=!1;var n=a.render(a.props,a.state,a.context);return a.$PSS=!1,C(n)?s.push("\x3c!--!--\x3e"):M(n)?s.push(j(n)):I(n)?s.push(n+""):s.renderNode(n,o,!1)})},e.prototype.renderChildren=function(e,r,t){var n=this;return 2&t?this.renderNode(e,r,!1):12&t?e.reduce(function(e,t){return e.then(function(e){return 0<(16&t.flags)&&e&&n.push("\x3c!----\x3e"),Promise.resolve(n.renderNode(t,r,!1)).then(function(){return!!(16&t.flags)})})},Promise.resolve(!1)):void 0},e.prototype.renderText=function(e,t){this.push((t?"\x3c!----\x3e":"")+(""===e.children?" ":j(e.children)))},e.prototype.renderElement=function(e,t){var r,n=this,o=e.type,s=e.props,i="<"+o,u=A.has(o),a=e.className;if(M(a)?i+=' class="'+j(a)+'"':I(a)&&(i+=' class="'+a+'"'),!B(s))for(var c in s){var l=s[c];switch(c){case"dangerouslySetInnerHTML":r=l.__html;break;case"style":_(s.style)||(i+=' style="'+W(s.style)+'"');break;case"children":case"className":break;case"defaultValue":s.value||(i+=' value="'+(M(l)?j(l):l)+'"');break;case"defaultChecked":s.checked||(i+=' checked="'+l+'"');break;default:M(l)?i+=" "+c+'="'+j(l)+'"':I(l)?i+=" "+c+'="'+l+'"':R(l)&&(i+=" "+c)}}if(u)return i+=">",void this.push(i);if(i+=">",this.push(i),r)return this.push(r),void this.push("</"+o+">");var d=e.childFlags;if(!(1&d))return Promise.resolve(this.renderChildren(e.children,t,d)).then(function(){n.push("</"+o+">")});this.push("</"+o+">")},e}(t.Readable);function h(e){return new d(e)}e.RenderQueueStream=a,e.RenderStream=d,e.renderToStaticMarkup=u,e.renderToString=u,e.streamAsStaticMarkup=h,e.streamAsString=h,e.streamQueueAsStaticMarkup=c,e.streamQueueAsString=c,Object.defineProperty(e,"__esModule",{value:!0})});
