!function(t,e){window.MockAjax=function(t,e){e().ajax=function(t){var e={};return e.RequestStub=t.AjaxRequestStub(),e.RequestTracker=t.AjaxRequestTracker(),e.StubTracker=t.AjaxStubTracker(),e.ParamParser=t.AjaxParamParser(),e.event=t.AjaxEvent(),e.eventBus=t.AjaxEventBus(e.event),e.fakeRequest=t.AjaxFakeRequest(e.eventBus),e.MockAjax=t.MockAjax(e),e.MockAjax},e().AjaxEvent=function(){function t(){}function s(t,e){this.type=e,this.bubbles=!1,this.cancelable=!1,this.timeStamp=(new Date).getTime(),this.isTrusted=!1,this.defaultPrevented=!1,this.eventPhase=2,this.target=t,this.currentTarget=t}function n(){s.apply(this,arguments),this.lengthComputable=!1,this.loaded=0,this.total=0}return s.prototype.preventDefault=t,s.prototype.stopPropagation=t,s.prototype.stopImmediatePropagation=t,n.prototype=s.prototype,{event:function(t,e){return new s(t,e)},progressEvent:function(t,e){return new n(t,e)}}},e().AjaxEventBus=function(r){function e(t){this.eventList={},this.source=t}return e.prototype.addEventListener=function(t,e){var s,n;(s=this.eventList,n=t,s[n]=s[n]||[],s[n]).push(e)},e.prototype.removeEventListener=function(t,e){var s=function(t,e){if(t.indexOf)return t.indexOf(e);for(var s=0;s<t.length;s++)if(e===t[s])return s;return-1}(this.eventList[t],e);0<=s&&this.eventList[t].splice(s,1)},e.prototype.trigger=function(t){var e;e="readystatechange"===t?r.event(this.source,t):r.progressEvent(this.source,t);var s=this.eventList[t];if(s)for(var n=0;n<s.length;n++)s[n].call(this.source,e)},function(t){return new e(t)}},e().AjaxFakeRequest=function(a){function u(t,e,s){for(var n in s=s||[],e)h(s,n)||(t[n]=e[n]);return t}function h(t,e){for(var s=0;s<t.length;s++)if(t[s]===e)return!0;return!1}function c(t,e){return function(){t[e]&&t[e].apply(t,arguments)}}function p(t){var e=["Can't build XHR.response for XHR.responseType of '",t,"'.","XHR.response must be explicitly stubbed"];return e.join(" ")}return function(n,e,s,t){function r(){var t;e.track(this),this.eventBus=a(this),(t=this).eventBus.addEventListener("readystatechange",c(t,"onreadystatechange")),t.eventBus.addEventListener("loadstart",c(t,"onloadstart")),t.eventBus.addEventListener("load",c(t,"onload")),t.eventBus.addEventListener("loadend",c(t,"onloadend")),t.eventBus.addEventListener("progress",c(t,"onprogress")),t.eventBus.addEventListener("error",c(t,"onerror")),t.eventBus.addEventListener("abort",c(t,"onabort")),t.eventBus.addEventListener("timeout",c(t,"ontimeout")),this.requestHeaders={},this.overriddenMimeType=null}function i(t,e){if(n.DOMParser)return(new n.DOMParser).parseFromString(t,"text/xml");var s=new n.ActiveXObject("Microsoft.XMLDOM");return s.async="false",s.loadXML(t),s}var o=["text/xml","application/xml"];u(r,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4});return u(r.prototype,new n.XMLHttpRequest,["responseBody","responseText","responseXML","status","statusText","responseTimeout","responseURL"]),u(r.prototype,{open:function(){this.method=arguments[0],this.url=arguments[1]+"",this.username=arguments[3],this.password=arguments[4],this.readyState=r.OPENED,this.requestHeaders={},this.eventBus.trigger("readystatechange")},setRequestHeader:function(t,e){if(0===this.readyState)throw new Error('DOMException: Failed to execute "setRequestHeader" on "XMLHttpRequest": The object\'s state must be OPENED.');this.requestHeaders.hasOwnProperty(t)?this.requestHeaders[t]=[this.requestHeaders[t],e].join(", "):this.requestHeaders[t]=e},overrideMimeType:function(t){this.overriddenMimeType=t},abort:function(){this.readyState=r.UNSENT,this.status=0,this.statusText="abort",this.eventBus.trigger("readystatechange"),this.eventBus.trigger("progress"),this.eventBus.trigger("abort"),this.eventBus.trigger("loadend")},readyState:r.UNSENT,onloadstart:null,onprogress:null,onabort:null,onerror:null,onload:null,ontimeout:null,onloadend:null,onreadystatechange:null,addEventListener:function(){this.eventBus.addEventListener.apply(this.eventBus,arguments)},removeEventListener:function(t,e){this.eventBus.removeEventListener.apply(this.eventBus,arguments)},status:null,send:function(t){this.params=t,this.eventBus.trigger("loadstart");var e=s.findStub(this.url,t,this.method);this.dispatchStub(e)},dispatchStub:function(t){t&&(t.isReturn()?this.respondWith(t):t.isError()?this.responseError(t):t.isTimeout()?this.responseTimeout():t.isCallFunction()&&this.responseCallFunction(t))},contentType:function(){return function(t,e){for(var s in t=t.toLowerCase(),e)if(s.toLowerCase()===t)return e[s]}("content-type",this.requestHeaders)},data:function(){return this.params?t.findParser(this).parse(this.params):{}},getResponseHeader:function(t){var e=null;if(!this.responseHeaders)return e;t=t.toLowerCase();for(var s=0;s<this.responseHeaders.length;s++){var n=this.responseHeaders[s];t===n.name.toLowerCase()&&(e=e?[e,n.value].join(", "):n.value)}return e},getAllResponseHeaders:function(){if(!this.responseHeaders)return null;for(var t=[],e=0;e<this.responseHeaders.length;e++)t.push(this.responseHeaders[e].name+": "+this.responseHeaders[e].value);return t.join("\r\n")+"\r\n"},responseText:null,response:null,responseType:null,responseURL:null,responseValue:function(){switch(this.responseType){case null:case"":case"text":return this.readyState>=r.LOADING?this.responseText:"";case"json":return JSON.parse(this.responseText);case"arraybuffer":throw p("arraybuffer");case"blob":throw p("blob");case"document":return this.responseXML}},respondWith:function(t){if(this.readyState===r.DONE)throw new Error("FakeXMLHttpRequest already completed");var e,s;this.status=t.status,this.statusText=t.statusText||"",this.responseHeaders=function(t,e){var s=[];if(t)if(t instanceof Array)s=t;else for(var n in t)t.hasOwnProperty(n)&&s.push({name:n,value:t[n]});else s.push({name:"Content-Type",value:e||"application/json"});return s}(t.responseHeaders,t.contentType),this.readyState=r.HEADERS_RECEIVED,this.eventBus.trigger("readystatechange"),this.responseText=t.responseText||"",this.responseType=t.responseType||"",this.responseURL=t.responseURL||null,this.readyState=r.DONE,this.responseXML=(e=t.responseText,s=this.getResponseHeader("content-type")||"",h(o,s.toLowerCase())?i(e,s):s.match(/\+xml$/)?i(e,"text/xml"):null),this.responseXML&&(this.responseType="document"),t.responseJSON&&(this.responseText=JSON.stringify(t.responseJSON)),this.response="response"in t?t.response:this.responseValue(),this.eventBus.trigger("readystatechange"),this.eventBus.trigger("progress"),this.eventBus.trigger("load"),this.eventBus.trigger("loadend")},responseTimeout:function(){if(this.readyState===r.DONE)throw new Error("FakeXMLHttpRequest already completed");this.readyState=r.DONE,jasmine.clock().tick(3e4),this.eventBus.trigger("readystatechange"),this.eventBus.trigger("progress"),this.eventBus.trigger("timeout"),this.eventBus.trigger("loadend")},responseError:function(t){if(t||(t={}),this.readyState===r.DONE)throw new Error("FakeXMLHttpRequest already completed");this.status=t.status,this.statusText=t.statusText||"",this.readyState=r.DONE,this.eventBus.trigger("readystatechange"),this.eventBus.trigger("progress"),this.eventBus.trigger("error"),this.eventBus.trigger("loadend")},responseCallFunction:function(t){t.action=void 0,t.functionToCall(t,this),this.dispatchStub(t)}}),r}},e().MockAjax=function(o){return function(t){var e=new o.RequestTracker,r=new o.StubTracker,s=new o.ParamParser,n=t.XMLHttpRequest,i=o.fakeRequest(t,e,r,s);this.install=function(){if(t.XMLHttpRequest!==n)throw new Error("Jasmine Ajax was unable to install over a custom XMLHttpRequest. Is Jasmine Ajax already installed?");t.XMLHttpRequest=i},this.uninstall=function(){if(t.XMLHttpRequest!==i)throw new Error("MockAjax not installed.");t.XMLHttpRequest=n,this.stubs.reset(),this.requests.reset(),s.reset()},this.stubRequest=function(t,e,s){var n=new o.RequestStub(t,e,s);return r.addStub(n),n},this.withMock=function(t){this.install();try{t()}finally{this.uninstall()}},this.addCustomParamParser=function(t){s.add(t)},this.requests=e,this.stubs=r}},e().AjaxParamParser=function(){return function(){var e=[{test:function(t){return/^application\/json/.test(t.contentType())},parse:function(t){return JSON.parse(t)}},{test:function(t){return!0},parse:function(t){for(var e={},s=t.split("&"),n=0;n<s.length;++n){var r=s[n].replace(/\+/g," ").split("="),i=decodeURIComponent(r[0]);e[i]=e[i]||[],e[i].push(decodeURIComponent(r[1]))}return e}}],n=[];this.add=function(t){n.unshift(t)},this.findParser=function(t){for(var e in n){var s=n[e];if(s.test(t))return s}},this.reset=function(){for(var t in n=[],e)n.push(e[t])},this.reset()}},e().AjaxRequestStub=function(){var r=0,i=1,o=2,a=3;return function(t,e,s){var u=function(t){return t?t.split("&").sort().join("&"):void 0};if(t instanceof RegExp)this.url=t,this.query=void 0;else{var n=t.split("?");this.url=n[0],this.query=1<n.length?u(n[1]):void 0}this.data=e instanceof RegExp?e:u(e),this.method=s,this.andReturn=function(t){this.action=r,this.status=void 0!==t.status?t.status:200,this.statusText=t.statusText,this.contentType=t.contentType,this.response=t.response,this.responseText=t.responseText,this.responseHeaders=t.responseHeaders,this.responseURL=t.responseURL},this.isReturn=function(){return this.action===r},this.andError=function(t){t||(t={}),this.action=i,this.status=t.status||500},this.isError=function(){return this.action===i},this.andTimeout=function(){this.action=o},this.isTimeout=function(){return this.action===o},this.andCallFunction=function(t){this.action=a,this.functionToCall=t},this.isCallFunction=function(){return this.action===a},this.matches=function(t,e,s){var n=!1;if(t=t.toString(),this.url instanceof RegExp)n=this.url.test(t);else{var r=t.split("?"),i=r[0],o=r[1];n=this.url===i&&this.query===u(o)}var a=!1;return a=this.data instanceof RegExp?this.data.test(e):!this.data||this.data===u(e),n&&a&&(!this.method||this.method===s)}}},e().AjaxRequestTracker=function(){return function(){var n=[];this.track=function(t){n.push(t)},this.first=function(){return n[0]},this.count=function(){return n.length},this.reset=function(){n=[]},this.mostRecent=function(){return n[n.length-1]},this.at=function(t){return n[t]},this.filter=function(t){for(var e=[],s=0;s<n.length;s++)t instanceof RegExp&&t.test(n[s].url)?e.push(n[s]):t instanceof Function&&t(n[s])?e.push(n[s]):n[s].url===t&&e.push(n[s]);return e}}},e().AjaxStubTracker=function(){return function(){var i=[];this.addStub=function(t){i.push(t)},this.reset=function(){i=[]},this.findStub=function(t,e,s){for(var n=i.length-1;0<=n;n--){var r=i[n];if(r.matches(t,e,s))return r}}}};var s=e(),n=s.ajax(s);return jasmine.Ajax=new n(t),n}(t,getJasmineRequireObj)}("undefined"!=typeof window?window:global);