!function(u){var e;e="object"==typeof process&&process.env?process.env:window,u.parser=function(e){return new o(e)},u.CParser=o,u.CStream=r,u.createStream=function(e){return new r(e)},u.MAX_BUFFER_LENGTH=65536,u.DEBUG="debug"===e.CDEBUG,u.INFO="debug"===e.CDEBUG||"info"===e.CDEBUG,u.EVENTS=["value","string","key","openobject","closeobject","openarray","closearray","error","end","ready"];var i,f={textNode:void 0,numberNode:""},s=u.EVENTS.filter(function(e){return"error"!==e&&"end"!==e}),l=0;for(var t in u.STATE={BEGIN:l++,VALUE:l++,OPEN_OBJECT:l++,CLOSE_OBJECT:l++,OPEN_ARRAY:l++,CLOSE_ARRAY:l++,TEXT_ESCAPE:l++,STRING:l++,BACKSLASH:l++,END:l++,OPEN_KEY:l++,CLOSE_KEY:l++,TRUE:l++,TRUE2:l++,TRUE3:l++,FALSE:l++,FALSE2:l++,FALSE3:l++,FALSE4:l++,NULL:l++,NULL2:l++,NULL3:l++,NUMBER_DECIMAL_POINT:l++,NUMBER_DIGIT:l++},u.STATE)u.STATE[u.STATE[t]]=t;function n(e){for(var t in f)e[t]=f[t]}l=u.STATE,Object.create||(Object.create=function(e){function t(){this.__proto__=e}return t.prototype=e,new t}),Object.getPrototypeOf||(Object.getPrototypeOf=function(e){return e.__proto__}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t});var d=/[\\"\n]/g;function o(e){if(!(this instanceof o))return new o(e);var t=this;n(t),t.bufferCheckPosition=u.MAX_BUFFER_LENGTH,t.q=t.c=t.p="",t.opt=e||{},t.closed=t.closedRoot=t.sawRoot=!1,t.tag=t.error=null,t.state=l.BEGIN,t.stack=new Array,t.position=t.column=0,t.line=1,t.slashed=!1,t.unicodeI=0,t.unicodeS=null,t.depth=0,h(t,"onready")}o.prototype={end:function(){N(this)},write:function(e){var t=this;if(this.error)throw this.error;if(t.closed)return b(t,"Cannot write after close. Assign an onready handler.");if(null===e)return N(t);var n=0,i=e[0],s=t.p;u.DEBUG&&console.log("write -> ["+e+"]");for(;i&&(s=i,t.c=i=e.charAt(n++),s!==i?t.p=s:s=t.p,i);)switch(u.DEBUG&&console.log(n,i,u.STATE[t.state]),t.position++,"\n"===i?(t.line++,t.column=0):t.column++,t.state){case l.BEGIN:"{"===i?t.state=l.OPEN_OBJECT:"["===i?t.state=l.OPEN_ARRAY:"\r"!==i&&"\n"!==i&&" "!==i&&"\t"!==i&&b(t,"Non-whitespace before {[.");continue;case l.OPEN_KEY:case l.OPEN_OBJECT:if("\r"===i||"\n"===i||" "===i||"\t"===i)continue;if(t.state===l.OPEN_KEY)t.stack.push(l.CLOSE_KEY);else{if("}"===i){h(t,"onopenobject"),this.depth++,h(t,"oncloseobject"),this.depth--,t.state=t.stack.pop()||l.VALUE;continue}t.stack.push(l.CLOSE_OBJECT)}'"'===i?t.state=l.STRING:b(t,'Malformed object key should start with "');continue;case l.CLOSE_KEY:case l.CLOSE_OBJECT:if("\r"===i||"\n"===i||" "===i||"\t"===i)continue;t.state,l.CLOSE_KEY;":"===i?(t.state===l.CLOSE_OBJECT?(t.stack.push(l.CLOSE_OBJECT),p(t,"onopenobject"),this.depth++):p(t,"onkey"),t.state=l.VALUE):"}"===i?(E(t,"oncloseobject"),this.depth--,t.state=t.stack.pop()||l.VALUE):","===i?(t.state===l.CLOSE_OBJECT&&t.stack.push(l.CLOSE_OBJECT),p(t),t.state=l.OPEN_KEY):b(t,"Bad object");continue;case l.OPEN_ARRAY:case l.VALUE:if("\r"===i||"\n"===i||" "===i||"\t"===i)continue;if(t.state===l.OPEN_ARRAY){if(h(t,"onopenarray"),this.depth++,t.state=l.VALUE,"]"===i){h(t,"onclosearray"),this.depth--,t.state=t.stack.pop()||l.VALUE;continue}t.stack.push(l.CLOSE_ARRAY)}'"'===i?t.state=l.STRING:"{"===i?t.state=l.OPEN_OBJECT:"["===i?t.state=l.OPEN_ARRAY:"t"===i?t.state=l.TRUE:"f"===i?t.state=l.FALSE:"n"===i?t.state=l.NULL:"-"===i?t.numberNode+=i:"0"===i?(t.numberNode+=i,t.state=l.NUMBER_DIGIT):-1!=="123456789".indexOf(i)?(t.numberNode+=i,t.state=l.NUMBER_DIGIT):b(t,"Bad value");continue;case l.CLOSE_ARRAY:if(","===i)t.stack.push(l.CLOSE_ARRAY),p(t,"onvalue"),t.state=l.VALUE;else if("]"===i)E(t,"onclosearray"),this.depth--,t.state=t.stack.pop()||l.VALUE;else{if("\r"===i||"\n"===i||" "===i||"\t"===i)continue;b(t,"Bad array")}continue;case l.STRING:void 0===t.textNode&&(t.textNode="");var o=n-1,r=t.slashed,a=t.unicodeI;e:for(;;){for(u.DEBUG&&console.log(n,i,u.STATE[t.state],r);0<a;)if(t.unicodeS+=i,i=e.charAt(n++),t.position++,4===a?(t.textNode+=String.fromCharCode(parseInt(t.unicodeS,16)),a=0,o=n-1):a++,!i)break e;if('"'===i&&!r){t.state=t.stack.pop()||l.VALUE,t.textNode+=e.substring(o,n-1),t.position+=n-1-o;break}if("\\"===i&&!r&&(r=!0,t.textNode+=e.substring(o,n-1),t.position+=n-1-o,i=e.charAt(n++),t.position++,!i))break;if(r){if(r=!1,"n"===i?t.textNode+="\n":"r"===i?t.textNode+="\r":"t"===i?t.textNode+="\t":"f"===i?t.textNode+="\f":"b"===i?t.textNode+="\b":"u"===i?(a=1,t.unicodeS=""):t.textNode+=i,i=e.charAt(n++),t.position++,o=n-1,i)continue;break}d.lastIndex=n;var c=d.exec(e);if(null===c){n=e.length+1,t.textNode+=e.substring(o,n-1),t.position+=n-1-o;break}if(n=c.index+1,!(i=e.charAt(c.index))){t.textNode+=e.substring(o,n-1),t.position+=n-1-o;break}}t.slashed=r,t.unicodeI=a;continue;case l.TRUE:if(""===i)continue;"r"===i?t.state=l.TRUE2:b(t,"Invalid true started with t"+i);continue;case l.TRUE2:if(""===i)continue;"u"===i?t.state=l.TRUE3:b(t,"Invalid true started with tr"+i);continue;case l.TRUE3:if(""===i)continue;"e"===i?(h(t,"onvalue",!0),t.state=t.stack.pop()||l.VALUE):b(t,"Invalid true started with tru"+i);continue;case l.FALSE:if(""===i)continue;"a"===i?t.state=l.FALSE2:b(t,"Invalid false started with f"+i);continue;case l.FALSE2:if(""===i)continue;"l"===i?t.state=l.FALSE3:b(t,"Invalid false started with fa"+i);continue;case l.FALSE3:if(""===i)continue;"s"===i?t.state=l.FALSE4:b(t,"Invalid false started with fal"+i);continue;case l.FALSE4:if(""===i)continue;"e"===i?(h(t,"onvalue",!1),t.state=t.stack.pop()||l.VALUE):b(t,"Invalid false started with fals"+i);continue;case l.NULL:if(""===i)continue;"u"===i?t.state=l.NULL2:b(t,"Invalid null started with n"+i);continue;case l.NULL2:if(""===i)continue;"l"===i?t.state=l.NULL3:b(t,"Invalid null started with nu"+i);continue;case l.NULL3:if(""===i)continue;"l"===i?(h(t,"onvalue",null),t.state=t.stack.pop()||l.VALUE):b(t,"Invalid null started with nul"+i);continue;case l.NUMBER_DECIMAL_POINT:"."===i?(t.numberNode+=i,t.state=l.NUMBER_DIGIT):b(t,"Leading zero not followed by .");continue;case l.NUMBER_DIGIT:-1!=="0123456789".indexOf(i)?t.numberNode+=i:"."===i?(-1!==t.numberNode.indexOf(".")&&b(t,"Invalid number has two dots"),t.numberNode+=i):"e"===i||"E"===i?(-1===t.numberNode.indexOf("e")&&-1===t.numberNode.indexOf("E")||b(t,"Invalid number has two exponential"),t.numberNode+=i):"+"===i||"-"===i?("e"!==s&&"E"!==s&&b(t,"Invalid symbol in number"),t.numberNode+=i):(_(t),n--,t.state=t.stack.pop()||l.VALUE);continue;default:b(t,"Unknown state: "+t.state)}t.position>=t.bufferCheckPosition&&function(e){var t=Math.max(u.MAX_BUFFER_LENGTH,10),n=0;for(var i in f){var s=void 0===e[i]?0:e[i].length;if(t<s)switch(i){case"text":closeText(e);break;default:b(e,"Max buffer length exceeded: "+i)}n=Math.max(n,s)}e.bufferCheckPosition=u.MAX_BUFFER_LENGTH-n+e.position}(t);return t},resume:function(){return this.error=null,this},close:function(){return this.write(null)}};try{i=require("stream").Stream}catch(e){i=function(){}}function r(e){if(!(this instanceof r))return new r(e);this._parser=new o(e),this.writable=!0,this.readable=!0,this.bytes_remaining=0,this.bytes_in_sequence=0,this.temp_buffs={2:new Buffer(2),3:new Buffer(3),4:new Buffer(4)},this.string="";var n=this;i.apply(n),this._parser.onend=function(){n.emit("end")},this._parser.onerror=function(e){n.emit("error",e),n._parser.error=null},s.forEach(function(t){Object.defineProperty(n,"on"+t,{get:function(){return n._parser["on"+t]},set:function(e){if(!e)return n.removeAllListeners(t),n._parser["on"+t]=e;n.on(t,e)},enumerable:!0,configurable:!1})})}function h(e,t,n){u.INFO&&console.log("-- emit",t,n),e[t]&&e[t](n)}function E(e,t,n){p(e),h(e,t,n)}function p(e,t){e.textNode=function(e,t){if(void 0===t)return t;e.trim&&(t=t.trim());e.normalize&&(t=t.replace(/\s+/g," "));return t}(e.opt,e.textNode),void 0!==e.textNode&&h(e,t||"onvalue",e.textNode),e.textNode=void 0}function _(e){e.numberNode&&h(e,"onvalue",parseFloat(e.numberNode)),e.numberNode=""}function b(e,t){return p(e),t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c,t=new Error(t),e.error=t,h(e,"onerror",t),e}function N(e){return e.state===l.VALUE&&0===e.depth||b(e,"Unexpected end"),p(e),e.c="",e.closed=!0,h(e,"onend"),o.call(e,e.opt),e}(r.prototype=Object.create(i.prototype,{constructor:{value:r}})).write=function(e){e=new Buffer(e);for(var t=0;t<e.length;t++){var n=e[t];if(0<this.bytes_remaining){for(var i=0;i<this.bytes_remaining;i++)this.temp_buffs[this.bytes_in_sequence][this.bytes_in_sequence-this.bytes_remaining+i]=e[i];this.string=this.temp_buffs[this.bytes_in_sequence].toString(),this.bytes_in_sequence=this.bytes_remaining=0,t=t+i-1,this._parser.write(this.string),this.emit("data",this.string)}else if(0===this.bytes_remaining&&128<=n){if(194<=n&&n<=223&&(this.bytes_in_sequence=2),224<=n&&n<=239&&(this.bytes_in_sequence=3),240<=n&&n<=244&&(this.bytes_in_sequence=4),this.bytes_in_sequence+t>e.length){for(var s=0;s<=e.length-1-t;s++)this.temp_buffs[this.bytes_in_sequence][s]=e[t+s];return this.bytes_remaining=t+this.bytes_in_sequence-e.length,!0}this.string=e.slice(t,t+this.bytes_in_sequence).toString(),t=t+this.bytes_in_sequence-1,this._parser.write(this.string),this.emit("data",this.string)}else{for(var o=t;o<e.length&&!(128<=e[o]);o++);this.string=e.slice(t,o).toString(),this._parser.write(this.string),this.emit("data",this.string),t=o-1}}},r.prototype.end=function(e){return e&&e.length&&this._parser.write(e.toString()),this._parser.end(),!0},r.prototype.on=function(t,e){var n=this;return n._parser["on"+t]||-1===s.indexOf(t)||(n._parser["on"+t]=function(){var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);e.splice(0,0,t),n.emit.apply(n,e)}),i.prototype.on.call(n,t,e)},r.prototype.destroy=function(){n(this._parser),this.emit("close")}}("undefined"==typeof exports?clarinet={}:exports);