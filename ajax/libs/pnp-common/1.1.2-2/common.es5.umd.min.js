/**
@license
 * @pnp/common v1.1.2-2 - pnp - provides shared functionality across all pnp libraries
 * MIT (https://github.com/pnp/pnpjs/blob/master/LICENSE)
 * Copyright (c) 2018 Microsoft
 * docs: https://pnp.github.io/pnpjs/
 * source: https:github.com/pnp/pnpjs
 * bugs: https://github.com/pnp/pnpjs/issues
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@pnp/logging"),require("tslib"),require("adal-angular")):"function"==typeof define&&define.amd?define(["exports","@pnp/logging","tslib","adal-angular"],t):t((e.pnp=e.pnp||{},e.pnp.common={}),e.pnp.logging,null,null)}(this,function(e,s,t,n){"use strict";function r(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return function(){t.apply(e,n)}}function o(e,t,n){var r=new Date(e);switch(t.toLowerCase()){case"year":r.setFullYear(r.getFullYear()+n);break;case"quarter":r.setMonth(r.getMonth()+3*n);break;case"month":r.setMonth(r.getMonth()+n);break;case"week":r.setDate(r.getDate()+7*n);break;case"day":r.setDate(r.getDate()+n);break;case"hour":r.setTime(r.getTime()+36e5*n);break;case"minute":r.setTime(r.getTime()+6e4*n);break;case"second":r.setTime(r.getTime()+1e3*n);break;default:r=void 0}return r}function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.filter(function(e){return!d(e)}).map(function(e){return e.replace(/^[\\|\/]/,"").replace(/[\\|\/]$/,"")}).join("/").replace(/\\/g,"/")}function a(e){for(var t=new Array(e),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t[r]=n.charAt(Math.floor(Math.random()*n.length));return t.join("")}function u(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:3&t|8).toString(16)})}function l(e){return"function"==typeof e}function c(e){return null!=e}function f(e){return Array.isArray?Array.isArray(e):e&&"number"==typeof e.length&&e.constructor===Array}function h(t,n,e,r){if(void 0===e&&(e=!1),!c(n))return t;var o=e?function(e,t){return!(t in e)}:function(){return!0},i=l(r)?r:function(){return!0};return Object.getOwnPropertyNames(n).filter(function(e){return o(t,e)&&i(e)}).reduce(function(e,t){return e[t]=n[t],e},t)}function p(e){return/^https?:\/\/|^\/\//i.test(e)}function d(e){return null==e||e.length<1}function g(e,t){e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");var n=new RegExp(t+"\\s*?=\\s*?(\"|')([^\\1]*?)\\1","i").exec(e);return null!==n&&0<n.length?n[2]:null}function y(e){if(d(e))return e;var t=/([0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12})/i.exec(e);return null===t?e:t[1]}var v=function(){function e(){}return e.getCtxCallback=r,e.dateAdd=o,e.combinePaths=i,e.getRandomString=a,e.getGUID=u,e.isFunc=l,e.objectDefinedNotNull=c,e.isArray=f,e.extend=h,e.isUrlAbsolute=p,e.stringIsNullOrEmpty=d,e.getAttrValueFromString=g,e.sanitizeGuid=y,e}();function b(n,e){null!=e&&new Request("",{headers:e}).headers.forEach(function(e,t){n.append(t,e)})}var x=function(){function e(){}return e.prototype.fetch=function(e,t){return global.fetch(e,t)},e}(),m=function(r){function e(e){var t=r.call(this)||this;return t._token=e,t}return t.__extends(e,r),Object.defineProperty(e.prototype,"token",{get:function(){return this._token},set:function(e){this._token=e},enumerable:!0,configurable:!0}),e.prototype.fetch=function(e,t){void 0===t&&(t={});var n=new Headers;return b(n,t.headers),n.set("Authorization","Bearer "+this._token),t.headers=n,r.prototype.fetch.call(this,e,t)},e}(x),w=function(o){function a(e,t,n){var r=o.call(this,null)||this;return r.clientId=e,r.tenant=t,r.redirectUri=n,r}return t.__extends(a,o),a.fromSPFxContext=function(e,t){return void 0===t&&(t="c58637bb-e2e1-4312-8a00-04b5ffcd3403"),new a(t,e.pageContext.aadInfo.tenantId.toString(),i(window.location.origin,"/_forms/spfxsinglesignon.aspx"))},a.prototype.fetch=function(t,n){var r=this;if(!p(t))throw new Error("You must supply absolute urls to AdalClient.fetch.");return this.getToken(this.getResource(t)).then(function(e){return r.token=e,o.prototype.fetch.call(r,t,n)})},a.prototype.getToken=function(t){var o=this;return new Promise(function(n,r){o.ensureAuthContext().then(function(e){return o.login()}).then(function(e){a._authContext.acquireToken(t,function(e,t){if(e)return r(new Error(e));n(t)})}).catch(r)})},a.prototype.ensureAuthContext=function(){var t=this;return new Promise(function(e){null===a._authContext&&(a._authContext=n.inject({clientId:t.clientId,displayCall:function(e){t._displayCallback&&t._displayCallback(e)},navigateToLoginRequestUrl:!1,redirectUri:t.redirectUri,tenant:t.tenant})),e()})},a.prototype.login=function(){var i=this;return this._loginPromise||(this._loginPromise=new Promise(function(r,o){if(a._authContext.getCachedUser())return r();i._displayCallback=function(e){var t=window.open(e,"login","width=483, height=600");if(!t)return o(new Error("Could not open pop-up window for auth. Likely pop-ups are blocked by the browser."));t&&t.focus&&t.focus();var n=window.setInterval(function(){t&&!t.closed&&void 0!==t.closed||window.clearInterval(n);try{-1!==t.document.URL.indexOf(i.redirectUri)&&(window.clearInterval(n),a._authContext.handleWindowCallback(t.location.hash),t.close(),r())}catch(e){o(e)}},30)},i.ensureAuthContext().then(function(e){a._authContext._loginInProgress=!1,a._authContext.login(),i._displayCallback=null})})),this._loginPromise},a.prototype.getResource=function(e){var t=document.createElement("a");return t.href=e,t.protocol+"//"+t.hostname},a._authContext=null,a}(m);function C(r,o){return new Promise(function(t,n){try{var e=new FileReader;switch(e.onload=function(e){t(e.target.result)},o){case"string":e.readAsText(r);break;case"buffer":e.readAsArrayBuffer(r)}}catch(e){n(e)}})}var _=function(){function e(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]),this.keys=e,this.values=t}return e.prototype.get=function(e){var t=this.keys.indexOf(e);return t<0?null:this.values[t]},e.prototype.add=function(e,t){var n=this.keys.indexOf(e);-1<n?null===t?this.remove(e):this.values[n]=t:null!==t&&(this.keys.push(e),this.values.push(t))},e.prototype.merge=function(e){var t=this;if("getKeys"in e){var n=e;n.getKeys().map(function(e){t.add(e,n.get(e))})}else{var r=e;for(var o in r)r.hasOwnProperty(o)&&this.add(o,r[o])}},e.prototype.remove=function(e){var t=this.keys.indexOf(e);if(t<0)return null;var n=this.values[t];return this.keys.splice(t,1),this.values.splice(t,1),n},e.prototype.getKeys=function(){return this.keys},e.prototype.getValues=function(){return this.values},e.prototype.clear=function(){this.keys=[],this.values=[]},Object.defineProperty(e.prototype,"count",{get:function(){return this.keys.length},enumerable:!0,configurable:!0}),e}(),k=function(n){function e(e){var t=n.call(this,e)||this;return t.name="UrlException",s.Logger.log({data:{},level:3,message:"["+t.name+"]::"+t.message}),t}return t.__extends(e,n),e}(Error);var P=function(){function e(){this._v=new _,this._v.add("defaultCachingStore","session"),this._v.add("defaultCachingTimeoutSeconds",60),this._v.add("globalCacheDisable",!1),this._v.add("enableCacheExpiration",!1),this._v.add("cacheExpirationIntervalMilliseconds",750),this._v.add("spfxContext",null)}return e.prototype.extend=function(t){var n=this;Object.keys(t).forEach(function(e){n._v.add(e,t[e])})},e.prototype.get=function(e){return this._v.get(e)},Object.defineProperty(e.prototype,"defaultCachingStore",{get:function(){return this.get("defaultCachingStore")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultCachingTimeoutSeconds",{get:function(){return this.get("defaultCachingTimeoutSeconds")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalCacheDisable",{get:function(){return this.get("globalCacheDisable")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableCacheExpiration",{get:function(){return this.get("enableCacheExpiration")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cacheExpirationIntervalMilliseconds",{get:function(){return this.get("cacheExpirationIntervalMilliseconds")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spfxContext",{get:function(){return this.get("spfxContext")},enumerable:!0,configurable:!0}),e}(),A=new P,E=function(){function e(e,t){void 0===t&&(t=-1),this.store=e,this.defaultTimeoutMinutes=t,this.enabled=this.test(),A.enableCacheExpiration&&(s.Logger.write("Enabling cache expiration.",1),this.cacheExpirationHandler())}return e.prototype.get=function(e){if(!this.enabled)return null;var t=this.store.getItem(e);if(null==t)return null;var n=JSON.parse(t);return new Date(n.expiration)<=new Date?(s.Logger.write("Removing item with key '"+e+"' from cache due to expiration.",1),this.delete(e),null):n.value},e.prototype.put=function(e,t,n){this.enabled&&this.store.setItem(e,this.createPersistable(t,n))},e.prototype.delete=function(e){this.enabled&&this.store.removeItem(e)},e.prototype.getOrPut=function(n,r,o){var i=this;return this.enabled?new Promise(function(t){var e=i.get(n);null==e?r().then(function(e){i.put(n,e,o),t(e)}):t(e)}):r()},e.prototype.deleteExpired=function(){var o=this;return new Promise(function(e,t){o.enabled||e();try{for(var n=0;n<o.store.length;n++){var r=o.store.key(n);null!==r&&/["|']?pnp["|']? ?: ?1/i.test(o.store.getItem(r))&&o.get(r)}e()}catch(e){t(e)}})},e.prototype.test=function(){var e="test";try{return this.store.setItem(e,e),this.store.removeItem(e),!0}catch(e){return!1}},e.prototype.createPersistable=function(e,t){if(void 0===t){var n=A.defaultCachingTimeoutSeconds;0<this.defaultTimeoutMinutes&&(n=60*this.defaultTimeoutMinutes),t=o(new Date,"second",n)}return JSON.stringify({pnp:1,expiration:t,value:e})},e.prototype.cacheExpirationHandler=function(){var t=this;s.Logger.write("Called cache expiration handler.",0),this.deleteExpired().then(function(e){setTimeout(r(t,t.cacheExpirationHandler),A.cacheExpirationIntervalMilliseconds)}).catch(function(e){s.Logger.log({data:e,level:3,message:"Error deleting expired cache entries, see data for details. Timeout not reset."})})},e}(),I=function(){function e(e){void 0===e&&(e=new _),this._store=e}return Object.defineProperty(e.prototype,"length",{get:function(){return this._store.count},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._store.clear()},e.prototype.getItem=function(e){return this._store.get(e)},e.prototype.key=function(e){return this._store.getKeys()[e]},e.prototype.removeItem=function(e){this._store.remove(e)},e.prototype.setItem=function(e,t){this._store.add(e,t)},e}(),O=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this._local=e,this._session=t}return Object.defineProperty(e.prototype,"local",{get:function(){return null===this._local&&(this._local="undefined"!=typeof localStorage?new E(localStorage):new E(new I)),this._local},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"session",{get:function(){return null===this._session&&(this._session="undefined"!=typeof sessionStorage?new E(sessionStorage):new E(new I)),this._session},enumerable:!0,configurable:!0}),e}();e.AdalClient=w,e.readBlobAsText=function(e){return C(e,"string")},e.readBlobAsArrayBuffer=function(e){return C(e,"buffer")},e.Dictionary=_,e.deprecatedClass=function(t,n){return function(e){s.Logger.log({data:{target:e},level:2,message:"("+t+") "+n})}},e.deprecated=function(a,u){return function(n,r,o){var i=o.value;o.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s.Logger.log({data:{descriptor:o,propertyKey:r,target:n},level:2,message:"("+a+") "+u}),i.apply(this,e)}}},e.beta=function(a){return void 0===a&&(a="This feature is flagged as beta and is subject to change."),function(n,r,o){var i=o.value;o.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s.Logger.log({data:{descriptor:o,propertyKey:r,target:n},level:2,message:a}),i.apply(this,e)}}},e.UrlException=k,e.setup=function(e){A.extend(e)},e.RuntimeConfigImpl=P,e.RuntimeConfig=A,e.mergeHeaders=b,e.mergeOptions=function(e,t){if(c(t)){var n=h(e.headers||{},t.headers);(e=h(e,t)).headers=n}},e.FetchClient=x,e.BearerTokenFetchClient=m,e.PnPClientStorageWrapper=E,e.PnPClientStorage=O,e.getCtxCallback=r,e.dateAdd=o,e.combinePaths=i,e.getRandomString=a,e.getGUID=u,e.isFunc=l,e.objectDefinedNotNull=c,e.isArray=f,e.extend=h,e.isUrlAbsolute=p,e.stringIsNullOrEmpty=d,e.getAttrValueFromString=g,e.sanitizeGuid=y,e.Util=v,Object.defineProperty(e,"__esModule",{value:!0})});