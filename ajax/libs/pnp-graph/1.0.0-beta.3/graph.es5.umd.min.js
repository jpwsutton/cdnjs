!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("tslib"),require("@pnp/common"),require("@pnp/odata"),require("@pnp/logging")):"function"==typeof define&&define.amd?define(["exports","tslib","@pnp/common","@pnp/odata","@pnp/logging"],t):t((e.pnp=e.pnp||{},e.pnp.graph={}),e.tslib_1,e.common,e.odata,e.logging)}(this,function(e,t,n,r,o){"use strict";function i(e){n.RuntimeConfig.extend(e)}var u,s=function(e){function n(t){void 0===t&&(t="There is no Graph Client available, either set one using configuraiton or provide a valid SPFx Context using setup.");var n=e.call(this,t)||this;return n.name="NoGraphClientAvailableException",o.Logger.log({data:null,level:o.LogLevel.Error,message:n.message}),n}return t.__extends(n,e),n}(Error),p=function(e){function n(t){var n=e.call(this,t)||this;return n.name="GraphBatchParseException",o.Logger.log({data:{},level:o.LogLevel.Error,message:"["+n.name+"]::"+n.message}),n}return t.__extends(n,e),n}(Error),a=new(function(){function e(){}return Object.defineProperty(e.prototype,"headers",{get:function(){var e=n.RuntimeConfig.get("graph");return void 0!==e&&void 0!==e.headers?e.headers:{}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fetchClientFactory",{get:function(){var e=n.RuntimeConfig.get("graph");if(void 0!==e&&void 0!==e.fetchClientFactory)return e.fetchClientFactory;if(void 0!==n.RuntimeConfig.spfxContext)return function(){return n.RuntimeConfig.spfxContext.graphHttpClient};throw new s},enumerable:!0,configurable:!0}),e}()),c=function(){function e(){this._impl=a.fetchClientFactory()}return e.prototype.fetch=function(e,t){void 0===t&&(t={});var r=new Headers;n.mergeHeaders(r,a.headers),n.mergeHeaders(r,t.headers);var o=n.Util.extend(t,{headers:r});return this.fetchRaw(e,o)},e.prototype.fetchRaw=function(e,t){var r=this;void 0===t&&(t={});var o=new Headers;n.mergeHeaders(o,t.headers),t=n.Util.extend(t,{headers:o});var i=function(o){r._impl.fetch(e,{},t).then(function(e){return o.resolve(e)}).catch(function(e){429!==e.status&&503!==e.status&&o.reject(e);var t=o.delay;o.delay*=2,o.attempts++,o.retryCount<=o.attempts&&o.reject(e),setTimeout(n.Util.getCtxCallback(r,i,o),t)})};return new Promise(function(e,t){var n={attempts:0,delay:100,reject:t,resolve:e,retryCount:7};i.call(r,n)})},e.prototype.get=function(e,t){void 0===t&&(t={});var r=n.Util.extend(t,{method:"GET"});return this.fetch(e,r)},e.prototype.post=function(e,t){void 0===t&&(t={});var r=n.Util.extend(t,{method:"POST"});return this.fetch(e,r)},e.prototype.patch=function(e,t){void 0===t&&(t={});var r=n.Util.extend(t,{method:"PATCH"});return this.fetch(e,r)},e.prototype.delete=function(e,t){void 0===t&&(t={});var r=n.Util.extend(t,{method:"DELETE"});return this.fetch(e,r)},e}(),l=function(e){function o(t,r){var o=e.call(this)||this;if("string"==typeof t){var i=t;o._parentUrl=i,o._url=n.Util.combinePaths(i,r)}else{var u=t;o._parentUrl=u._url,o._options=u._options,o._url=n.Util.combinePaths(o._parentUrl,r)}return o}return t.__extends(o,e),o.prototype.as=function(e){var t=new e(this._url,null);return n.Util.extend(t,this,!0)},o.prototype.toUrlAndQuery=function(){var e=this;return this.toUrl()+"?"+this._query.getKeys().map(function(t){return t+"="+e._query.get(t)}).join("&")},o.prototype.getParent=function(e,t,n){return void 0===t&&(t=this.parentUrl),new e(t,n)},o.prototype.clone=function(e,t,n){return void 0===n&&(n=!0),new e(this,t)},o.prototype.toRequestContext=function(e,t,o,i){return void 0===t&&(t={}),void 0===i&&(i=r.PipelineMethods.default),Promise.resolve({batch:this.batch,batchDependency:function(){},cachingOptions:this._cachingOptions,clientFactory:function(){return new c},isBatched:this.hasBatch,isCached:this._useCaching,options:t,parser:o,pipeline:i,requestAbsoluteUrl:this.toUrlAndQuery(),requestId:n.Util.getGUID(),verb:e})},o}(r.ODataQueryable),d=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(n,e),n.prototype.filter=function(e){return this._query.add("$filter",e),this},n.prototype.select=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.length>0&&this._query.add("$select",e.join(",")),this},n.prototype.expand=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.length>0&&this._query.add("$expand",e.join(",")),this},n.prototype.orderBy=function(e,t){void 0===t&&(t=!0);for(var n=this._query.getKeys(),r=[],o=t?" asc":" desc",i=0;i<n.length;i++)if("$orderby"===n[i]){r.push(this._query.get("$orderby"));break}return r.push(""+e+o),this._query.add("$orderby",r.join(",")),this},n.prototype.top=function(e){return this._query.add("$top",e.toString()),this},n.prototype.skip=function(e){return this._query.add("$top",e.toString()),this},n.prototype.skipToken=function(e){return this._query.add("$skiptoken",e),this},Object.defineProperty(n.prototype,"count",{get:function(){return this._query.add("$count","true"),this},enumerable:!0,configurable:!0}),n}(l),h=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(n,e),n.prototype.search=function(e){return this._query.add("$search",e),this},n}(d),f=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(n,e),n.prototype.select=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.length>0&&this._query.add("$select",e.join(",")),this},n.prototype.expand=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.length>0&&this._query.add("$expand",e.join(",")),this},n}(l),y=function(e){function n(t,n){return void 0===n&&(n="members"),e.call(this,t,n)||this}return t.__extends(n,e),n.prototype.add=function(e){return this.clone(n,"$ref").postCore({body:JSON.stringify({"@odata.id":e})})},n.prototype.getById=function(e){return new g(this,e)},n}(d),g=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(n,e),n}(f),b=function(e){function n(t,n){return void 0===n&&(n="owners"),e.call(this,t,n)||this}return t.__extends(n,e),n}(y),v=(function(e){function n(t,n){return void 0===n&&(n="calendars"),e.call(this,t,n)||this}t.__extends(n,e)}(d),function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(n,e),Object.defineProperty(n.prototype,"events",{get:function(){return new m(this)},enumerable:!0,configurable:!0}),n}(f)),m=function(e){function n(t,n){return void 0===n&&(n="events"),e.call(this,t,n)||this}return t.__extends(n,e),n.prototype.getById=function(e){return new _(this,e)},n.prototype.add=function(e){var t=this;return this.postCore({body:JSON.stringify(e)}).then(function(e){return{data:e,event:t.getById(e.id)}})},n}(d),_=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(n,e),n.prototype.update=function(e){return this.patchCore({body:JSON.stringify(e)})},n.prototype.delete=function(){return this.deleteCore()},n}(f),x=function(e){function n(t,n){return void 0===n&&(n="attachments"),e.call(this,t,n)||this}return t.__extends(n,e),n.prototype.getById=function(e){return new w(this,e)},n.prototype.addFile=function(e,t){return this.postCore({body:JSON.stringify({"@odata.type":"#microsoft.graph.fileAttachment",contentBytes:t,name:e})})},n}(d),w=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(n,e),n}(f),C=function(e){function n(t,n){return void 0===n&&(n="conversations"),e.call(this,t,n)||this}return t.__extends(n,e),n.prototype.add=function(e){return this.postCore({body:JSON.stringify(e)})},n.prototype.getById=function(e){return new j(this,e)},n}(d),O=function(e){function n(t,n){return void 0===n&&(n="threads"),e.call(this,t,n)||this}return t.__extends(n,e),n.prototype.getById=function(e){return new P(this,e)},n.prototype.add=function(e){return this.postCore({body:JSON.stringify(e)})},n}(d),q=function(e){function n(t,n){return void 0===n&&(n="posts"),e.call(this,t,n)||this}return t.__extends(n,e),n.prototype.getById=function(e){return new U(this,e)},n.prototype.add=function(e){return this.postCore({body:JSON.stringify(e)})},n}(d),j=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(n,e),Object.defineProperty(n.prototype,"threads",{get:function(){return new O(this)},enumerable:!0,configurable:!0}),n.prototype.update=function(e){return this.patchCore({body:JSON.stringify(e)})},n.prototype.delete=function(){return this.deleteCore()},n}(f),P=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(n,e),Object.defineProperty(n.prototype,"posts",{get:function(){return new q(this)},enumerable:!0,configurable:!0}),n.prototype.reply=function(e){return this.clone(n,"reply").postCore({body:JSON.stringify({post:e})})},n.prototype.delete=function(){return this.deleteCore()},n}(f),U=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(n,e),Object.defineProperty(n.prototype,"attachments",{get:function(){return new x(this)},enumerable:!0,configurable:!0}),n.prototype.delete=function(){return this.deleteCore()},n.prototype.forward=function(e){return this.clone(n,"forward").postCore({body:JSON.stringify(e)})},n.prototype.reply=function(e){return this.clone(n,"reply").postCore({body:JSON.stringify({post:e})})},n}(f),S=function(e){function n(t,n){return e.call(this,t,n)||this}return t.__extends(n,e),n.prototype.add=function(e){return this.clone(n,"$ref").postCore({body:JSON.stringify({"@odata.id":e})})},n.prototype.remove=function(e){var t=this.clone(n,"$ref");return t.query.add("$id",e),t.deleteCore()},n}(d),I=function(e){function n(t,n){return void 0===n&&(n="planner/plans"),e.call(this,t,n)||this}return t.__extends(n,e),n.prototype.getById=function(e){return new B(this,e)},n}(d),B=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(n,e),n}(f),L=function(e){function n(t,n){return void 0===n&&(n="photo"),e.call(this,t,n)||this}return t.__extends(n,e),n.prototype.getBlob=function(){return this.clone(n,"$value",!1).get(new r.BlobFileParser)},n.prototype.getBuffer=function(){return this.clone(n,"$value",!1).get(new r.BufferFileParser)},n.prototype.setContent=function(e){return this.clone(n,"$value",!1).patchCore({body:e})},n}(f);!function(e){e[e.Office365=0]="Office365",e[e.Dynamic=1]="Dynamic",e[e.Security=2]="Security"}(u||(u={}));var N=function(e){function r(t,n){return void 0===n&&(n="groups"),e.call(this,t,n)||this}return t.__extends(r,e),r.prototype.getById=function(e){return new $(this,e)},r.prototype.add=function(e,t,r,o){var i=this;void 0===o&&(o={});var s=n.Util.extend({displayName:e,mailEnabled:r===u.Office365,mailNickname:t,securityEnabled:r!==u.Office365},o);return r!==u.Security&&(s=n.Util.extend(s,{groupTypes:[r===u.Office365?"Unified":"DynamicMembership"]})),this.postCore({body:JSON.stringify(s)}).then(function(e){return{data:e,group:i.getById(e.id)}})},r}(d),$=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(n,e),Object.defineProperty(n.prototype,"caldendar",{get:function(){return new v(this,"calendar")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"events",{get:function(){return new m(this)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"owners",{get:function(){return new b(this)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"plans",{get:function(){return new I(this)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"members",{get:function(){return new y(this)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"conversations",{get:function(){return new C(this)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"acceptedSenders",{get:function(){return new S(this,"acceptedsenders")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rejectedSenders",{get:function(){return new S(this,"rejectedsenders")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"photo",{get:function(){return new L(this)},enumerable:!0,configurable:!0}),n.prototype.addFavorite=function(){return this.clone(n,"addFavorite").postCore()},n.prototype.getMemberGroups=function(e){return void 0===e&&(e=!1),this.clone(n,"getMemberGroups").postCore({body:JSON.stringify({securityEnabledOnly:e})})},n.prototype.delete=function(){return this.deleteCore()},n.prototype.update=function(e){return this.patchCore({body:JSON.stringify(e)})},n.prototype.removeFavorite=function(){return this.clone(n,"removeFavorite").postCore()},n.prototype.resetUnseenCount=function(){return this.clone(n,"resetUnseenCount").postCore()},n.prototype.subscribeByMail=function(){return this.clone(n,"subscribeByMail").postCore()},n.prototype.unsubscribeByMail=function(){return this.clone(n,"unsubscribeByMail").postCore()},n.prototype.getCalendarView=function(e,t){var r=this.clone(n,"calendarView");return r.query.add("startDateTime",e.toISOString()),r.query.add("endDateTime",t.toISOString()),r.get()},n}(f),R=function(e){function n(t,n){return void 0===n&&(n="v1.0"),e.call(this,t,n)||this}return t.__extends(n,e),Object.defineProperty(n.prototype,"groups",{get:function(){return new N(this)},enumerable:!0,configurable:!0}),n}(l),J=function(){function e(){}return Object.defineProperty(e.prototype,"v1",{get:function(){return new R("")},enumerable:!0,configurable:!0}),e.prototype.setup=function(e){i(e)},e}(),T=new J,D=function(e){function r(t){void 0===t&&(t="https://graph.microsoft.com/beta/$batch");var n=e.call(this)||this;return n.batchUrl=t,n}return t.__extends(r,e),r.prototype.executeImpl=function(){var e=this;o.Logger.write("["+this.batchId+"] ("+(new Date).getTime()+") Executing batch with "+this.requests.length+" requests.",o.LogLevel.Info);var t=new c,r={requests:this.formatRequests()},i={body:JSON.stringify(r),headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"};return o.Logger.write("["+this.batchId+"] ("+(new Date).getTime()+") Sending batch request.",o.LogLevel.Info),t.fetch(this.batchUrl,i).then(function(e){return e.json()}).then(this._parseResponse).then(function(t){return o.Logger.write("["+e.batchId+"] ("+(new Date).getTime()+") Resolving batched requests.",o.LogLevel.Info),t.responses.reduce(function(r,i,u){var s=e.requests[u];if(n.Util.objectDefinedNotNull(s))return o.Logger.write("["+e.batchId+"] ("+(new Date).getTime()+") Resolving batched request "+s.method+" "+s.url+".",o.LogLevel.Verbose),r.then(function(e){return s.parser.parse(i).then(s.resolve).catch(s.reject)});if(!n.Util.stringIsNullOrEmpty(t.nextLink))throw new p("Could not properly parse responses to match requests in batch.");return r},Promise.resolve())})},r.prototype.formatRequests=function(){return this.requests.map(function(e,t){var r={id:""+ ++t,method:e.method,url:e.url},o={};return void 0!==a.headers&&null!==a.headers&&(o=n.Util.extend(o,a.headers)),void 0!==e.options&&(void 0!==e.options.headers&&null!==e.options.headers&&(o=n.Util.extend(o,e.options.headers)),void 0!==e.options.body&&null!==e.options.body&&(r=n.Util.extend(r,{body:e.options.body}))),r=n.Util.extend(r,{headers:o})})},r.prototype._parseResponse=function(e){var t=this;return new Promise(function(n){for(var r=new Array(t.requests.length).fill(null),o=0;o<e.responses.length;++o){var i=e.responses[o],u=parseInt(i.id,10)-1;204===i.status?r[u]=new Response:r[u]=new Response(null,{headers:i.headers,status:i.status})}n({nextLink:e.nextLink,responses:r})})},t.__decorate([n.beta("Graph batching functionality is in beta.")],r.prototype,"executeImpl",null),r}(r.ODataBatch);e.graph=T,e.GraphRest=J,e.GraphBatch=D,e.GraphQueryable=l,e.GraphQueryableCollection=d,e.GraphQueryableInstance=f,e.GraphQueryableSearchableCollection=h,Object.defineProperty(e,"__esModule",{value:!0})});