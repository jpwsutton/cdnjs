!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@pnp/common"),require("@pnp/odata"),require("@pnp/logging")):"function"==typeof define&&define.amd?define(["exports","@pnp/common","@pnp/odata","@pnp/logging"],e):e(t.pnp={},t.common,t.odata,t.logging)}(this,function(t,e,n,r){"use strict";function o(t){e.RuntimeConfig.extend(t)}var i,u=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),c=function(t){function e(e){void 0===e&&(e="There is no Graph Client available, either set one using configuraiton or provide a valid SPFx Context using setup.");var n=t.call(this,e)||this;return n.name="NoGraphClientAvailableException",r.Logger.log({data:null,level:r.LogLevel.Error,message:n.message}),n}return u(e,t),e}(Error),s=function(t){function e(e){var n=t.call(this,e)||this;return n.name="GraphBatchParseException",r.Logger.log({data:{},level:r.LogLevel.Error,message:"["+n.name+"]::"+n.message}),n}return u(e,t),e}(Error),p=new(function(){function t(){}return Object.defineProperty(t.prototype,"headers",{get:function(){var t=e.RuntimeConfig.get("graph");return void 0!==t&&void 0!==t.headers?t.headers:{}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fetchClientFactory",{get:function(){var t=e.RuntimeConfig.get("graph");if(void 0!==t&&void 0!==t.fetchClientFactory)return t.fetchClientFactory;if(void 0!==e.RuntimeConfig.spfxContext)return function(){return e.RuntimeConfig.spfxContext.graphHttpClient};throw new c},enumerable:!0,configurable:!0}),t}()),a=function(){function t(){this._impl=p.fetchClientFactory()}return t.prototype.fetch=function(t,n){void 0===n&&(n={});var r=new Headers;e.mergeHeaders(r,p.headers),e.mergeHeaders(r,n.headers);var o=e.Util.extend(n,{headers:r});return this.fetchRaw(t,o)},t.prototype.fetchRaw=function(t,n){var r=this;void 0===n&&(n={});var o=new Headers;e.mergeHeaders(o,n.headers),n=e.Util.extend(n,{headers:o});var i=function(o){r._impl.fetch(t,{},n).then(function(t){return o.resolve(t)}).catch(function(t){429!==t.status&&503!==t.status&&o.reject(t);var n=o.delay;o.delay*=2,o.attempts++,o.retryCount<=o.attempts&&o.reject(t),setTimeout(e.Util.getCtxCallback(r,i,o),n)})};return new Promise(function(t,e){var n={attempts:0,delay:100,reject:e,resolve:t,retryCount:7};i.call(r,n)})},t.prototype.get=function(t,n){void 0===n&&(n={});var r=e.Util.extend(n,{method:"GET"});return this.fetch(t,r)},t.prototype.post=function(t,n){void 0===n&&(n={});var r=e.Util.extend(n,{method:"POST"});return this.fetch(t,r)},t.prototype.patch=function(t,n){void 0===n&&(n={});var r=e.Util.extend(n,{method:"PATCH"});return this.fetch(t,r)},t.prototype.delete=function(t,n){void 0===n&&(n={});var r=e.Util.extend(n,{method:"DELETE"});return this.fetch(t,r)},t}(),f=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),l=function(t){function r(n,r){var o=t.call(this)||this;if(o._query=new e.Dictionary,"string"==typeof n){var i=n;o._parentUrl=i,o._url=e.Util.combinePaths(i,r)}else{var u=n;o._parentUrl=u._url,o._url=e.Util.combinePaths(o._parentUrl,r)}return o}return f(r,t),r.prototype.as=function(t){var n=new t(this._url,null);return e.Util.extend(n,this,!0)},r.prototype.toUrlAndQuery=function(){var t=this;return this.toUrl()+"?"+this._query.getKeys().map(function(e){return e+"="+t._query.get(e)}).join("&")},r.prototype.getParent=function(t,e,n){return void 0===e&&(e=this.parentUrl),new t(e,n)},r.prototype.clone=function(t,e,n){return void 0===n&&(n=!0),new t(this,e)},r.prototype.toRequestContext=function(t,r,o,i){return void 0===r&&(r={}),void 0===i&&(i=n.PipelineMethods.default),Promise.resolve({batch:this.batch,batchDependency:function(){},cachingOptions:this._cachingOptions,clientFactory:function(){return new a},isBatched:this.hasBatch,isCached:this._useCaching,options:r,parser:o,pipeline:i,requestAbsoluteUrl:this.toUrlAndQuery(),requestId:e.Util.getGUID(),verb:t})},r}(n.ODataQueryable),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e.prototype.filter=function(t){return this._query.add("$filter",t),this},e.prototype.select=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.length>0&&this._query.add("$select",t.join(",")),this},e.prototype.expand=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.length>0&&this._query.add("$expand",t.join(",")),this},e.prototype.orderBy=function(t,e){void 0===e&&(e=!0);for(var n=this._query.getKeys(),r=[],o=e?" asc":" desc",i=0;i<n.length;i++)if("$orderby"===n[i]){r.push(this._query.get("$orderby"));break}return r.push(""+t+o),this._query.add("$orderby",r.join(",")),this},e.prototype.top=function(t){return this._query.add("$top",t.toString()),this},e.prototype.skip=function(t){return this._query.add("$top",t.toString()),this},e.prototype.skipToken=function(t){return this._query.add("$skiptoken",t),this},Object.defineProperty(e.prototype,"count",{get:function(){return this._query.add("$count","true"),this},enumerable:!0,configurable:!0}),e}(l),y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e.prototype.search=function(t){return this._query.add("$search",t),this},e}(h),d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e.prototype.select=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.length>0&&this._query.add("$select",t.join(",")),this},e.prototype.expand=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.length>0&&this._query.add("$expand",t.join(",")),this},e}(l),g=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),b=function(t){function e(e,n){return void 0===n&&(n="members"),t.call(this,e,n)||this}return g(e,t),e.prototype.add=function(t){return this.clone(e,"$ref").postCore({body:JSON.stringify({"@odata.id":t})})},e.prototype.getById=function(t){return new v(this,t)},e}(h),v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return g(e,t),e}(d),_=function(t){function e(e,n){return void 0===n&&(n="owners"),t.call(this,e,n)||this}return g(e,t),e}(b),m=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),O=(function(t){function e(e,n){return void 0===n&&(n="calendars"),t.call(this,e,n)||this}m(e,t)}(h),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),Object.defineProperty(e.prototype,"events",{get:function(){return new w(this)},enumerable:!0,configurable:!0}),e}(d)),w=function(t){function e(e,n){return void 0===n&&(n="events"),t.call(this,e,n)||this}return m(e,t),e.prototype.getById=function(t){return new j(this,t)},e.prototype.add=function(t){var e=this;return this.postCore({body:JSON.stringify(t)}).then(function(t){return{data:t,event:e.getById(t.id)}})},e}(h),j=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.update=function(t){return this.patchCore({body:JSON.stringify(t)})},e.prototype.delete=function(){return this.deleteCore()},e}(d),C=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),P=function(t){function e(e,n){return void 0===n&&(n="attachments"),t.call(this,e,n)||this}return C(e,t),e.prototype.getById=function(t){return new q(this,t)},e.prototype.addFile=function(t,e){return this.postCore({body:JSON.stringify({"@odata.type":"#microsoft.graph.fileAttachment",contentBytes:e,name:t})})},e}(h),q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return C(e,t),e}(d),x=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),U=function(t){function e(e,n){return void 0===n&&(n="conversations"),t.call(this,e,n)||this}return x(e,t),e.prototype.add=function(t){return this.postCore({body:JSON.stringify(t)})},e.prototype.getById=function(t){return new B(this,t)},e}(h),S=function(t){function e(e,n){return void 0===n&&(n="threads"),t.call(this,e,n)||this}return x(e,t),e.prototype.getById=function(t){return new L(this,t)},e.prototype.add=function(t){return this.postCore({body:JSON.stringify(t)})},e}(h),I=function(t){function e(e,n){return void 0===n&&(n="posts"),t.call(this,e,n)||this}return x(e,t),e.prototype.getById=function(t){return new N(this,t)},e.prototype.add=function(t){return this.postCore({body:JSON.stringify(t)})},e}(h),B=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return x(e,t),Object.defineProperty(e.prototype,"threads",{get:function(){return new S(this)},enumerable:!0,configurable:!0}),e.prototype.update=function(t){return this.patchCore({body:JSON.stringify(t)})},e.prototype.delete=function(){return this.deleteCore()},e}(d),L=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return x(e,t),Object.defineProperty(e.prototype,"posts",{get:function(){return new I(this)},enumerable:!0,configurable:!0}),e.prototype.reply=function(t){return this.clone(e,"reply").postCore({body:JSON.stringify({post:t})})},e.prototype.delete=function(){return this.deleteCore()},e}(d),N=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return x(e,t),Object.defineProperty(e.prototype,"attachments",{get:function(){return new P(this)},enumerable:!0,configurable:!0}),e.prototype.delete=function(){return this.deleteCore()},e.prototype.forward=function(t){return this.clone(e,"forward").postCore({body:JSON.stringify(t)})},e.prototype.reply=function(t){return this.clone(e,"reply").postCore({body:JSON.stringify({post:t})})},e}(d),$=function(t){function e(e,n){return t.call(this,e,n)||this}return x(e,t),e.prototype.add=function(t){return this.clone(e,"$ref").postCore({body:JSON.stringify({"@odata.id":t})})},e.prototype.remove=function(t){var n=this.clone(e,"$ref");return n.query.add("$id",t),n.deleteCore()},e}(h),R=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),A=function(t){function e(e,n){return void 0===n&&(n="planner/plans"),t.call(this,e,n)||this}return R(e,t),e.prototype.getById=function(t){return new D(this,t)},e}(h),D=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return R(e,t),e}(d),J=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),T=function(t){function e(e,n){return void 0===n&&(n="photo"),t.call(this,e,n)||this}return J(e,t),e.prototype.getBlob=function(){return this.clone(e,"$value",!1).get(new n.BlobFileParser)},e.prototype.getBuffer=function(){return this.clone(e,"$value",!1).get(new n.BufferFileParser)},e.prototype.setContent=function(t){return this.clone(e,"$value",!1).patchCore({body:t})},e}(d),E=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){t[t.Office365=0]="Office365",t[t.Dynamic=1]="Dynamic",t[t.Security=2]="Security"}(i||(i={}));var G=function(t){function n(e,n){return void 0===n&&(n="groups"),t.call(this,e,n)||this}return E(n,t),n.prototype.getById=function(t){return new F(this,t)},n.prototype.add=function(t,n,r,o){var u=this;void 0===o&&(o={});var c=e.Util.extend({displayName:t,mailEnabled:r===i.Office365,mailNickname:n,securityEnabled:r!==i.Office365},o);return r!==i.Security&&(c=e.Util.extend(c,{groupTypes:[r===i.Office365?"Unified":"DynamicMembership"]})),this.postCore({body:JSON.stringify(c)}).then(function(t){return{data:t,group:u.getById(t.id)}})},n}(h),F=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return E(e,t),Object.defineProperty(e.prototype,"caldendar",{get:function(){return new O(this,"calendar")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"events",{get:function(){return new w(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"owners",{get:function(){return new _(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"plans",{get:function(){return new A(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"members",{get:function(){return new b(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"conversations",{get:function(){return new U(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"acceptedSenders",{get:function(){return new $(this,"acceptedsenders")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rejectedSenders",{get:function(){return new $(this,"rejectedsenders")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"photo",{get:function(){return new T(this)},enumerable:!0,configurable:!0}),e.prototype.addFavorite=function(){return this.clone(e,"addFavorite").postCore()},e.prototype.getMemberGroups=function(t){return void 0===t&&(t=!1),this.clone(e,"getMemberGroups").postCore({body:JSON.stringify({securityEnabledOnly:t})})},e.prototype.delete=function(){return this.deleteCore()},e.prototype.update=function(t){return this.patchCore({body:JSON.stringify(t)})},e.prototype.removeFavorite=function(){return this.clone(e,"removeFavorite").postCore()},e.prototype.resetUnseenCount=function(){return this.clone(e,"resetUnseenCount").postCore()},e.prototype.subscribeByMail=function(){return this.clone(e,"subscribeByMail").postCore()},e.prototype.unsubscribeByMail=function(){return this.clone(e,"unsubscribeByMail").postCore()},e.prototype.getCalendarView=function(t,n){var r=this.clone(e,"calendarView");return r.query.add("startDateTime",t.toISOString()),r.query.add("endDateTime",n.toISOString()),r.get()},e}(d),k=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),M=function(t){function e(e,n){return void 0===n&&(n="v1.0"),t.call(this,e,n)||this}return k(e,t),Object.defineProperty(e.prototype,"groups",{get:function(){return new G(this)},enumerable:!0,configurable:!0}),e}(l),H=function(){function t(){}return Object.defineProperty(t.prototype,"v1",{get:function(){return new M("")},enumerable:!0,configurable:!0}),t.prototype.setup=function(t){o(t)},t}(),Q=new H,V=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),K=function(t,e,n,r){var o,i=arguments.length,u=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(t,e,n,r);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(u=(i<3?o(u):i>3?o(e,n,u):o(e,n))||u);return i>3&&u&&Object.defineProperty(e,n,u),u},z=function(t){function n(e){void 0===e&&(e="https://graph.microsoft.com/beta/$batch");var n=t.call(this)||this;return n.batchUrl=e,n}return V(n,t),n.prototype.executeImpl=function(){var t=this;r.Logger.write("["+this.batchId+"] ("+(new Date).getTime()+") Executing batch with "+this.requests.length+" requests.",r.LogLevel.Info);var n=new a,o={requests:this.formatRequests()},i={body:JSON.stringify(o),headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"};return r.Logger.write("["+this.batchId+"] ("+(new Date).getTime()+") Sending batch request.",r.LogLevel.Info),n.fetch(this.batchUrl,i).then(function(t){return t.json()}).then(this._parseResponse).then(function(n){return r.Logger.write("["+t.batchId+"] ("+(new Date).getTime()+") Resolving batched requests.",r.LogLevel.Info),n.responses.reduce(function(o,i,u){var c=t.requests[u];if(e.Util.objectDefinedNotNull(c))return r.Logger.write("["+t.batchId+"] ("+(new Date).getTime()+") Resolving batched request "+c.method+" "+c.url+".",r.LogLevel.Verbose),o.then(function(t){return c.parser.parse(i).then(c.resolve).catch(c.reject)});if(!e.Util.stringIsNullOrEmpty(n.nextLink))throw new s("Could not properly parse responses to match requests in batch.");return o},Promise.resolve())})},n.prototype.formatRequests=function(){return this.requests.map(function(t,n){var r={id:""+ ++n,method:t.method,url:t.url},o={};return void 0!==p.headers&&null!==p.headers&&(o=e.Util.extend(o,p.headers)),void 0!==t.options&&(void 0!==t.options.headers&&null!==t.options.headers&&(o=e.Util.extend(o,t.options.headers)),void 0!==t.options.body&&null!==t.options.body&&(r=e.Util.extend(r,{body:t.options.body}))),r=e.Util.extend(r,{headers:o})})},n.prototype._parseResponse=function(t){var e=this;return new Promise(function(n){for(var r=new Array(e.requests.length).fill(null),o=0;o<t.responses.length;++o){var i=t.responses[o],u=parseInt(i.id,10)-1;204===i.status?r[u]=new Response:r[u]=new Response(null,{headers:i.headers,status:i.status})}n({nextLink:t.nextLink,responses:r})})},K([e.beta("Graph batching functionality is in beta.")],n.prototype,"executeImpl",null),n}(n.ODataBatch);t.graph=Q,t.GraphRest=H,t.GraphBatch=z,t.GraphQueryable=l,t.GraphQueryableCollection=h,t.GraphQueryableInstance=d,t.GraphQueryableSearchableCollection=y,Object.defineProperty(t,"__esModule",{value:!0})});