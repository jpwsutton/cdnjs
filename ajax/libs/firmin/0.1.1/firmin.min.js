Firmin="undefined"==typeof Firmin?{}:Firmin,Firmin.prefix=function(){var i,r,t=document.createElement("div"),n=["o","moz","webkit"];for(r=0;r<3;r++)if(i=n[r],t.style.cssText="-"+i+"-transition-property: opacity;","moz"===i&&(i="Moz"),void 0!==t.style[i+"TransitionProperty"])return i}(),Firmin.TransformMatrix=function(i){var r,t;if(this.vector=[1,0,0,1,0,0],"object"==typeof i)for(r=0;r<6;r++)this.vector[r]="number"==typeof(t=i[r])?t:this.vector[r]},Firmin.TransformMatrix.prototype.multiply=function(i){var r=new Array(6),t=this.vector;r[0]=t[0]*i[0]+t[2]*i[1],r[1]=t[1]*i[0]+t[3]*i[1],r[2]=t[0]*i[2]+t[2]*i[3],r[3]=t[1]*i[2]+t[3]*i[3],r[4]=t[0]*i[4]+t[2]*i[5]+t[4],r[5]=t[1]*i[4]+t[3]*i[5]+t[5],this.vector=r},Firmin.TransformMatrix.prototype.build=function(){return"matrix("+this.vector.join(",")+")"},Firmin.Transform=function(i,r){this.ctm=new Firmin.TransformMatrix(i),this.centre=Firmin.pointToVector(r)||["50%","50%"]},Firmin.Transform.methods=["translate","translateX","translateY","scale","scaleX","scaleY","rotate","skew","skewX","skewY","matrix"],Firmin.Transform.parse=function(i,r){var t,n,e=Firmin.Transform.methods,o={},a=null;for(property in r.transform&&(t=r.transform.toVector(),n=r.transform.getOrigin(),a=new Firmin.Transform(t,n)),i)-1!==e.indexOf(property)?(a=a||new Firmin.Transform)[property](i[property]):"origin"===property?(a=a||new Firmin.Transform)[property](i[property]):o[property]=i[property];return{result:a,remainder:o}},Firmin.Transform.prototype.matrix=function(i){this.ctm.multiply(i)},Firmin.Transform.prototype.toVector=function(){return this.ctm.vector},Firmin.Transform.prototype.getOrigin=function(){return this.centre.join(" ")},Firmin.Transform.prototype.build=function(i){return(i=i||{})[Firmin.prefix+"Transform"]=this.ctm.build(),i[Firmin.prefix+"TransformOrigin"]=this.getOrigin(),i},Firmin.Transform.prototype.translate=function(i){var r,t,n;"number"==typeof i||"string"==typeof i?t=n=i:(t=(r=Firmin.pointToVector(i))[0],n=r[1],"number"!=typeof t&&(t=parseInt(t,10)||0),"number"!=typeof n&&(n=parseInt(n,10)||0)),this.matrix([1,0,0,1,t,n])},Firmin.Transform.prototype.translateX=function(i){this.translate([i,0])},Firmin.Transform.prototype.translateY=function(i){this.translate([0,i])},Firmin.Transform.prototype.scale=function(i){var r,t,n;"number"==typeof i?t=n=i:("number"!=typeof(t=(r=Firmin.pointToVector(i))[0])&&(t=1),"number"!=typeof(n=r[1])&&(n=1)),this.matrix([t,0,0,n,0,0])},Firmin.Transform.prototype.scaleX=function(i){this.scale([i,1])},Firmin.Transform.prototype.scaleY=function(i){this.scale([1,i])},Firmin.Transform.prototype.skew=function(i){var r,t,n,e=Firmin.Parser.parseAngle,o=Firmin.angleToRadians;"number"==typeof i||"string"==typeof i?t=n=o.apply(null,e(i)):(r=Firmin.pointToVector(i),t=o.apply(null,e(r[0]))||0,n=o.apply(null,e(r[1]))||0),this.matrix([1,Math.tan(n),Math.tan(t),1,0,0])},Firmin.Transform.prototype.skewX=function(i){this.skew([i,0])},Firmin.Transform.prototype.skewY=function(i){this.skew([0,i])},Firmin.Transform.prototype.rotate=function(i){i=Firmin.angleToRadians.apply(null,Firmin.Parser.parseAngle(i)),this.matrix([Math.cos(i),Math.sin(i),-Math.sin(i),Math.cos(i),0,0])},Firmin.Transform.prototype.origin=function(i){var r=Firmin.pointToVector(i);r[0]&&(this.centre[0]=r[0]),r[1]&&(this.centre[1]=r[1])},Firmin.Transition=function(){this.properties=["all"],this.duration=["ms",0],this.delay=["ms",0],this.timingFunction="ease"},Firmin.Transition.methods=["properties","timingFunction","duration","delay"],Firmin.Transition.parse=function(i,r){var t,n,e=Firmin.Transition.methods,o={},a=new Firmin.Transition;for(p in i)-1!==e.indexOf(p)?"properties"===p&&"string"==typeof p?a[p]=[i[p]]:"timingFunction"===p&&"string"!=typeof i[p]?a[p]="cubic-bezier("+i[p].join(",")+")":"duration"===p?(t=Firmin.Parser.parseTime(i[p]))&&(a[p]=t):"delay"===p?(n=Firmin.Parser.parseTime(i[p]))&&(a[p]=n):a[p]=i[p]:o[p]=i[p];return{result:a,remainder:o}},Firmin.Transition.prototype.hasDuration=function(){return 0!==this.duration[1]},Firmin.Transition.prototype.getDuration=function(){var i=this.duration;return"s"===i[0]?1e3*i[1]:i[1]},Firmin.Transition.prototype.hasDelay=function(){return 0!==this.delay[1]},Firmin.Transition.prototype.getDelay=function(){var i=this.delay;return"s"===i[0]?1e3*i[1]:i[1]},Firmin.Transition.prototype.build=function(i){return i=i||{},"string"==typeof this.properties?i[Firmin.prefix+"TransitionProperty"]=this.properties:i[Firmin.prefix+"TransitionProperty"]=this.properties.join(", "),i[Firmin.prefix+"TransitionDuration"]=this.duration[1]+this.duration[0],i[Firmin.prefix+"TransitionDelay"]=this.delay[1]+this.delay[0],this.timingFunction&&(i[Firmin.prefix+"TransitionTimingFunction"]=this.timingFunction),i},Firmin.Animation=function(i,r){var t,n;"function"==typeof i.callback&&(this.callback=i.callback),delete i.callback,t=Firmin.Transition.parse(i,r),this.transition=t.result,n=Firmin.Transform.parse(t.remainder,r),this.transform=n.result,this.style=n.remainder},Firmin.Animation.prototype.hasDuration=function(){return this.transition&&this.transition.hasDuration()},Firmin.Animation.prototype.getTotalDuration=function(){return this.transition?this.transition.getDuration()+this.transition.getDelay():0},Firmin.Animation.prototype.exec=function(i){var r,t=this.style;for(r in this.transition&&(t=this.transition.build(t)),this.transform&&(t=this.transform.build(t)),t)i.style[r]=t[r]},Firmin.Animated=function(i){this.element=i,this.operations=[],this.index=0},Firmin.Animated.prototype.run=function(){var i=this.operations[this.index],r=this;return i?(i.exec(this.element),setTimeout(function(){r.fireCallback(),r.run()},i.getTotalDuration()||1),this.index++):this.fired=!0,this},Firmin.Animated.prototype.fireCallback=function(){var i=this.operations[this.index-1],r=i?i.callback:null;"function"==typeof r&&r.call(null,this.element)},Firmin.Animated.prototype.animate=function(i,r,t){var n=this.operations[this.operations.length-1]||{};return i.duration=r,i.callback=t||null,this.operations.push(new Firmin.Animation(i,n)),this.fired&&(this.fired=!1,this.run()),this},Firmin.animate=function(i,r,t,n){var e=new Firmin.Animated(i);return e.animate(r,t,n),e.run()},Firmin.Transform.methods.forEach(function(o){Firmin[o]=function(i,r,t,n){var e={};return e[o]=r,Firmin.animate(i,e,t,n)},Firmin.Animated.prototype[o]=function(i,r,t){var n={};return n[o]=i,this.animate(n,r,t)}}),Firmin.Parser={},Firmin.Parser.NUMBER_PATTERN=/^-?\d+(\.\d+)?/,Firmin.Parser.parseNumeric=function(n,e){return function(r){var i,t;return"number"==typeof r?[e,r]:"string"!=typeof r?null:(i=(t=(r.match(Firmin.Parser.NUMBER_PATTERN)||[""])[0]).length===r.length?e:n.filter(function(i){return r.substr(t.length)===i})[0])&&t?[i,parseFloat(t)]:null}},Firmin.Parser.parseAngle=Firmin.Parser.parseNumeric(["deg","grad","rad","turn"],"deg"),Firmin.Parser.parseTime=Firmin.Parser.parseNumeric(["s","ms"],"s"),Firmin.angleToRadians=function(i,r){var t;switch(i){case"rad":return r;case"deg":t=Math.PI/180;break;case"grad":t=Math.PI/200;break;case"turn":t=2*Math.PI}return t*r},Firmin.pointToVector=function(i){return i?i instanceof Array?i:[i.x,i.y,i.z]:null};