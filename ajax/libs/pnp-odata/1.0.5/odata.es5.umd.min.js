/**
@license
 * @pnp/odata v1.0.5 - pnp - provides shared odata functionality and base classes
 * MIT (https://github.com/pnp/pnpjs/blob/master/LICENSE)
 * Copyright (c) 2018 Microsoft
 * docs: https://pnp.github.io/pnpjs/
 * source: https:github.com/pnp/pnpjs
 * bugs: https://github.com/pnp/pnpjs/issues
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@pnp/common"),require("tslib"),require("@pnp/logging")):"function"==typeof define&&define.amd?define(["exports","@pnp/common","tslib","@pnp/logging"],t):t((e.pnp=e.pnp||{},e.pnp.odata={}),e.pnp.common,e.tslib_1,e.pnp.logging)}(this,function(e,u,r,s){"use strict";var o=function(){function e(e){this.key=e,this.expiration=u.dateAdd(new Date,"second",u.RuntimeConfig.defaultCachingTimeoutSeconds),this.storeName=u.RuntimeConfig.defaultCachingStore}return Object.defineProperty(e.prototype,"store",{get:function(){return"local"===this.storeName?e.storage.local:e.storage.session},enumerable:!0,configurable:!0}),e.storage=new u.PnPClientStorage,e}(),i=function(){function e(e,t){this._parser=e,this._cacheOptions=t}return e.prototype.parse=function(e){var t=this;return this._parser.parse(e).then(function(e){return null!==t._cacheOptions.store&&t._cacheOptions.store.put(t._cacheOptions.key,e,t._cacheOptions.expiration),e})},e}(),a=function(o){function e(e,t,n){var r=o.call(this,"Error making HttpClient request in queryable: ["+e+"] "+t)||this;return r.status=e,r.statusText=t,r.data=n,r.name="ProcessHttpClientResponseException",s.Logger.log({data:r.data,level:3,message:r.message}),r}return r.__extends(e,o),e}(Error),t=function(){function e(){}return e.prototype.parse=function(n){var r=this;return new Promise(function(e,t){r.handleError(n,t)&&r.parseImpl(n,e,t)})},e.prototype.parseImpl=function(e,t,n){var r=this;e.headers.has("Content-Length")&&0===parseFloat(e.headers.get("Content-Length"))||204===e.status?t({}):e.text().then(function(e){return 0<e.replace(/\s/gi,"").length?JSON.parse(e):{}}).then(function(e){return t(r.parseODataJSON(e))}).catch(function(e){return n(e)})},e.prototype.handleError=function(n,r){return n.ok||n.json().then(function(e){var t={responseBody:e,responseHeaders:n.headers};r(new a(n.status,n.statusText,t))}).catch(function(e){s.Logger.log({data:e,level:2,message:"There was an error parsing the error response body. See data for details."});var t={responseBody:"[[body not available]]",responseHeaders:n.headers};r(new a(n.status,n.statusText,t))}),n.ok},e.prototype.parseODataJSON=function(e){var t=e;return e.hasOwnProperty("d")?t=e.d.hasOwnProperty("results")?e.d.results:e.d:e.hasOwnProperty("value")&&(t=e.value),t},e}(),n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(t),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.parseImpl=function(e,t){e.text().then(t)},t}(t),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.parseImpl=function(e,t){e.blob().then(t)},t}(t),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.parseImpl=function(e,t){e.json().then(t)},t}(t),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.parseImpl=function(e,t){u.isFunc(e.arrayBuffer)&&e.arrayBuffer().then(t),e.buffer().then(t)},t}(t);function f(t,n){return new Promise(function(e){t.result=n,t.hasResult=!0,e(t)})}function d(e){return 0<e.pipeline.length?e.pipeline.shift()(e):Promise.resolve(e)}function g(e){return e.pipeline.length<1&&s.Logger.write("["+e.requestId+"] ("+(new Date).getTime()+") Request pipeline contains no methods!",2),d(e).then(function(e){return t=e,s.Logger.log({data:t.result,level:0,message:"["+t.requestId+"] ("+(new Date).getTime()+") Returning result, see data property for value."}),Promise.resolve(t.result||null);var t}).catch(function(e){throw s.Logger.error(e),e})}function y(i){return void 0===i&&(i=!1),function(n,r,e){var o=e.value;e.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return!i&&0<e.length&&e[0].hasOwnProperty("hasResult")&&e[0].hasResult?(s.Logger.write("["+e[0].requestId+"] ("+(new Date).getTime()+") Skipping request pipeline method "+r+", existing result in pipeline.",0),Promise.resolve(e[0])):(s.Logger.write("["+e[0].requestId+"] ("+(new Date).getTime()+") Calling request pipeline method "+r+".",0),o.apply(n,e).then(function(e){return d(e)}))}}}var v=function(){function e(){}return e.logStart=function(t){return new Promise(function(e){s.Logger.log({data:1===s.Logger.activeLogLevel?{}:t,level:1,message:"["+t.requestId+"] ("+(new Date).getTime()+") Beginning "+t.verb+" request ("+t.requestAbsoluteUrl+")"}),e(t)})},e.caching=function(r){return new Promise(function(t){if("GET"===r.verb&&r.isCached){s.Logger.write("["+r.requestId+"] ("+(new Date).getTime()+") Caching is enabled for request, checking cache...",1);var e=new o(r.requestAbsoluteUrl.toLowerCase());if(void 0!==r.cachingOptions&&(e=u.extend(e,r.cachingOptions)),null!==e.store){var n=e.store.get(e.key);if(null!==n)return s.Logger.log({data:1===s.Logger.activeLogLevel?{}:n,level:1,message:"["+r.requestId+"] ("+(new Date).getTime()+") Value returned from cache."}),u.isFunc(r.batchDependency)&&r.batchDependency(),r.parser.hasOwnProperty("hydrate")&&(n=r.parser.hydrate(n)),f(r,n).then(function(e){return t(e)})}s.Logger.write("["+r.requestId+"] ("+(new Date).getTime()+") Value not found in cache.",1),r.parser=new i(r.parser,e)}return t(r)})},e.send=function(i){return new Promise(function(t,n){if(i.isBatched){var e=i.batch.add(i.requestAbsoluteUrl,i.verb,i.options,i.parser);u.isFunc(i.batchDependency)&&i.batchDependency(),s.Logger.write("["+i.requestId+"] ("+(new Date).getTime()+") Batching request in batch "+i.batch.batchId+".",1),t(f(i,e))}else{s.Logger.write("["+i.requestId+"] ("+(new Date).getTime()+") Sending request.",1);var r=i.clientFactory(),o=u.extend(i.options||{},{method:i.verb});r.fetch(i.requestAbsoluteUrl,o).then(function(e){return i.parser.parse(e)}).then(function(e){return f(i,e)}).then(function(e){return t(e)}).catch(function(e){return n(e)})}})},e.logEnd=function(t){return new Promise(function(e){t.isBatched?s.Logger.log({data:1===s.Logger.activeLogLevel?{}:t,level:1,message:"["+t.requestId+"] ("+(new Date).getTime()+") "+t.verb+" request will complete in batch "+t.batch.batchId+"."}):s.Logger.log({data:1===s.Logger.activeLogLevel?{}:t,level:1,message:"["+t.requestId+"] ("+(new Date).getTime()+") Completing "+t.verb+" request."}),e(t)})},r.__decorate([y(!0)],e,"logStart",null),r.__decorate([y()],e,"caching",null),r.__decorate([y()],e,"send",null),r.__decorate([y(!0)],e,"logEnd",null),e}();function m(){return[v.logStart,v.caching,v.send,v.logEnd].slice(0)}var b=function(n){function e(e){void 0===e&&(e="This query is already part of a batch.");var t=n.call(this,e)||this;return t.name="AlreadyInBatchException",s.Logger.error(t),t}return r.__extends(e,n),e}(Error),_=function(){function e(){this._query=new u.Dictionary,this._options={},this._url="",this._parentUrl="",this._useCaching=!1,this._cachingOptions=null}return e.prototype.toUrl=function(){return this._url},e.prototype.concat=function(e){return this._url+=e,this},Object.defineProperty(e.prototype,"query",{get:function(){return this._query},enumerable:!0,configurable:!0}),e.prototype.configure=function(e){return u.mergeOptions(this._options,e),this},e.prototype.configureFrom=function(e){return u.mergeOptions(this._options,e._options),this},e.prototype.usingCaching=function(e){return u.RuntimeConfig.globalCacheDisable||(this._useCaching=!0,void 0!==e&&(this._cachingOptions=e)),this},e.prototype.get=function(e,t){return void 0===e&&(e=new l),void 0===t&&(t={}),this.getCore(e,t)},e.prototype.getCore=function(e,t){return void 0===e&&(e=new l),void 0===t&&(t={}),this.toRequestContext("GET",t,e,m()).then(function(e){return g(e)})},e.prototype.postCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new l),this.toRequestContext("POST",e,t,m()).then(function(e){return g(e)})},e.prototype.patchCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new l),this.toRequestContext("PATCH",e,t,m()).then(function(e){return g(e)})},e.prototype.deleteCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new l),this.toRequestContext("DELETE",e,t,m()).then(function(e){return g(e)})},e.prototype.putCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new l),this.toRequestContext("PUT",e,t,m()).then(function(e){return g(e)})},e.prototype.append=function(e){this._url=u.combinePaths(this._url,e)},Object.defineProperty(e.prototype,"parentUrl",{get:function(){return this._parentUrl},enumerable:!0,configurable:!0}),e.prototype.extend=function(e,t){this._parentUrl=e._url,this._url=u.combinePaths(this._parentUrl,t),this.configureFrom(e)},e}(),w=function(t){function e(){var e=t.call(this)||this;return e._batch=null,e}return r.__extends(e,t),e.prototype.inBatch=function(e){if(null!==this.batch)throw new b;return this._batch=e,this},e.prototype.toUrl=function(){return this._url},e.prototype.get=function(e,t){return void 0===e&&(e=new n),void 0===t&&(t={}),this.getCore(e,t)},e.prototype.getCore=function(e,t){return void 0===e&&(e=new n),void 0===t&&(t={}),this.toRequestContext("GET",t,e,m()).then(function(e){return g(e)})},e.prototype.postCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new n),this.toRequestContext("POST",e,t,m()).then(function(e){return g(e)})},e.prototype.patchCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new n),this.toRequestContext("PATCH",e,t,m()).then(function(e){return g(e)})},e.prototype.deleteCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new n),this.toRequestContext("DELETE",e,t,m()).then(function(e){return g(e)})},e.prototype.putCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new n),this.toRequestContext("PUT",e,t,m()).then(function(e){return g(e)})},e.prototype.addBatchDependency=function(){return null!==this._batch?this._batch.addDependency():function(){return null}},Object.defineProperty(e.prototype,"hasBatch",{get:function(){return u.objectDefinedNotNull(this._batch)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batch",{get:function(){return this.hasBatch?this._batch:null},enumerable:!0,configurable:!0}),e}(_),q=function(){function e(e){void 0===e&&(e=u.getGUID()),this._batchId=e,this._requests=[],this._dependencies=[]}return Object.defineProperty(e.prototype,"batchId",{get:function(){return this._batchId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"requests",{get:function(){return this._requests},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t,n,r){var o={method:t.toUpperCase(),options:n,parser:r,reject:null,resolve:null,url:e},i=new Promise(function(e,t){o.resolve=e,o.reject=t});return this._requests.push(o),i},e.prototype.addDependency=function(){var t=function(){},e=new Promise(function(e){t=e});return this._dependencies.push(e),t},e.prototype.execute=function(){var e=this;return Promise.all(this._dependencies).then(function(){return Promise.all(e._dependencies)}).then(function(){return e.executeImpl()})},e}();e.CachingOptions=o,e.CachingParserWrapper=i,e.ProcessHttpClientResponseException=a,e.ODataParserBase=t,e.ODataDefaultParser=n,e.TextParser=c,e.BlobParser=p,e.JSONParser=l,e.BufferParser=h,e.setResult=f,e.pipe=g,e.requestPipelineMethod=y,e.PipelineMethods=v,e.getDefaultPipeline=m,e.AlreadyInBatchException=b,e.Queryable=_,e.ODataQueryable=w,e.ODataBatch=q,Object.defineProperty(e,"__esModule",{value:!0})});