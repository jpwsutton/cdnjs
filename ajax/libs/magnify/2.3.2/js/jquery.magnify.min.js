!function(E){E.fn.magnify=function(Y){Y=E.extend({src:"",speed:100,timeout:-1,touchBottomOffset:0,finalWidth:null,finalHeight:null,magnifiedWidth:null,magnifiedHeight:null,limitBounds:!1,mobileCloseEvent:"touchstart",afterLoad:function(){}},Y);var t=this,B=E("html"),i=0,k=function(){clearTimeout(i),i=setTimeout(function(){t.destroy(),t.magnify(Y)},100)};return this.destroy=function(){return this.each(function(){var t=E(this),i=t.prev("div.magnify-lens"),e=t.data("originalStyle");t.parent("div.magnify").length&&i.length&&(e?t.attr("style",e):t.removeAttr("style"),t.unwrap(),i.remove())}),E(window).off("resize",k),t},E(window).resize(k),this.each(function(){!function(t){var s=E(t),i=s.closest("a"),o={};for(var e in Y)o[e]=s.attr("data-magnify-"+e.toLowerCase());var r=o.src||Y.src||i.attr("href")||"";if(r){var f,l,d,c,u,h,g,m,p,v,y=0,b=0,w=function(){var t=f.offset();return v={top:s.offset().top-t.top+parseInt(s.css("border-top-width"))+parseInt(s.css("padding-top")),left:s.offset().left-t.left+parseInt(s.css("border-left-width"))+parseInt(s.css("padding-left"))},t.top+=v.top,t.left+=v.left,t},N=function(){l.is(":visible")&&l.fadeOut(Y.speed,function(){B.removeClass("magnifying").trigger("magnifyend")})},P=function(t){if(c){if(t?(t.preventDefault(),nPosX=t.pageX||t.originalEvent.touches[0].pageX,nPosY=t.pageY||t.originalEvent.touches[0].pageY,s.data("lastPos",{x:nPosX,y:nPosY})):(nPosX=s.data("lastPos").x,nPosY=s.data("lastPos").y),nX=nPosX-p.left,nY=nPosY-p.top-Y.touchBottomOffset,l.is(":animated")||(nX>y&&nX<d-y&&nY>b&&nY<c-b?l.is(":hidden")&&(B.addClass("magnifying").trigger("magnifystart"),l.fadeIn(Y.speed)):N()),l.is(":visible")){var i="";if(u&&h){var e=-Math.round(nX/d*u-g/2),n=-Math.round(nY/c*h-m/2);if(Y.limitBounds){var a=-Math.round((d-y)/d*u-g/2),o=-Math.round((c-b)/c*h-m/2);0<e?e=0:e<a&&(e=a),0<n?n=0:n<o&&(n=o)}i=e+"px "+n+"px"}l.css({top:Math.round(nY-m/2)+v.top+"px",left:Math.round(nX-g/2)+v.left+"px","background-position":i})}}else k()};isNaN(+o.speed)||(Y.speed=+o.speed),isNaN(+o.timeout)||(Y.timeout=+o.timeout),isNaN(+o.finalWidth)||(Y.finalWidth=+o.finalWidth),isNaN(+o.finalHeight)||(Y.finalHeight=+o.finalHeight),isNaN(+o.magnifiedWidth)||(Y.magnifiedWidth=+o.magnifiedWidth),isNaN(+o.magnifiedHeight)||(Y.magnifiedHeight=+o.magnifiedHeight),"true"===o.limitBounds&&(Y.limitBounds=!0),"function"==typeof window[o.afterLoad]&&(Y.afterLoad=window[o.afterLoad]),/\b(Android|BlackBerry|IEMobile|iPad|iPhone|Mobile|Opera Mini)\b/.test(navigator.userAgent)?isNaN(+o.touchBottomOffset)||(Y.touchBottomOffset=+o.touchBottomOffset):Y.touchBottomOffset=0,s.data("originalStyle",s.attr("style"));var X=new Image;E(X).on({load:function(){var e,n;s.css("display","block"),s.parent(".magnify").length||s.wrap('<div class="magnify"></div>'),f=s.parent(".magnify"),s.prev(".magnify-lens").length?f.children(".magnify-lens").css("background-image","url('"+r+"')"):s.before('<div class="magnify-lens loading" style="background:url(\''+r+"') 0 0 no-repeat\"></div>"),(l=f.children(".magnify-lens")).removeClass("loading"),d=Y.finalWidth||s.width(),c=Y.finalHeight||s.height(),u=Y.magnifiedWidth||X.width,h=Y.magnifiedHeight||X.height,g=l.width(),m=l.height(),p=w(),Y.limitBounds&&(y=g/2/(u/d),b=m/2/(h/c)),u===X.width&&h===X.height||l.css("background-size",u+"px "+h+"px"),s.data("zoomSize",{width:u,height:h}),f.data("mobileCloseEvent",o.mobileCloseEvent||Y.mobileCloseEvent),X=null,Y.afterLoad(),l.is(":visible")&&P(),f.off().on({"mousemove touchmove":P,mouseenter:function(){p=w()},mouseleave:N}),0<=Y.timeout&&f.on("touchend",function(){setTimeout(N,Y.timeout)}),E("body").not(f).on("touchstart",N);var t=s.attr("usemap");if(t){var a=E("map[name="+t.slice(1)+"]");s.after(a),f.click(function(t){if(t.clientX||t.clientY){l.hide();var i=document.elementFromPoint(t.clientX||t.originalEvent.touches[0].clientX,t.clientY||t.originalEvent.touches[0].clientY);"AREA"===i.nodeName?i.click():E("area",a).each(function(){var t=E(this).attr("coords").split(",");if(e>=t[0]&&e<=t[2]&&n>=t[1]&&n<=t[3])return this.click(),!1})}})}i.length&&(i.css("display","inline-block"),!i.attr("href")||o.src||Y.src||i.click(function(t){t.preventDefault()}))},error:function(){X=null}}),X.src=r}}(this)})}}(jQuery);